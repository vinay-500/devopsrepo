{"workflows":[{"id":127156,"name":"UPLOAD_FILE","trigger":"rest","expression":"/storage/{app-name}/get-signed-link/{dir}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXWzZ8lNnrVu"}},{"file_name":"{{{request.path.app-name}}}/{{{session.tenant_id}}}/{{{session.user_id}}}/{{request.path.dir}}/{{request.params.file}}","output_variable":"result","expiration_time_in_sec":"1000","bucket_name":"generic-apps","value_type":"hb","method":"PUT","access_level":"PublicReadWrite","plugin_name":"s3-plugin","type":"s3-pre-sign-url","id":"PBXWzZ8lNnrVu","next":{"success":"PBX9yg5i5bp9U","failure":"PBXHq4Qqvqpm6"}},{"json_is":"true","json_name":"success_response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Result","value":"success"},{"key":"File_link","value":"{{{response.s3_url}}}"},{"key":"signed_url","value":"{{{response.s3_presign_url}}}"}],"type":"set-var-multi","id":"PBXWi5zpQ6nli","next":{"success":"PBXE7LhqbkyL1","failure":"hangup"}},{"json_is":"true","json_name":"error_response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Result","value":"failure"},{"key":"Failure message","value":"Unable to generate presign url"}],"type":"set-var-multi","id":"PBXHq4Qqvqpm6","next":{"success":"PBXbPCTKiFxBX","failure":"hangup"}},{"variable_name":"success_response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXE7LhqbkyL1","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"error_response","http_response_code":"404","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXbPCTKiFxBX","next":{"success":"hangup","failure":"hangup"}},{"convert_from":"json","convert_to":"json_object","output_variable":"response","root_name":"","value_type":"hb","data":"{{{result}}}","type":"utils-convert","id":"PBX9yg5i5bp9U","next":{"success":"PBXWi5zpQ6nli","failure":"hangup"}}]},{"id":127284,"name":"DOWNLOAD_FILE","trigger":"rest","expression":"/storage/{app-name}/{dir}/{file_link}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXAW6s434sVF"}},{"file_name":"{{{request.path.app-name}}}/{{{session.tenant_id}}}/{{{session.user_id}}}/{{{request.path.dir}}}/{{{request.path.file_link}}}","output_variable":"result","expiration_time_in_sec":"1000","bucket_name":"generic-apps","value_type":"hb","method":"GET","access_level":"PublicReadWrite","plugin_name":"s3-plugin","type":"s3-pre-sign-url","id":"PBXAW6s434sVF","next":{"success":"PBXT0bDAFcXaT","failure":"PBX3sro0W11QZ"}},{"url":"{{{response.s3_url}}}","status_code":"302","type":"redirect","id":"PBXXsvpT3kWRk","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Result","value":"failure"},{"key":"Failure message","value":"Unable to generate the s3 link"}],"type":"set-var-multi","id":"PBX3sro0W11QZ","next":{"success":"PBXQ6uo9rxTcp","failure":"hangup"}},{"variable_name":"response","http_response_code":"404","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXQ6uo9rxTcp","next":{"success":"hangup","failure":"hangup"}},{"convert_from":"json","convert_to":"json_object","output_variable":"response","root_name":"","value_type":"hb","data":"{{{result}}}","type":"utils-convert","id":"PBXT0bDAFcXaT","next":{"success":"PBXXsvpT3kWRk","failure":"hangup"}}]},{"id":127285,"name":"DELETE_FILE","trigger":"rest","expression":"/storage/{app-name}/{dir}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXHXGaFrWk9b"}},{"fileName":"{{{request.path.app-name}}}/{{{session.tenant_id}}}/{{{session.user_id}}}/{{request.path.dir}}/{{request.params.file}}","bucket_name":"generic-apps","value_type":"hb","output_variable":"result","plugin_name":"s3-plugin","type":"s3-file-delete","id":"PBXHXGaFrWk9b","next":{"success":"PBXxe9A3AGbw1","failure":"PBXMlOu7bC87b"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Result","value":"success"},{"key":"code","value":"200"},{"key":"Message","value":"{{{result}}}"}],"type":"set-var-multi","id":"PBXxe9A3AGbw1","next":{"success":"PBXE6PDuRm9rx","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Result","value":"failure"},{"key":"code","value":"404"},{"key":"Message","value":"{{{result}}}"}],"type":"set-var-multi","id":"PBXMlOu7bC87b","next":{"success":"PBXE6PDuRm9rx","failure":"hangup"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXE6PDuRm9rx","next":{"success":"hangup","failure":"hangup"}}]},{"id":127482,"name":"SEND_NOTIFICATION","trigger":"rest","expression":"/notification/{app-name}/send/{account-id}/{user-id}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXFB2pnMZlz8"}},{"json_is":"true","json_name":"parameters","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"channel","value":"{{{request.path.app-name}}}-notify-all"},{"key":"message","value":"{{{request.body.message}}}"},{"key":"title","value":"{{{request.body.title}}}"}],"type":"set-var-multi","id":"PBXxiF3ynB443","next":{"success":"PBXHPHAapakcA","failure":"hangup"}},{"channel_name":"{{{parameters.channel}}}","name":"{{{parameters.title}}}","data":"{{{parameters.message}}}","value_type":"hb","output_variable":"response","plugin_name":"ably_plugin","type":"ably","id":"PBXHPHAapakcA","next":{"success":"PBXk9rL3rLRDt","failure":"PBXuTTf2tvGKA"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk9rL3rLRDt","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"unable to send notification"}],"type":"set-var-multi","id":"PBXuTTf2tvGKA","next":{"success":"PBXrCiBrxDMPB","failure":"hangup"}},{"variable_name":"response","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXrCiBrxDMPB","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"","if_type":"strlen","variable1":"{{{request.path.user-id}}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXFB2pnMZlz8","next":{"success":"PBXalEW5Rh6Aw","failure":"PBXNqLmlJak2v"}},{"json_is":"true","json_name":"parameters","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"channel","value":"{{{request.path.app-name}}}-notify-{{{session.user_id}}}"},{"key":"message","value":"{{{request.body.message}}}"},{"key":"title","value":"{{{request.body.title}}}"}],"type":"set-var-multi","id":"PBXRDB9TUnTmS","next":{"success":"PBXHPHAapakcA","failure":"hangup"}},{"output_variable":"","value_type":"hb","and_conditions":[{"if_type":"value","variable1":"{{request.path.account-id}}","comparator":"equal_to","variable2":"{{{session.tenant_id}}}"},{"if_type":"value","variable1":"{{request.path.user-id}}","comparator":"equal_to","variable2":"{{{session.user_id}}}"}],"or_conditions":[],"type":"condition","id":"PBXNqLmlJak2v","next":{"success":"PBXRDB9TUnTmS","failure":"PBX6ckWndJQdO"}},{"output_variable":"","if_type":"value","variable1":"{{request.path.account-id}}","comparator":"equal_to","variable2":"{{{session.tenant_id}}}","value_type":"hb","type":"if-condition","id":"PBXalEW5Rh6Aw","next":{"success":"PBXxiF3ynB443","failure":"PBXJn0TtEO9Ax"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Message","value":"Enter valid account id"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBXJn0TtEO9Ax","next":{"success":"PBXk9rL3rLRDt","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Message","value":"Enter valid account-id and user-id"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBX6ckWndJQdO","next":{"success":"PBXrCiBrxDMPB","failure":"hangup"}}]},{"id":127482,"name":"SEND_NOTIFICATION","trigger":"rest","expression":"/notification/{app-name}/send/{account-id}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXFB2pnMZlz8"}},{"json_is":"true","json_name":"parameters","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"channel","value":"{{{request.path.app-name}}}-notify-all"},{"key":"message","value":"{{{request.body.message}}}"},{"key":"title","value":"{{{request.body.title}}}"}],"type":"set-var-multi","id":"PBXxiF3ynB443","next":{"success":"PBXHPHAapakcA","failure":"hangup"}},{"channel_name":"{{{parameters.channel}}}","name":"{{{parameters.title}}}","data":"{{{parameters.message}}}","value_type":"hb","output_variable":"response","plugin_name":"ably_plugin","type":"ably","id":"PBXHPHAapakcA","next":{"success":"PBXk9rL3rLRDt","failure":"PBXuTTf2tvGKA"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk9rL3rLRDt","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"unable to send notification"}],"type":"set-var-multi","id":"PBXuTTf2tvGKA","next":{"success":"PBXrCiBrxDMPB","failure":"hangup"}},{"variable_name":"response","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXrCiBrxDMPB","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"","if_type":"strlen","variable1":"{{{request.path.user-id}}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXFB2pnMZlz8","next":{"success":"PBXalEW5Rh6Aw","failure":"PBXNqLmlJak2v"}},{"json_is":"true","json_name":"parameters","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"channel","value":"{{{request.path.app-name}}}-notify-{{{session.user_id}}}"},{"key":"message","value":"{{{request.body.message}}}"},{"key":"title","value":"{{{request.body.title}}}"}],"type":"set-var-multi","id":"PBXRDB9TUnTmS","next":{"success":"PBXHPHAapakcA","failure":"hangup"}},{"output_variable":"","value_type":"hb","and_conditions":[{"if_type":"value","variable1":"{{request.path.account-id}}","comparator":"equal_to","variable2":"{{{session.tenant_id}}}"},{"if_type":"value","variable1":"{{request.path.user-id}}","comparator":"equal_to","variable2":"{{{session.user_id}}}"}],"or_conditions":[],"type":"condition","id":"PBXNqLmlJak2v","next":{"success":"PBXRDB9TUnTmS","failure":"PBX6ckWndJQdO"}},{"output_variable":"","if_type":"value","variable1":"{{request.path.account-id}}","comparator":"equal_to","variable2":"{{{session.tenant_id}}}","value_type":"hb","type":"if-condition","id":"PBXalEW5Rh6Aw","next":{"success":"PBXxiF3ynB443","failure":"PBXJn0TtEO9Ax"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Message","value":"Enter valid account id"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBXJn0TtEO9Ax","next":{"success":"PBXk9rL3rLRDt","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Message","value":"Enter valid account-id and user-id"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBX6ckWndJQdO","next":{"success":"PBXrCiBrxDMPB","failure":"hangup"}}]},{"id":127547,"name":"SEND_EMAIL_WITHOUT_TEMPLATE","trigger":"rest","expression":"/email/{app-name}/send","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXznLxZlMDwL"}},{"output_variable":"","if_type":"strlen","variable1":"{{{request.body.from}}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXznLxZlMDwL","next":{"success":"PBXwd0aNVsK6H","failure":"PBX2RZm79wTTP"}},{"name":"from-email","value":"{{request.path.app-name}}@500apps.com","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwd0aNVsK6H","next":{"success":"PBXMFzVamvRrN","failure":"hangup"}},{"name":"from-email","value":"{{{request.body.from}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2RZm79wTTP","next":{"success":"PBXMFzVamvRrN","failure":"PBXPnyNR1fT0G"}},{"output_variable":"","if_type":"value","variable1":"{{{request.body.delete_attachment}}}","comparator":"equal_to","variable2":"yes","value_type":"hb","type":"if-condition","id":"PBXNbdqkFfTof","next":{"success":"PBXBHJxXJP3GF","failure":"PBXfQDhniz6h9"}},{"output_variable":"","if_type":"strlen","variable1":"{{request.body.attachment}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXMFzVamvRrN","next":{"success":"PBXwDDGuDbQba","failure":"PBXooH8Ei1T3W"}},{"fileName":"{{{request.body.attachment}}}","bucket_name":"generic-apps","value_type":"hb","output_variable":"result","plugin_name":"s3-plugin","type":"s3-file-delete","id":"PBXBHJxXJP3GF","next":{"success":"PBX4QwxF519kp","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"Successfully mail sent"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXJvRqAIr5FF","next":{"success":"PBXqIKFJu7Tva","failure":"hangup"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqIKFJu7Tva","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"Successfully mail sent"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXfQDhniz6h9","next":{"success":"PBXOwPg2hPc08","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"Unable to sent mail"},{"key":"code","value":"400"}],"type":"set-var-multi","id":"PBXPnyNR1fT0G","next":{"success":"PBXOwPg2hPc08","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"Unable to sent mail"},{"key":"code","value":"400"}],"type":"set-var-multi","id":"PBXWiCNGEUpuU","next":{"success":"PBXqIKFJu7Tva","failure":"hangup"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOwPg2hPc08","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"Successfully mail sent and attachment deleted successfully in s3"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBX4QwxF519kp","next":{"success":"PBXOwPg2hPc08","failure":"hangup"}},{"fileName":"{{{request.body.attachment}}}","output_variable":"filedata","value_type":"hb","bucketPath":"generic-apps","plugin_name":"s3-plugin","type":"s3-file-download","id":"PBXooH8Ei1T3W","next":{"success":"PBX9k8kmOqVUd","failure":"PBXPnyNR1fT0G"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"{{{request.path.app-name}}}","from_email":"{{{from-email}}}","to_email":"{{{request.body.to}}}","cc_email":"{{{request.body.cc}}}","bcc_email":"{{{request.body.bcc}}}","reply_to":"{{{request.body.replyto}}}","subject":"{{{request.body.sub}}}","body_type":"html_body","body":"{{{request.body.body}}}","type":"send-email","id":"PBXwDDGuDbQba","next":{"success":"PBXJvRqAIr5FF","failure":"PBXWiCNGEUpuU"}},{"utf_8":"","value_type":"hb","config_set":"","file_key":"filedata","plugin_name":"ses-plugin","from_name":"{{{request.path.app-name}}}","from_email":"{{{from-email}}}","to_email":"{{{request.body.to}}}","cc_email":"{{{request.body.cc}}}","bcc_email":"{{{request.body.bcc}}}","reply_to":"{{{request.body.replyto}}}","subject":"{{{request.body.sub}}}","html_body":"{{{request.body.Body}}}","text_body":"","type":"send-email-with-attachment","id":"PBX9k8kmOqVUd","next":{"success":"PBXNbdqkFfTof","failure":"PBXPnyNR1fT0G"}}]},{"id":127571,"name":"FILE_LIST","trigger":"rest","expression":"/storage/{app-name}/{tenant-id}/{user-id}/{dir}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBX5vuPsbTX3N"}},{"value_type":"hb","plugin_name":"s3-plugin","bucket_name":"generic-apps","output_variable":"file_list","file_key":"{{{request.path.app-name}}}/{{{request.path.tenant-id}}}/{{{request.path.user-id}}}/{{{request.path.dir}}}","type":"s3-file-list","id":"PBX5vuPsbTX3N","next":{"success":"PBXl1W2J2safW","failure":"PBXVF1RT1wQPg"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJA9W9qZnfK","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"unable to get files"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBXVF1RT1wQPg","next":{"success":"PBXJA9W9qZnfK","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"file_list","value":"{{{file_list}}}"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXl1W2J2safW","next":{"success":"PBXJA9W9qZnfK","failure":"hangup"}}]},{"id":127704,"name":"TEMPLATE_DATA_EMAIL","trigger":"rest","expression":"/email/{app-name}/{table_name}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXyo7ZLTZO8o"}},{"plugin_name":"sql-plugin","value":"INSERT INTO `{{request.path.table_name}}` (OWNER_ID,TEMPLATE_NAME,TEMPLATE_DATA) VALUES ('{{session.user_id}}','{{request.path.app-name}}','{{{template_data}}}');","value_type":"hb","output_variable":"insert_output","type":"sql-insert","id":"PBXQ9JCkrugN0","next":{"success":"PBXBkwvrWZ0Zu","failure":"PBXT6CQf7Xsfb"}},{"variable_name":"insert_output","http_response_code":"404","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT6CQf7Xsfb","next":{"success":"hangup","failure":"hangup"}},{"value":"{\"crm_invite\": {\"sub\": \"{{{session.email}}}, You have been invited\",\"body\": \"Dear {{{session.email}}}, you are invited by {{request.body.admin_name}}\"}}","value_type":"hb","output_variable":"template_data","type":"template","id":"PBXyo7ZLTZO8o","next":{"success":"PBXQ9JCkrugN0","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"GENERATED_KEY","value":"{{{insert_output.GENERATED_KEY}}}"},{"key":"TEMPLATE_NAME","value":"{{request.path.app-name}}"}],"type":"set-var-multi","id":"PBXBkwvrWZ0Zu","next":{"success":"PBXa7h91vsWyp","failure":"hangup"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXa7h91vsWyp","next":{"success":"hangup","failure":"hangup"}}]},{"id":127725,"name":"SEND_EMAIL_WITH_TEMPLATE","trigger":"rest","expression":"/email/{app-name}/send/{template}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXpDMvDadgzs"}},{"output_variable":"","if_type":"strlen","variable1":"{{{request.body.From}}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXznLxZlMDwL","next":{"success":"PBXwd0aNVsK6H","failure":"PBX2RZm79wTTP"}},{"name":"from-email","value":"{{request.path.app-name}}@500apps.com","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwd0aNVsK6H","next":{"success":"PBXMFzVamvRrN","failure":"hangup"}},{"name":"from-email","value":"{{{request.body.From}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2RZm79wTTP","next":{"success":"PBXMFzVamvRrN","failure":"PBXPnyNR1fT0G"}},{"output_variable":"","if_type":"value","variable1":"{{{request.body.delete_attachment}}}","comparator":"equal_to","variable2":"yes","value_type":"hb","type":"if-condition","id":"PBXNbdqkFfTof","next":{"success":"PBXBHJxXJP3GF","failure":"PBXfQDhniz6h9"}},{"output_variable":"","if_type":"strlen","variable1":"{{request.body.attachment}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXMFzVamvRrN","next":{"success":"PBXQUILOqFtEz","failure":"PBXooH8Ei1T3W"}},{"fileName":"{{{request.body.attachment}}}","bucket_name":"generic-apps","value_type":"hb","output_variable":"result","plugin_name":"s3-plugin","type":"s3-file-delete","id":"PBXBHJxXJP3GF","next":{"success":"PBX4QwxF519kp","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"Successfully mail sent"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXJvRqAIr5FF","next":{"success":"PBXqIKFJu7Tva","failure":"hangup"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqIKFJu7Tva","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"Successfully mail sent"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXfQDhniz6h9","next":{"success":"PBXOwPg2hPc08","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"Unable to sent mail"},{"key":"code","value":"400"}],"type":"set-var-multi","id":"PBXPnyNR1fT0G","next":{"success":"PBXOwPg2hPc08","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"Unable to sent mail"},{"key":"code","value":"400"}],"type":"set-var-multi","id":"PBXWiCNGEUpuU","next":{"success":"PBXqIKFJu7Tva","failure":"hangup"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOwPg2hPc08","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"Successfully mail sent and attachment deleted successfully in s3"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBX4QwxF519kp","next":{"success":"PBXOwPg2hPc08","failure":"hangup"}},{"fileName":"{{{request.body.attachment}}}","output_variable":"filedata","value_type":"hb","bucketPath":"generic-apps","plugin_name":"s3-plugin","type":"s3-file-download","id":"PBXooH8Ei1T3W","next":{"success":"PBXAWTv8HL1nM","failure":"PBXPnyNR1fT0G"}},{"plugin_name":"sql-plugin","value":"select * from TEMPLATE_INFO where TEMPLATE_NAME='{{{request.path.template}}}'\r\n","value_type":"hb","output_variable":"app_record","type":"sql-one","id":"PBXpDMvDadgzs","next":{"success":"PBXuTZVzUEA2Z","failure":"PBXPnyNR1fT0G"}},{"convert_from":"json","convert_to":"json_object","output_variable":"response","root_name":"","value_type":"hb","data":"{{{app_record.TEMPLATE_DATA}}}","type":"utils-convert","id":"PBXuTZVzUEA2Z","next":{"success":"PBXznLxZlMDwL","failure":"PBXPnyNR1fT0G"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"{{{request.path.app-name}}}","from_email":"{{{from-email}}}","to_email":"{{{request.body.to}}}","cc_email":"{{{request.body.cc}}}","bcc_email":"{{{request.body.bcc}}}","reply_to":"{{{request.body.replyto}}}","subject":"{{{response.crm_invite.sub}}}","body_type":"html_body","body":"{{{response.crm_invite.body}}}","type":"send-email","id":"PBXQUILOqFtEz","next":{"success":"PBXJvRqAIr5FF","failure":"PBXWiCNGEUpuU"}},{"utf_8":"","value_type":"hb","config_set":"","file_key":"filedata","plugin_name":"ses-plugin","from_name":"{{{request.path.app-name}}}","from_email":"{{{from-email}}}","to_email":"{{{request.body.to}}}","cc_email":"{{{request.body.cc}}}","bcc_email":"{{{request.body.bcc}}}","reply_to":"{{{request.body.replyto}}}","subject":"{{{response.crm_invite.sub}}}","html_body":"{{{response.crm_invite.body}}}","text_body":"","type":"send-email-with-attachment","id":"PBXAWTv8HL1nM","next":{"success":"PBXNbdqkFfTof","failure":"PBXPnyNR1fT0G"}}]},{"id":129952,"name":"SEND_GRID_INBOUND","trigger":"rest","expression":"/sendgrid/inbound","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXKEtMluiGzK"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"appup","from_email":"noreply@500apps.com","to_email":"sujatha.kolluri@500apps.com","cc_email":"","bcc_email":"","subject":"{{{emails}}}","body_type":"html_body","body":"{{{jsonstr request.body}}}","type":"send-email","id":"PBXZS4gvPva1Q","next":{"success":"PBXH5GI7l3XrI","failure":"hangup"}},{"name":"to_email","value":"{{{payload.to}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX7vFJrVTyKa","next":{"success":"PBXgFrhLviQxD","failure":"hangup"}},{"variable_name":"emails","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXAIGetyVcce","next":{"success":"hangup","failure":"hangup"}},{"convert_from":"json","convert_to":"json_object","output_variable":"payload","root_name":"","value_type":"hb","data":"{{{jsonstr request.body}}}","type":"utils-convert","id":"PBXKEtMluiGzK","next":{"success":"PBX7vFJrVTyKa","failure":"hangup"}},{"src":"var email=map.to_email;\r\nvar email2=email.substring(0,email.indexOf('@'));\r\nvar email3=email2.split('-');\r\nvar email4;\r\nif(email3[2] ==  null){\r\n    map.emails=email2;\r\n   }\r\nelse{\r\n    email4=email2.replace(email3[2],\"id\");\r\n   map.emails=email4;\r\n    }","inline":"true","type":"code-js","id":"PBXgFrhLviQxD","next":{"success":"PBXZS4gvPva1Q","failure":"hangup"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"{{{emails}}}","delivery_mode":"2","scheduled_delay":"","scheduled_period":"","scheduled_repeat":"","scheduled_cron":"","messages":[{"key":"{{{jsonstr request.body}}}"}],"type":"active-mq-producer","id":"PBXhO1N4JgP3V","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"{{{emails}}}","delivery_mode":"2","scheduled_delay":"","scheduled_period":"","scheduled_repeat":"","scheduled_cron":"","messages":[{"key":"{{{jsonstr request.body}}}","value":"4"}],"type":"active-mq-producer","id":"PBXH5GI7l3XrI","next":{"success":"hangup","failure":"hangup"}}]},{"id":132757,"name":"DB_CACHE","trigger":"rest","expression":"/cache/{app-name}/{time-to-expire-in-secs}/{type}/{key}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXXktlOXb50O"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXE9tzaksKOQ","next":{"success":"PBXOkNHaCkS6E","failure":"PBXWl1rT7qclS"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBX9TaPNINpDk","next":{"success":"PBXt8epvHfMfl","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOkNHaCkS6E","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXWl1rT7qclS","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwL7D0GybhL","next":{"success":"PBX9TaPNINpDk","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXktlOXb50O","next":{"success":"PBXEBFwuZKKoe","failure":"hangup"}},{"output_variable":"data","if_type":"value","variable1":"{{count}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXkZ6yafdlDw","next":{"success":"PBXE9tzaksKOQ","failure":"PBX6eCrVUdNcZ"}},{"plugin_name":"sql-plugin","value":"update KEY_VALUE set `key`='{{{key}}}',value='{{{value}}}', expire_time=(UNIX_TIMESTAMP()+{{{expaire}}})*1000 where `key`='{{{key}}}';","value_type":"hb","output_variable":"update","type":"sql-update","id":"PBX6eCrVUdNcZ","next":{"success":"PBXqTfOhhbGmp","failure":"PBX14TC1VGwNV"}},{"variable_name":"update","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqTfOhhbGmp","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"update","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX14TC1VGwNV","next":{"success":"hangup","failure":"hangup"}},{"name":"count","value":"{{{countinfo.count}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGnmSVheEk2","next":{"success":"PBXkZ6yafdlDw","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select count(`key`)  as count from KEY_VALUE WHERE `key`= '{{{key}}}';","value_type":"hb","output_variable":"countinfo","type":"sql-one","id":"PBXt8epvHfMfl","next":{"success":"PBXGnmSVheEk2","failure":"hangup"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXEBFwuZKKoe","next":{"POST":"PBXwL7D0GybhL","PUT":"PBXJEcOdVflCh","GET":"PBXJW6hqx5I14","DELETE":"PBXFaPIPThkIF"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXEXfs7hTVMk","next":{"success":"PBX0fOFkG150m","failure":"PBXk6ddf7KH4d"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX0fOFkG150m","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk6ddf7KH4d","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXJW6hqx5I14","next":{"success":"PBXVTs5gt2p9t","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJEcOdVflCh","next":{"success":"PBXOQvOWRcDKQ","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXOQvOWRcDKQ","next":{"success":"PBXEXfs7hTVMk","failure":"hangup"}},{"src":"var id='{{{request.path.CSV-keys}}}';\r\nvar resp='';\r\nif(id=='undefined'|| id == null || id == ''){\r\nresp = 1;\r\n\r\n}else{\r\nresp = 0;\r\n}\r\nmap.resp = resp;","inline":"true","type":"code-js","id":"PBXFaPIPThkIF","next":{"success":"PBXbVLmtX9M74","failure":"hangup"}},{"output_variable":"s","if_type":"value","variable1":"{{resp}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXbVLmtX9M74","next":{"success":"PBXKmvNlQOUMQ","failure":"PBXE0cbweECGF"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` like '%{{{request.path.key}}}%';","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXKmvNlQOUMQ","next":{"success":"PBX7HfJt1cTVb","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX7HfJt1cTVb","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXE0cbweECGF","next":{"success":"PBXBwbQFJKkoh","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` in ({{{key}}});","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXBwbQFJKkoh","next":{"success":"PBX8EvDqUHIUP","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX8EvDqUHIUP","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select `key`,value from KEY_VALUE where expire_time in( select expire_time from KEY_VALUE where expire_time >= unix_timestamp()*1000) and\r\n`key` in({{{key}}});","value_type":"hb","output_variable":"data","type":"sql","id":"PBXVTs5gt2p9t","next":{"success":"PBXieF1u0AcTG","failure":"PBXT2PD6tzGvD"}},{"variable_name":"array","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXhnECw9bgeh","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"data","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT2PD6tzGvD","next":{"success":"hangup","failure":"hangup"}},{"src":"var x = map.data;\r\nvar array = [];\r\n//if(x.length !== 0){\r\nvar valarray = [];\r\nvar len = 0;\r\nvar obj = {};\r\nvar keyarray = [];\r\nvar xlength = x.length;\r\nvar i = 0;\r\nfor(i;i< xlength;i++){\r\n    if(array.length !== 0){\r\n        len = array.length;\r\n        var count = 0;\r\n         for(var j =0;j<len;j++){\r\n            if(array[j].key ===x[i].key){\r\n                count++;\r\n            }}\r\n        for(var j =0;j<len;j++){\r\n            \r\n            if(count>0){\r\n                    if(array[j].key === x[i].key){\r\n                        array[j].value.push(x[i].value);\r\n                  }\r\n                \r\n            }else{\r\n                keyarray.push(x[i].key);\r\n                obj = {};\r\n                valarray = [];\r\n                obj.key = x[i].key;\r\n                valarray.push(x[i].value);\r\n                obj.value = valarray;\r\n                array.push(obj);\r\n            }\r\n        } \r\n    }else{\r\n        keyarray.push(x[i].key);\r\n        obj.key = x[i].key;\r\n        valarray.push(x[i].value);\r\n        obj.value = valarray;\r\n        array.push(obj);\r\n    }\r\n    \r\n}\r\nprint(JSON.stringify(array));\r\nmap.array =JSON.stringify(array);\r\n//}else{\r\n//print(JSON.stringify(array));\r\n//map.array =JSON.stringify(map.data);\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXieF1u0AcTG","next":{"success":"PBXhnECw9bgeh","failure":"hangup"}}]},{"id":132751,"name":"ASYNC_CALL_PRODUCE","trigger":"rest","expression":"/a/{method}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBX7gWXauTcM6"}},{"json_is":"true","json_name":"data","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Target-url","value":"{{{request.headers.target-url}}}"},{"key":"Callback-url","value":"{{request.headers.callback-url}}"},{"key":"DATA","value":"{{{jsonstr request.body}}}"},{"key":"method","value":"{{{request.path.method}}}"},{"key":"headers","value":"{{{jsonstr request.headers}}}"},{"key":"callback-method","value":"{{{request.headers.callback-method}}}"}],"type":"set-var-multi","id":"PBX7gWXauTcM6","next":{"success":"PBXFuPJOPPegE","failure":"PBXIChPILQc4y"}},{"plugin_name":"sql-plugin","value":"insert into ASYNC_DATA (URL,METHOD,HEADERS,DATA,CALLBACK_URL,CALLBACK_METHOD) values('{{{data.Target-url}}}','{{{request.path.method}}}','{{{headerjson}}}','{{{data.DATA}}}','{{{data.Callback-url}}}','{{{data.callback-method}}}');","value_type":"hb","output_variable":"insert_output","type":"sql-insert","id":"PBXTMXBvtS5t6","next":{"success":"PBXh6W63rxDzJ","failure":"PBXXmKm6XiMXk"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"async","delivery_mode":"2","scheduled_delay":"","scheduled_period":"","scheduled_repeat":"","scheduled_cron":"","messages":[{"key":"{{{insert_output.GENERATED_KEY}}}","value":"4"}],"type":"active-mq-producer","id":"PBXh6W63rxDzJ","next":{"success":"PBX3XnGx8nuu8","failure":"PBXIChPILQc4y"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"id","value":"{{{insert_output.GENERATED_KEY}}}"}],"type":"set-var-multi","id":"PBXGPreKvKHc6","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXUUpeTkHU1z","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"error_response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"inavalid data"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBXIChPILQc4y","next":{"success":"PBXd1xRtdNwny","failure":"hangup"}},{"variable_name":"error_response","http_response_code":"{{error_response.code}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXd1xRtdNwny","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insert_output","http_response_code":"404","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXXmKm6XiMXk","next":{"success":"hangup","failure":"hangup"}},{"src":"var headers=JSON.parse(map.data.headers);print('--------------------'+headers);delete headers ['target-url']; delete headers ['callback-url'];delete headers ['Host'];delete headers ['accept-encoding'];delete headers ['Accept'];delete headers ['Cache-Control'];delete headers ['User-Agent'];delete headers ['Connection'];delete headers ['Postman-Token'];delete headers ['Accept-Encoding'];map.headerjson=JSON.stringify(headers);","inline":"true","type":"code-js","id":"PBXFuPJOPPegE","next":{"success":"PBXTMXBvtS5t6","failure":"PBXIChPILQc4y"}},{"src":"var obj={};\r\nobj[\"status\"] = \"success\";\r\nobj[\"id\"] = {{{insert_output.GENERATED_KEY}}};\r\nmap.response = JSON.stringify(obj);\r\n","inline":"true","type":"code-js","id":"PBX3XnGx8nuu8","next":{"success":"PBXUUpeTkHU1z","failure":"PBXIChPILQc4y"}}]},{"id":132848,"name":"1_GENERATE_VAPID_KEYS","trigger":"rest","expression":"/webpush/vapidkeys","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXzHUawwpoyN"}},{"plugin_name":"sql-plugin","value":"SELECT ID FROM {{{app.app_info_table}}} where user_id='{{request.body.user_id}}'","value_type":"hb","output_variable":"ID","type":"sql-one","id":"PBXzHUawwpoyN","next":{"success":"PBXnvExTzOlMT","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"{{{ID.ID}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXnvExTzOlMT","next":{"success":"PBXezZW1eBRXE","failure":"PBXyIMobsNzSC"}},{"param_spec":"prime256v1","output_variable":"vapid","type":"vapid-key","id":"PBXmpvwbyqv4n","next":{"success":"PBX8rld2zSF82","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"Insert into {{{app.vapid_key_table}}}(PUBLIC_KEY, PRIVATE_KEY, USER_ID) values ('{{{vapid_public}}}','{{{vapid_private}}}','{{{request.body.user_id}}}');","value_type":"hb","output_variable":"vapid_out","type":"sql-insert","id":"PBX8rld2zSF82","next":{"success":"PBXTgbKOsOsog","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"private_key","value":"{{{vapid_private}}}"},{"key":"public_key","value":"{{{vapid_public}}}"}],"type":"set-var-multi","id":"PBXTgbKOsOsog","next":{"success":"PBXL9OM2NzKwl","failure":"hangup"}},{"variable_name":"response","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBXL9OM2NzKwl","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"{{{vapid_user_size}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX1RptIQA76T","next":{"success":"PBXBqZ5coJIdy","failure":"PBXmpvwbyqv4n"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"private_key","value":"{{{vapid_user.0.PRIVATE_KEY}}}"},{"key":"public_key","value":"{{{vapid_user.0.PUBLIC_KEY}}}"}],"type":"set-var-multi","id":"PBXBqZ5coJIdy","next":{"success":"PBXL9OM2NzKwl","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"SELECT PUBLIC_KEY,PRIVATE_KEY FROM {{{app.vapid_key_table}}} where user_id='{{{request.body.user_id}}}'","value_type":"hb","output_variable":"vapid_user","type":"sql","id":"PBXezZW1eBRXE","next":{"success":"PBX1RptIQA76T","failure":"hangup"}},{"json_is":"true","json_name":"resp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"User doesn't exist"},{"key":"help","value":"register the user first with /register"}],"type":"set-var-multi","id":"PBXyIMobsNzSC","next":{"success":"PBX5vEnAd28zU","failure":"hangup"}},{"variable_name":"resp","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBX5vEnAd28zU","next":{"success":"hangup","failure":"hangup"}}]},{"id":132849,"name":"2_SAVE_SUBSCRIPTION_OBJECT","trigger":"rest","expression":"/webpush/subscription","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBX85KtSCTssf"}},{"plugin_name":"sql-plugin","value":"select count(PUBLIC_KEY) as counter from {{{app.subscription_table}}} where PUBLIC_KEY='{{{request.body.public_key}}}';","value_type":"hb","output_variable":"vapidCounter","type":"sql-one","id":"PBX85KtSCTssf","next":{"success":"PBXr4o7FPDrNS","failure":"hangup"}},{"output_variable":"opt","if_type":"strlen","variable1":"{{{vapidCounter.counter}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXr4o7FPDrNS","next":{"success":"PBXTqal4CqBvy","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"insert into {{{app.subscription_table}}}(SUBSCRIPTION_OBJ,PUBLIC_KEY) values ('{{{request.body.subscription}}}','{{{request.body.public_key}}}')","value_type":"hb","output_variable":"sub_out","type":"sql-insert","id":"PBXUaf5BrcRgm","next":{"success":"PBXsr0QH5zsXk","failure":"PBXJRggn7TblN"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Subscribed successfully."},{"key":"key","value":"{{{sub_out.GENERATED_KEY}}}"}],"type":"set-var-multi","id":"PBXsr0QH5zsXk","next":{"success":"PBXkDiDTrUgp0","failure":"hangup"}},{"variable_name":"response","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBXkDiDTrUgp0","next":{"success":"hangup","failure":"hangup"}},{"name":"response","value":"Save subscription failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJRggn7TblN","next":{"success":"PBXkDiDTrUgp0","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select count(PUBLIC_KEY) as counter2 from {{{app.subscription_table}}} where PUBLIC_KEY='{{{request.body.public_key}}}';","value_type":"hb","output_variable":"pub_key_counter","type":"sql-one","id":"PBXTqal4CqBvy","next":{"success":"PBXg4GSn36iHn","failure":"hangup"}},{"output_variable":"opt","if_type":"strlen","variable1":"{{{pub_key_counter.counter2}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXg4GSn36iHn","next":{"success":"PBXUaf5BrcRgm","failure":"PBXNWNZDK07dL"}},{"name":"response","value":"Subscription object is already exist.","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNWNZDK07dL","next":{"success":"PBXkDiDTrUgp0","failure":"hangup"}}]},{"id":132850,"name":"3_PUSH_A_NOTIFICATION","trigger":"rest","expression":"/webpush/push","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXGsQh5RDd0w"}},{"plugin_name":"sql-plugin","value":"SELECT ID FROM {{{app.app_info_table}}} where user_id='{{request.body.user_id}}'","value_type":"hb","output_variable":"ID","type":"sql-one","id":"PBXGsQh5RDd0w","next":{"success":"PBXdUireI8w3s","failure":"hangup"}},{"output_variable":"","if_type":"strlen","variable1":"{{{ID.ID}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXdUireI8w3s","next":{"success":"PBX6NLobmKTmR","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select SUBSCRIPTION_OBJ from {{{app.subscription_table}}} where PUBLIC_KEY='{{{keys.PUBLIC_KEY}}}' LIMIT 1000;","value_type":"hb","output_variable":"subs","type":"sql","id":"PBXCpVdIvDyUH","next":{"success":"PBXMdyqsA5PJr","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"{{{subs_size}}}","comparator":"greater_than","variable2":"{{{varone}}}","value_type":"hb","type":"if-condition","id":"PBXfrgs1titBu","next":{"success":"PBXxemNVsvkTo","failure":"hangup"}},{"name":"varone","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdyqsA5PJr","next":{"success":"PBXfrgs1titBu","failure":"hangup"}},{"name":"sub_data","value":"{{#extract index='varone' value='SUBSCRIPTION_OBJ' }} {{{jsonstr subs}}} {{/extract}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXxemNVsvkTo","next":{"success":"PBXJrRRaotCep","failure":"hangup"}},{"convert_from":"json","convert_to":"json_object","output_variable":"subscriptionData","root_name":"","value_type":"hb","data":"{{{sub_data}}}","type":"utils-convert","id":"PBXJrRRaotCep","next":{"success":"PBXl2r1QvtLC0","failure":"hangup"}},{"public_key":"{{{keys.PUBLIC_KEY}}}","private_key":"{{{keys.PRIVATE_KEY}}}","p256dh":"{{{subscriptionData.keys.p256dh}}}","auth":"{{{subscriptionData.keys.auth}}}","end_point":"{{{subscriptionData.endpoint}}}","title":"{{{request.body.title}}}","message":"{{{request.body.message}}}","click_target":"{{{request.body.click_target}}}","value_type":"hb","async_send":"true","output_variable":"out","type":"custom-web-push","id":"PBXl2r1QvtLC0","next":{"success":"PBXwSlhqxcMlb","failure":"hangup"}},{"name":"varone","value":"<#assign num = varone?number><#setting number_format=\"computer\">${num+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwSlhqxcMlb","next":{"success":"PBXfrgs1titBu","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"SELECT PUBLIC_KEY,PRIVATE_KEY FROM {{{app.vapid_key_table}}} where user_id='{{request.body.user_id}}'","value_type":"hb","output_variable":"keys","type":"sql-one","id":"PBX6NLobmKTmR","next":{"success":"PBXCpVdIvDyUH","failure":"hangup"}}]},{"id":132757,"name":"DB_CACHE","trigger":"rest","expression":"/cache/{app-name}/{time-to-expire-in-secs}/{type}/{key}","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXXktlOXb50O"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXE9tzaksKOQ","next":{"success":"PBXOkNHaCkS6E","failure":"PBXWl1rT7qclS"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBX9TaPNINpDk","next":{"success":"PBXt8epvHfMfl","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOkNHaCkS6E","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXWl1rT7qclS","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwL7D0GybhL","next":{"success":"PBX9TaPNINpDk","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXktlOXb50O","next":{"success":"PBXEBFwuZKKoe","failure":"hangup"}},{"output_variable":"data","if_type":"value","variable1":"{{count}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXkZ6yafdlDw","next":{"success":"PBXE9tzaksKOQ","failure":"PBX6eCrVUdNcZ"}},{"plugin_name":"sql-plugin","value":"update KEY_VALUE set `key`='{{{key}}}',value='{{{value}}}', expire_time=(UNIX_TIMESTAMP()+{{{expaire}}})*1000 where `key`='{{{key}}}';","value_type":"hb","output_variable":"update","type":"sql-update","id":"PBX6eCrVUdNcZ","next":{"success":"PBXqTfOhhbGmp","failure":"PBX14TC1VGwNV"}},{"variable_name":"update","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqTfOhhbGmp","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"update","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX14TC1VGwNV","next":{"success":"hangup","failure":"hangup"}},{"name":"count","value":"{{{countinfo.count}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGnmSVheEk2","next":{"success":"PBXkZ6yafdlDw","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select count(`key`)  as count from KEY_VALUE WHERE `key`= '{{{key}}}';","value_type":"hb","output_variable":"countinfo","type":"sql-one","id":"PBXt8epvHfMfl","next":{"success":"PBXGnmSVheEk2","failure":"hangup"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXEBFwuZKKoe","next":{"POST":"PBXwL7D0GybhL","PUT":"PBXJEcOdVflCh","GET":"PBXJW6hqx5I14","DELETE":"PBXFaPIPThkIF"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXEXfs7hTVMk","next":{"success":"PBX0fOFkG150m","failure":"PBXk6ddf7KH4d"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX0fOFkG150m","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk6ddf7KH4d","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXJW6hqx5I14","next":{"success":"PBXVTs5gt2p9t","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJEcOdVflCh","next":{"success":"PBXOQvOWRcDKQ","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXOQvOWRcDKQ","next":{"success":"PBXEXfs7hTVMk","failure":"hangup"}},{"src":"var id='{{{request.path.CSV-keys}}}';\r\nvar resp='';\r\nif(id=='undefined'|| id == null || id == ''){\r\nresp = 1;\r\n\r\n}else{\r\nresp = 0;\r\n}\r\nmap.resp = resp;","inline":"true","type":"code-js","id":"PBXFaPIPThkIF","next":{"success":"PBXbVLmtX9M74","failure":"hangup"}},{"output_variable":"s","if_type":"value","variable1":"{{resp}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXbVLmtX9M74","next":{"success":"PBXKmvNlQOUMQ","failure":"PBXE0cbweECGF"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` like '%{{{request.path.key}}}%';","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXKmvNlQOUMQ","next":{"success":"PBX7HfJt1cTVb","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX7HfJt1cTVb","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXE0cbweECGF","next":{"success":"PBXBwbQFJKkoh","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` in ({{{key}}});","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXBwbQFJKkoh","next":{"success":"PBX8EvDqUHIUP","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX8EvDqUHIUP","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select `key`,value from KEY_VALUE where expire_time in( select expire_time from KEY_VALUE where expire_time >= unix_timestamp()*1000) and\r\n`key` in({{{key}}});","value_type":"hb","output_variable":"data","type":"sql","id":"PBXVTs5gt2p9t","next":{"success":"PBXieF1u0AcTG","failure":"PBXT2PD6tzGvD"}},{"variable_name":"array","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXhnECw9bgeh","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"data","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT2PD6tzGvD","next":{"success":"hangup","failure":"hangup"}},{"src":"var x = map.data;\r\nvar array = [];\r\n//if(x.length !== 0){\r\nvar valarray = [];\r\nvar len = 0;\r\nvar obj = {};\r\nvar keyarray = [];\r\nvar xlength = x.length;\r\nvar i = 0;\r\nfor(i;i< xlength;i++){\r\n    if(array.length !== 0){\r\n        len = array.length;\r\n        var count = 0;\r\n         for(var j =0;j<len;j++){\r\n            if(array[j].key ===x[i].key){\r\n                count++;\r\n            }}\r\n        for(var j =0;j<len;j++){\r\n            \r\n            if(count>0){\r\n                    if(array[j].key === x[i].key){\r\n                        array[j].value.push(x[i].value);\r\n                  }\r\n                \r\n            }else{\r\n                keyarray.push(x[i].key);\r\n                obj = {};\r\n                valarray = [];\r\n                obj.key = x[i].key;\r\n                valarray.push(x[i].value);\r\n                obj.value = valarray;\r\n                array.push(obj);\r\n            }\r\n        } \r\n    }else{\r\n        keyarray.push(x[i].key);\r\n        obj.key = x[i].key;\r\n        valarray.push(x[i].value);\r\n        obj.value = valarray;\r\n        array.push(obj);\r\n    }\r\n    \r\n}\r\nprint(JSON.stringify(array));\r\nmap.array =JSON.stringify(array);\r\n//}else{\r\n//print(JSON.stringify(array));\r\n//map.array =JSON.stringify(map.data);\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXieF1u0AcTG","next":{"success":"PBXhnECw9bgeh","failure":"hangup"}}]},{"id":132757,"name":"DB_CACHE","trigger":"rest","expression":"/cache/{app-name}/{type}/{key}/keys/{CSV-keys}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXXktlOXb50O"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXE9tzaksKOQ","next":{"success":"PBXOkNHaCkS6E","failure":"PBXWl1rT7qclS"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBX9TaPNINpDk","next":{"success":"PBXt8epvHfMfl","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOkNHaCkS6E","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXWl1rT7qclS","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwL7D0GybhL","next":{"success":"PBX9TaPNINpDk","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXktlOXb50O","next":{"success":"PBXEBFwuZKKoe","failure":"hangup"}},{"output_variable":"data","if_type":"value","variable1":"{{count}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXkZ6yafdlDw","next":{"success":"PBXE9tzaksKOQ","failure":"PBX6eCrVUdNcZ"}},{"plugin_name":"sql-plugin","value":"update KEY_VALUE set `key`='{{{key}}}',value='{{{value}}}', expire_time=(UNIX_TIMESTAMP()+{{{expaire}}})*1000 where `key`='{{{key}}}';","value_type":"hb","output_variable":"update","type":"sql-update","id":"PBX6eCrVUdNcZ","next":{"success":"PBXqTfOhhbGmp","failure":"PBX14TC1VGwNV"}},{"variable_name":"update","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqTfOhhbGmp","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"update","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX14TC1VGwNV","next":{"success":"hangup","failure":"hangup"}},{"name":"count","value":"{{{countinfo.count}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGnmSVheEk2","next":{"success":"PBXkZ6yafdlDw","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select count(`key`)  as count from KEY_VALUE WHERE `key`= '{{{key}}}';","value_type":"hb","output_variable":"countinfo","type":"sql-one","id":"PBXt8epvHfMfl","next":{"success":"PBXGnmSVheEk2","failure":"hangup"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXEBFwuZKKoe","next":{"POST":"PBXwL7D0GybhL","PUT":"PBXJEcOdVflCh","GET":"PBXJW6hqx5I14","DELETE":"PBXFaPIPThkIF"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXEXfs7hTVMk","next":{"success":"PBX0fOFkG150m","failure":"PBXk6ddf7KH4d"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX0fOFkG150m","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk6ddf7KH4d","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXJW6hqx5I14","next":{"success":"PBXVTs5gt2p9t","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJEcOdVflCh","next":{"success":"PBXOQvOWRcDKQ","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXOQvOWRcDKQ","next":{"success":"PBXEXfs7hTVMk","failure":"hangup"}},{"src":"var id='{{{request.path.CSV-keys}}}';\r\nvar resp='';\r\nif(id=='undefined'|| id == null || id == ''){\r\nresp = 1;\r\n\r\n}else{\r\nresp = 0;\r\n}\r\nmap.resp = resp;","inline":"true","type":"code-js","id":"PBXFaPIPThkIF","next":{"success":"PBXbVLmtX9M74","failure":"hangup"}},{"output_variable":"s","if_type":"value","variable1":"{{resp}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXbVLmtX9M74","next":{"success":"PBXKmvNlQOUMQ","failure":"PBXE0cbweECGF"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` like '%{{{request.path.key}}}%';","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXKmvNlQOUMQ","next":{"success":"PBX7HfJt1cTVb","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX7HfJt1cTVb","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXE0cbweECGF","next":{"success":"PBXBwbQFJKkoh","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` in ({{{key}}});","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXBwbQFJKkoh","next":{"success":"PBX8EvDqUHIUP","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX8EvDqUHIUP","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select `key`,value from KEY_VALUE where expire_time in( select expire_time from KEY_VALUE where expire_time >= unix_timestamp()*1000) and\r\n`key` in({{{key}}});","value_type":"hb","output_variable":"data","type":"sql","id":"PBXVTs5gt2p9t","next":{"success":"PBXieF1u0AcTG","failure":"PBXT2PD6tzGvD"}},{"variable_name":"array","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXhnECw9bgeh","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"data","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT2PD6tzGvD","next":{"success":"hangup","failure":"hangup"}},{"src":"var x = map.data;\r\nvar array = [];\r\n//if(x.length !== 0){\r\nvar valarray = [];\r\nvar len = 0;\r\nvar obj = {};\r\nvar keyarray = [];\r\nvar xlength = x.length;\r\nvar i = 0;\r\nfor(i;i< xlength;i++){\r\n    if(array.length !== 0){\r\n        len = array.length;\r\n        var count = 0;\r\n         for(var j =0;j<len;j++){\r\n            if(array[j].key ===x[i].key){\r\n                count++;\r\n            }}\r\n        for(var j =0;j<len;j++){\r\n            \r\n            if(count>0){\r\n                    if(array[j].key === x[i].key){\r\n                        array[j].value.push(x[i].value);\r\n                  }\r\n                \r\n            }else{\r\n                keyarray.push(x[i].key);\r\n                obj = {};\r\n                valarray = [];\r\n                obj.key = x[i].key;\r\n                valarray.push(x[i].value);\r\n                obj.value = valarray;\r\n                array.push(obj);\r\n            }\r\n        } \r\n    }else{\r\n        keyarray.push(x[i].key);\r\n        obj.key = x[i].key;\r\n        valarray.push(x[i].value);\r\n        obj.value = valarray;\r\n        array.push(obj);\r\n    }\r\n    \r\n}\r\nprint(JSON.stringify(array));\r\nmap.array =JSON.stringify(array);\r\n//}else{\r\n//print(JSON.stringify(array));\r\n//map.array =JSON.stringify(map.data);\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXieF1u0AcTG","next":{"success":"PBXhnECw9bgeh","failure":"hangup"}}]},{"id":139941,"name":"MULTI_CALL_PRODUCE_5","trigger":"rest","expression":"/m","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXV82DNsmJ9o"}},{"name":"restinfo","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXV82DNsmJ9o","next":{"success":"PBXBphmxK9kgs","failure":"PBXDXwph5ALWT"}},{"json_is":"true","json_name":"error_response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"data not found"},{"key":"code","value":"404"}],"type":"set-var-multi","id":"PBXDXwph5ALWT","next":{"success":"PBXVwBH5IeNGu","failure":"hangup"}},{"variable_name":"error_response","http_response_code":"{{error_response.code}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXVwBH5IeNGu","next":{"success":"hangup","failure":"hangup"}},{"name":"headers","value":"{{{jsonstr request.headers}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXBphmxK9kgs","next":{"success":"PBX9zEvfzaC6c","failure":"PBXDXwph5ALWT"}},{"src":"var headers=JSON.parse(map.headers);\r\ndelete headers ['Host'];\r\ndelete headers ['accept-encoding'];\r\ndelete headers ['Accept'];\r\ndelete headers ['Cache-Control'];\r\ndelete headers ['User-Agent'];\r\ndelete headers ['Connection'];\r\ndelete headers ['Postman-Token'];\r\ndelete headers ['Accept-Encoding'];\r\ndelete headers ['Content-Length'];\r\nmap.headerjson=JSON.stringify(headers);","inline":"true","type":"code-js","id":"PBX9zEvfzaC6c","next":{"success":"PBXUfXcP91MRb","failure":"PBXDXwph5ALWT"}},{"name":"index","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXUfXcP91MRb","next":{"success":"PBXl5uSpnUnyK","failure":"PBXDXwph5ALWT"}},{"src":"var restinfo=JSON.parse(map.restinfo);\r\nvar len = restinfo.dataList;print('--------------------'+JSON.stringify(restinfo));\r\nvar length=len.length;\r\nmap.length=length;print('length'+length);","inline":"true","type":"code-js","id":"PBXl5uSpnUnyK","next":{"success":"PBXalGqOqokln","failure":"PBXDXwph5ALWT"}},{"output_variable":"","if_type":"value","variable1":"${index?number}","comparator":"less_than","variable2":"${length?number}","value_type":"ftl","type":"if-condition","id":"PBXalGqOqokln","next":{"success":"PBXQuZKkROTtF","failure":"PBXNwBzTpvPdb"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"success"},{"key":"message","value":"{{{index2}}}"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXNwBzTpvPdb","next":{"success":"PBXOuKnmqHuA1","failure":"hangup"}},{"variable_name":"response","http_response_code":"{{{response.code}}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOuKnmqHuA1","next":{"success":"hangup","failure":"hangup"}},{"src":"var restinfo1=JSON.parse(map.restinfo);\r\nvar restinfo=JSON.stringify(restinfo1.dataList);\r\nvar targeturl=restinfo1.dataList[{{index}}].url;\r\nvar method=restinfo1.dataList[{{index}}].method;\r\nmap.targeturl=targeturl;map.method=method;\r\nvar data=restinfo1.dataList[{{index}}].data;\r\nmap.data=JSON.stringify(data);\r\nvar result=data.result;\r\nmap.result=result;","inline":"true","type":"code-js","id":"PBXQuZKkROTtF","next":{"success":"PBXztCp8mhZ42","failure":"PBXDXwph5ALWT"}},{"output_variable":"","if_type":"value","variable1":"${method?lower_case}","comparator":"equal_to","variable2":"get","value_type":"ftl","type":"if-condition","id":"PBXztCp8mhZ42","next":{"success":"PBXr94FQpTV6U","failure":"PBXtqRT7kqrER"}},{"url":"{{{targeturl}}}","method":"{{{method}}}","query_parameters":"{{{data}}}","headers":"{{{headerjson}}}","body_parameters":"{}","raw":"","output_variable":"{{{result}}}","value_type":"hb","type":"rest-dynamic-step","id":"PBXr94FQpTV6U","next":{"success":"PBXPcAuFDg0xL","failure":"hangup"}},{"url":"{{{targeturl}}}","method":"{{{method}}}","query_parameters":"{}","headers":"{{{headerjson}}}","body_parameters":"{{{data}}}","raw":"","output_variable":"{{{result}}}","value_type":"hb","type":"rest-dynamic-step","id":"PBXtqRT7kqrER","next":{"success":"PBXPcAuFDg0xL","failure":"hangup"}},{"src":"var index2=JSON.parse(map.{{{result}}});map.index2=JSON.stringify(index2);\r\nprint('index21111111111111111'+index2);\r\nvar restinfo2=JSON.parse(map.restinfo);\r\nvar restinfo=JSON.stringify(restinfo2.dataList);\r\nvar data=restinfo2.dataList[{{index}}].data;\r\nmap.data=JSON.stringify(data);\r\nvar ress=data.result;map.ress=ress;","inline":"true","type":"code-js","id":"PBXPcAuFDg0xL","next":{"success":"PBXwbrRXXUr6e","failure":"PBXDXwph5ALWT"}},{"output_variable":"","if_type":"strlen","variable1":"{{{ress}}}","comparator":"not_equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXwbrRXXUr6e","next":{"success":"PBXxiWFoQAW0V","failure":"PBX87r4diNtDd"}},{"src":"var restinfo2=JSON.parse(map.restinfo);\r\nvar restinfo=JSON.stringify(restinfo2.dataList);\r\nvar data=restinfo2.dataList[{{index}}].data;\r\nmap.data=JSON.stringify(data);\r\nvar res1=data.result;\r\nmap[data.result]=JSON.parse(map.{{{result}}});","inline":"true","type":"code-js","id":"PBXxiWFoQAW0V","next":{"success":"PBX87r4diNtDd","failure":"PBXDXwph5ALWT"}},{"name":"index","value":"<#assign num3 = index?number><#setting number_format=\"number\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX87r4diNtDd","next":{"success":"PBXalGqOqokln","failure":"PBXDXwph5ALWT"}}]},{"id":132757,"name":"DB_CACHE","trigger":"rest","expression":"/cache/{app-name}/{type}/{key}/keys/{CSV-keys}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXXktlOXb50O"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXE9tzaksKOQ","next":{"success":"PBXOkNHaCkS6E","failure":"PBXWl1rT7qclS"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBX9TaPNINpDk","next":{"success":"PBXt8epvHfMfl","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOkNHaCkS6E","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXWl1rT7qclS","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwL7D0GybhL","next":{"success":"PBX9TaPNINpDk","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXktlOXb50O","next":{"success":"PBXEBFwuZKKoe","failure":"hangup"}},{"output_variable":"data","if_type":"value","variable1":"{{count}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXkZ6yafdlDw","next":{"success":"PBXE9tzaksKOQ","failure":"PBX6eCrVUdNcZ"}},{"plugin_name":"sql-plugin","value":"update KEY_VALUE set `key`='{{{key}}}',value='{{{value}}}', expire_time=(UNIX_TIMESTAMP()+{{{expaire}}})*1000 where `key`='{{{key}}}';","value_type":"hb","output_variable":"update","type":"sql-update","id":"PBX6eCrVUdNcZ","next":{"success":"PBXqTfOhhbGmp","failure":"PBX14TC1VGwNV"}},{"variable_name":"update","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqTfOhhbGmp","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"update","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX14TC1VGwNV","next":{"success":"hangup","failure":"hangup"}},{"name":"count","value":"{{{countinfo.count}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGnmSVheEk2","next":{"success":"PBXkZ6yafdlDw","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select count(`key`)  as count from KEY_VALUE WHERE `key`= '{{{key}}}';","value_type":"hb","output_variable":"countinfo","type":"sql-one","id":"PBXt8epvHfMfl","next":{"success":"PBXGnmSVheEk2","failure":"hangup"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXEBFwuZKKoe","next":{"POST":"PBXwL7D0GybhL","PUT":"PBXJEcOdVflCh","GET":"PBXJW6hqx5I14","DELETE":"PBXFaPIPThkIF"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXEXfs7hTVMk","next":{"success":"PBX0fOFkG150m","failure":"PBXk6ddf7KH4d"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX0fOFkG150m","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk6ddf7KH4d","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXJW6hqx5I14","next":{"success":"PBXVTs5gt2p9t","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJEcOdVflCh","next":{"success":"PBXOQvOWRcDKQ","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXOQvOWRcDKQ","next":{"success":"PBXEXfs7hTVMk","failure":"hangup"}},{"src":"var id='{{{request.path.CSV-keys}}}';\r\nvar resp='';\r\nif(id=='undefined'|| id == null || id == ''){\r\nresp = 1;\r\n\r\n}else{\r\nresp = 0;\r\n}\r\nmap.resp = resp;","inline":"true","type":"code-js","id":"PBXFaPIPThkIF","next":{"success":"PBXbVLmtX9M74","failure":"hangup"}},{"output_variable":"s","if_type":"value","variable1":"{{resp}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXbVLmtX9M74","next":{"success":"PBXKmvNlQOUMQ","failure":"PBXE0cbweECGF"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` like '%{{{request.path.key}}}%';","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXKmvNlQOUMQ","next":{"success":"PBX7HfJt1cTVb","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX7HfJt1cTVb","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXE0cbweECGF","next":{"success":"PBXBwbQFJKkoh","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` in ({{{key}}});","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXBwbQFJKkoh","next":{"success":"PBX8EvDqUHIUP","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX8EvDqUHIUP","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select `key`,value from KEY_VALUE where expire_time in( select expire_time from KEY_VALUE where expire_time >= unix_timestamp()*1000) and\r\n`key` in({{{key}}});","value_type":"hb","output_variable":"data","type":"sql","id":"PBXVTs5gt2p9t","next":{"success":"PBXieF1u0AcTG","failure":"PBXT2PD6tzGvD"}},{"variable_name":"array","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXhnECw9bgeh","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"data","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT2PD6tzGvD","next":{"success":"hangup","failure":"hangup"}},{"src":"var x = map.data;\r\nvar array = [];\r\n//if(x.length !== 0){\r\nvar valarray = [];\r\nvar len = 0;\r\nvar obj = {};\r\nvar keyarray = [];\r\nvar xlength = x.length;\r\nvar i = 0;\r\nfor(i;i< xlength;i++){\r\n    if(array.length !== 0){\r\n        len = array.length;\r\n        var count = 0;\r\n         for(var j =0;j<len;j++){\r\n            if(array[j].key ===x[i].key){\r\n                count++;\r\n            }}\r\n        for(var j =0;j<len;j++){\r\n            \r\n            if(count>0){\r\n                    if(array[j].key === x[i].key){\r\n                        array[j].value.push(x[i].value);\r\n                  }\r\n                \r\n            }else{\r\n                keyarray.push(x[i].key);\r\n                obj = {};\r\n                valarray = [];\r\n                obj.key = x[i].key;\r\n                valarray.push(x[i].value);\r\n                obj.value = valarray;\r\n                array.push(obj);\r\n            }\r\n        } \r\n    }else{\r\n        keyarray.push(x[i].key);\r\n        obj.key = x[i].key;\r\n        valarray.push(x[i].value);\r\n        obj.value = valarray;\r\n        array.push(obj);\r\n    }\r\n    \r\n}\r\nprint(JSON.stringify(array));\r\nmap.array =JSON.stringify(array);\r\n//}else{\r\n//print(JSON.stringify(array));\r\n//map.array =JSON.stringify(map.data);\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXieF1u0AcTG","next":{"success":"PBXhnECw9bgeh","failure":"hangup"}}]},{"id":132757,"name":"DB_CACHE","trigger":"rest","expression":"/cache/{app-name}/{type}/{key}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXXktlOXb50O"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXE9tzaksKOQ","next":{"success":"PBXOkNHaCkS6E","failure":"PBXWl1rT7qclS"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBX9TaPNINpDk","next":{"success":"PBXt8epvHfMfl","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXOkNHaCkS6E","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXWl1rT7qclS","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwL7D0GybhL","next":{"success":"PBX9TaPNINpDk","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXktlOXb50O","next":{"success":"PBXEBFwuZKKoe","failure":"hangup"}},{"output_variable":"data","if_type":"value","variable1":"{{count}}","comparator":"equal_to","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXkZ6yafdlDw","next":{"success":"PBXE9tzaksKOQ","failure":"PBX6eCrVUdNcZ"}},{"plugin_name":"sql-plugin","value":"update KEY_VALUE set `key`='{{{key}}}',value='{{{value}}}', expire_time=(UNIX_TIMESTAMP()+{{{expaire}}})*1000 where `key`='{{{key}}}';","value_type":"hb","output_variable":"update","type":"sql-update","id":"PBX6eCrVUdNcZ","next":{"success":"PBXqTfOhhbGmp","failure":"PBX14TC1VGwNV"}},{"variable_name":"update","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXqTfOhhbGmp","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"update","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX14TC1VGwNV","next":{"success":"hangup","failure":"hangup"}},{"name":"count","value":"{{{countinfo.count}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGnmSVheEk2","next":{"success":"PBXkZ6yafdlDw","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select count(`key`)  as count from KEY_VALUE WHERE `key`= '{{{key}}}';","value_type":"hb","output_variable":"countinfo","type":"sql-one","id":"PBXt8epvHfMfl","next":{"success":"PBXGnmSVheEk2","failure":"hangup"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXEBFwuZKKoe","next":{"POST":"PBXwL7D0GybhL","PUT":"PBXJEcOdVflCh","GET":"PBXJW6hqx5I14","DELETE":"PBXFaPIPThkIF"}},{"plugin_name":"sql-plugin","value":"insert into KEY_VALUE(`key`,value,expire_time) values( '{{{key}}}','{{{value}}}', (UNIX_TIMESTAMP()+{{{expaire}}})*1000 );","value_type":"hb","output_variable":"insertstatus","type":"sql-insert","id":"PBXEXfs7hTVMk","next":{"success":"PBX0fOFkG150m","failure":"PBXk6ddf7KH4d"}},{"variable_name":"insertstatus","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX0fOFkG150m","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insertstatus","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk6ddf7KH4d","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXJW6hqx5I14","next":{"success":"PBXVTs5gt2p9t","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJEcOdVflCh","next":{"success":"PBXOQvOWRcDKQ","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\n\r\nvar keys = Object.keys(json);\r\n\r\nvar value = json[keys];\r\nmap.value=value;\r\nvar key='';\r\nif(map.method_type=='GET'){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXOQvOWRcDKQ","next":{"success":"PBXEXfs7hTVMk","failure":"hangup"}},{"src":"var id='{{{request.path.CSV-keys}}}';\r\nvar resp='';\r\nif(id=='undefined'|| id == null || id == ''){\r\nresp = 1;\r\n\r\n}else{\r\nresp = 0;\r\n}\r\nmap.resp = resp;","inline":"true","type":"code-js","id":"PBXFaPIPThkIF","next":{"success":"PBXbVLmtX9M74","failure":"hangup"}},{"output_variable":"s","if_type":"value","variable1":"{{resp}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXbVLmtX9M74","next":{"success":"PBXKmvNlQOUMQ","failure":"PBXE0cbweECGF"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` like '%{{{request.path.key}}}%';","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXKmvNlQOUMQ","next":{"success":"PBX7HfJt1cTVb","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX7HfJt1cTVb","next":{"success":"hangup","failure":"hangup"}},{"src":"var keydata = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-';\r\nvar jsonkeys = '{{request.path.CSV-keys}}';\r\nvar csv = jsonkeys.split(',');\r\nvar key='';\r\nfor(var i in csv){\r\nkey = key+'\\''+keydata+csv[i]+'\\',';\r\n}\r\nkey = key.substring(0, key.length-1);\r\nmap.key = key;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXE0cbweECGF","next":{"success":"PBXBwbQFJKkoh","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"delete from KEY_VALUE where `key` in ({{{key}}});","value_type":"hb","output_variable":"delete","type":"sql-delete","id":"PBXBwbQFJKkoh","next":{"success":"PBX8EvDqUHIUP","failure":"hangup"}},{"variable_name":"delete","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX8EvDqUHIUP","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select `key`,value from KEY_VALUE where expire_time in( select expire_time from KEY_VALUE where expire_time >= unix_timestamp()*1000) and\r\n`key` in({{{key}}});","value_type":"hb","output_variable":"data","type":"sql","id":"PBXVTs5gt2p9t","next":{"success":"PBXieF1u0AcTG","failure":"PBXT2PD6tzGvD"}},{"variable_name":"array","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXhnECw9bgeh","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"data","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT2PD6tzGvD","next":{"success":"hangup","failure":"hangup"}},{"src":"var x = map.data;\r\nvar array = [];\r\n//if(x.length !== 0){\r\nvar valarray = [];\r\nvar len = 0;\r\nvar obj = {};\r\nvar keyarray = [];\r\nvar xlength = x.length;\r\nvar i = 0;\r\nfor(i;i< xlength;i++){\r\n    if(array.length !== 0){\r\n        len = array.length;\r\n        var count = 0;\r\n         for(var j =0;j<len;j++){\r\n            if(array[j].key ===x[i].key){\r\n                count++;\r\n            }}\r\n        for(var j =0;j<len;j++){\r\n            \r\n            if(count>0){\r\n                    if(array[j].key === x[i].key){\r\n                        array[j].value.push(x[i].value);\r\n                  }\r\n                \r\n            }else{\r\n                keyarray.push(x[i].key);\r\n                obj = {};\r\n                valarray = [];\r\n                obj.key = x[i].key;\r\n                valarray.push(x[i].value);\r\n                obj.value = valarray;\r\n                array.push(obj);\r\n            }\r\n        } \r\n    }else{\r\n        keyarray.push(x[i].key);\r\n        obj.key = x[i].key;\r\n        valarray.push(x[i].value);\r\n        obj.value = valarray;\r\n        array.push(obj);\r\n    }\r\n    \r\n}\r\nprint(JSON.stringify(array));\r\nmap.array =JSON.stringify(array);\r\n//}else{\r\n//print(JSON.stringify(array));\r\n//map.array =JSON.stringify(map.data);\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXieF1u0AcTG","next":{"success":"PBXhnECw9bgeh","failure":"hangup"}}]},{"id":135000,"name":"HANDLEBAR_TEMPLATE","trigger":"rest","expression":"/handlebar/template","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBX6pXX1HcRuq"}},{"value":"\r\n{{{op.0.rest1}}}\r\n\r\n-------data-------\r\n{{{op.1.rest2}}}\r\n\r\n\r\n\r\n","value_type":"hb","output_variable":"response","type":"template","id":"PBXcyXbgHG0Rx","next":{"success":"PBXpteskhE97d","failure":"hangup"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXrTVashE8Rn","next":{"success":"hangup","failure":"hangup"}},{"convert_from":"json","convert_to":"json_array","output_variable":"op","root_name":"","value_type":"hb","data":"{{{request.body.output}}}","type":"utils-convert","id":"PBX6pXX1HcRuq","next":{"success":"PBXcyXbgHG0Rx","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"HANDLEBAR_TEMPLATE","from_email":"noreply@500apps.com","to_email":"narahari.gugulothu@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"HANDLEBAR_TEMPLATE","body_type":"text_body","body":"{{{response}}}","type":"send-email","id":"PBXpteskhE97d","next":{"success":"PBXrTVashE8Rn","failure":"hangup"}}]},{"id":136778,"name":"MULTI_CALL_PRODUCE_copy","trigger":"rest","expression":"/m/{table_name}/{template_name}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXwcbs1iVMTg"}},{"name":"restinfo","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwcbs1iVMTg","next":{"success":"PBX4KNWdQHpCt","failure":"hangup"}},{"name":"headers","value":"{{{jsonstr request.headers}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX4KNWdQHpCt","next":{"success":"PBXORZSrRtNbT","failure":"hangup"}},{"src":"var headers=JSON.parse(map.headers);delete headers ['Host'];delete headers ['accept-encoding'];delete headers ['Accept'];delete headers ['Cache-Control'];delete headers ['User-Agent'];delete headers ['Connection'];delete headers ['Postman-Token'];delete headers ['Accept-Encoding'];delete headers ['Content-Length'];map.headerjson=JSON.stringify(headers);","inline":"true","type":"code-js","id":"PBXORZSrRtNbT","next":{"success":"PBXrzPbFzobwh","failure":"hangup"}},{"name":"index","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXrzPbFzobwh","next":{"success":"PBXsP6QCLnTgl","failure":"hangup"}},{"src":"var restinfo=JSON.parse(map.restinfo);var len = restinfo.dataList;print('--------------------'+JSON.stringify(restinfo));var length=len.length;map.length=length;print('length'+length);\r\n","inline":"true","type":"code-js","id":"PBXqKC4G3b98O","next":{"success":"PBXtlMIDiV0yh","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${index?number}","comparator":"less_than","variable2":"${length?number}","value_type":"ftl","type":"if-condition","id":"PBXtlMIDiV0yh","next":{"success":"PBXGnI9mNw2s8","failure":"PBXlNeg5hVp4F"}},{"src":"var restinfo1=JSON.parse(map.restinfo);\r\nvar restinfo=JSON.stringify(restinfo1.dataList);\r\nvar targeturl=restinfo1.dataList[{{index}}].targeturl;\r\nvar method=restinfo1.dataList[{{index}}].method;\r\n\r\nvar data=restinfo1.dataList[{{index}}].data;\r\n\r\nvar t = {};\r\nif(Object.keys(JSON.parse(map.temp)).length!=0)\r\n{\r\n\r\nprint(\"temp data\"+ map.temp);\r\nmap.v[\"rest\"+{{index}}]=map.temp;\r\ndata[\"output\"] = JSON.stringify(map.v);\r\n}\r\n\r\nmap.targeturl=targeturl;\r\n\r\nmap.method=method;\r\n\r\nmap.data=JSON.stringify(data);","inline":"true","type":"code-js","id":"PBXGnI9mNw2s8","next":{"success":"PBXmE8hBqB80a","failure":"hangup"}},{"name":"index","value":"<#assign num3 = index?number><#setting number_format=\"number\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXDpzTGhXZDt","next":{"success":"PBXtlMIDiV0yh","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"output","value":"{{{v}}}"}],"type":"set-var-multi","id":"PBXBW09CGOQzn","next":{"success":"PBXSDqksATCit","failure":"hangup"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXSDqksATCit","next":{"success":"hangup","failure":"hangup"}},{"name":"temp","value":"{}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsP6QCLnTgl","next":{"success":"PBXnAo5o6yUIh","failure":"hangup"}},{"name":"temp","value":"{{{resp}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXah9T3ufQmn","next":{"success":"PBXDpzTGhXZDt","failure":"hangup"}},{"url":"{{{decoded_url}}}","method":"{{{method}}}","query_parameters":"{}","headers":"{{{headerjson}}}","body_parameters":"{{{data}}}","raw":"","output_variable":"resp","value_type":"hb","type":"rest-dynamic-step","id":"PBXeT6HUxaoh2","next":{"success":"PBXah9T3ufQmn","failure":"PBX1n09ziq9Hn"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXeEpC3SLM3M","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"error"},{"key":"error","value":"resp"},{"key":"rest_call","value":"{{{decoded_url}}}"}],"type":"set-var-multi","id":"PBX1n09ziq9Hn","next":{"success":"hangup","failure":"PBXeEpC3SLM3M"}},{"output_variable":"","if_type":"value","variable1":"${method?lower_case}","comparator":"equal_to","variable2":"get","value_type":"ftl","type":"if-condition","id":"PBXIuhtEd7HIX","next":{"success":"PBXvSNJyoC9w2","failure":"PBXeT6HUxaoh2"}},{"url":"{{{decoded_url}}}","method":"{{{method}}}","query_parameters":"{{{data}}}","headers":"{{{headerjson}}}","body_parameters":"{}","raw":"","output_variable":"resp","value_type":"hb","type":"rest-dynamic-step","id":"PBXvSNJyoC9w2","next":{"success":"PBXah9T3ufQmn","failure":"PBX1n09ziq9Hn"}},{"name":"decoded_url","value":"{{{targeturl}}}","value_type":"hb","encode_or_decode":"DECODE","char_set":"ISO-8859-1","type":"set-var","id":"PBXmE8hBqB80a","next":{"success":"PBXzcWdUzhvOb","failure":"hangup"}},{"src":"var v={};\r\nmap.v=v;","inline":"true","type":"code-js","id":"PBXnAo5o6yUIh","next":{"success":"PBXqKC4G3b98O","failure":"hangup"}},{"src":"map.v=JSON.stringify(map.v);","inline":"true","type":"code-js","id":"PBXlNeg5hVp4F","next":{"success":"PBXBW09CGOQzn","failure":"hangup"}},{"src":"var temp={};\r\nmap.temp=temp;","inline":"true","type":"code-js","id":"PBXkSHmpqs0qo","next":{"success":"hangup","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"MULTI_CALL_PRODUCE_copy","from_email":"noreply@500apps.com","to_email":"narahari.gugulothu@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"MULTI_CALL_PRODUCE_copy","body_type":"text_body","body":"{{{data}}}\r\n\r\n{{{index}}}","type":"send-email","id":"PBXzcWdUzhvOb","next":{"success":"PBXIuhtEd7HIX","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"MULTI_CALL_PRODUCE_copy","from_email":"noreply@500apps.com","to_email":"narahari.gugulothu@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"MULTI_CALL_PRODUCE_copy","body_type":"text_body","body":"{{{data}}}\r\n\r\n{{{index}}}","type":"send-email","id":"PBXOkoqlgSwEF","next":{"success":"hangup","failure":"hangup"}}]},{"id":135769,"name":"UPLOAD_FILE_copy","trigger":"rest","expression":"/upload/file","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXWzZ8lNnrVu"}},{"file_name":"nari.txt","output_variable":"result","expiration_time_in_sec":"9000","bucket_name":"generic-apps","value_type":"hb","method":"PUT","access_level":"PublicReadWrite","plugin_name":"s3-plugin","type":"s3-pre-sign-url","id":"PBXWzZ8lNnrVu","next":{"success":"PBXWi5zpQ6nli","failure":"hangup"}},{"json_is":"true","json_name":"success_response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Result","value":"{{{result.s3_presign_url}}}"}],"type":"set-var-multi","id":"PBXWi5zpQ6nli","next":{"success":"PBXpTiNeemzw1","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXE7LhqbkyL1","next":{"success":"hangup","failure":"hangup"}},{"url":"{{{result.s3_presign_url}}}","method":"PUT","data_key":"{{{success_response}}}","body_enc_type":"plain/text","output_variable":"updated","connectionTimeout":"60","readTimeout":"60","value_type":"hb","query_parameters":[],"headers":[],"body_parameters":[],"type":"rest-binary","id":"PBXpTiNeemzw1","next":{"success":"PBXE7LhqbkyL1","failure":"hangup"}}]},{"id":137073,"name":"jsondata","trigger":"rest","expression":"/jsondata/{table_name}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXuWlF7GJkJE"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXrgTXeRoFpS","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"SELECT FIRST_NAME,LAST_NAME,EMAIL FROM {{{request.path.table_name}}} WHERE ID='{{{request.params.id}}}';","value_type":"hb","output_variable":"resp","type":"sql-one","id":"PBXuWlF7GJkJE","next":{"success":"PBXrgTXeRoFpS","failure":"hangup"}}]},{"id":137074,"name":"template","trigger":"rest","expression":"/template/{table_name}/{id}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXUB8PNualcv"}},{"plugin_name":"sql-plugin","value":"SELECT TEMPLATE from {{{request.path.table_name}}} where ID='{{{request.path.id}}}'","value_type":"hb","output_variable":"resp","type":"sql-one","id":"PBXUB8PNualcv","next":{"success":"PBX3l92ZeChPo","failure":"hangup"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX3l92ZeChPo","next":{"success":"hangup","failure":"hangup"}}]},{"id":137075,"name":"combine","trigger":"rest","expression":"/combine","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBX3uBzVep2Zr"}},{"value":"{{{request.body.output.rest4.TEMPLATE}}}","value_type":"hb","output_variable":"response","type":"template","id":"PBX3uBzVep2Zr","next":{"success":"PBXoIFdoT3S9G","failure":"hangup"}},{"variable_name":"ttt","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXdQ6z5a0iHy","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"ttt","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"rest4","value":"{{{response}}}"}],"type":"set-var-multi","id":"PBXoIFdoT3S9G","next":{"success":"PBXdQ6z5a0iHy","failure":"hangup"}}]},{"id":137076,"name":"encode","trigger":"rest","expression":"/encode","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXhSqDDeMPm6"}},{"name":"encoded_url","value":"{{{request.body.url}}}","value_type":"hb","encode_or_decode":"ENCODE","char_set":"ISO-8859-1","type":"set-var","id":"PBXhSqDDeMPm6","next":{"success":"PBXHGK7SyF93a","failure":"hangup"}},{"json_is":"true","json_name":"resp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"base64encoded_url","value":"{{{encoded_url}}}"}],"type":"set-var-multi","id":"PBXHGK7SyF93a","next":{"success":"PBXXL8MqUltOT","failure":"hangup"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXXL8MqUltOT","next":{"success":"hangup","failure":"hangup"}}]},{"id":137082,"name":"combine2","trigger":"rest","expression":"/combine2","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXd3ALXBIWSc"}},{"variable_name":"resp4","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXdQ6z5a0iHy","next":{"success":"hangup","failure":"hangup"}},{"value":"{{{request.body.template}}}","value_type":"hb","output_variable":"response","type":"template","id":"PBXd3ALXBIWSc","next":{"success":"PBXofqX2NM4nJ","failure":"hangup"}},{"json_is":"true","json_name":"resp4","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"template_response","value":"{{{response}}}"}],"type":"set-var-multi","id":"PBXofqX2NM4nJ","next":{"success":"PBXdQ6z5a0iHy","failure":"hangup"}},{"name":"da","value":"{{{json request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXUVz6Zt6gep","next":{"success":"PBXr0bStkHErb","failure":"hangup"}},{"src":"var x = JSON.parse(map.da);\r\n\r\nvar rest1 = x[\"rest1\"];\r\n\r\nvar rest3 = x[\"rest3\"];\r\n\r\nvar rest4 = x[\"rest4\"];\r\n\r\nvar rest11 = JSON.parse(rest1);\r\nvar rest33 = JSON.parse(rest3);\r\n\r\nvar rest44 = JSON.parse(rest4);\r\n\r\n\r\nmap.rest11 = rest11;\r\nmap.rest33 = rest33;\r\nmap.rest44 = rest44;","inline":"true","type":"code-js","id":"PBXr0bStkHErb","next":{"success":"hangup","failure":"hangup"}}]},{"id":137084,"name":"update_user","trigger":"rest","expression":"/user","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXcB9I7FPUsg"}},{"plugin_name":"sql-plugin","value":"UPDATE JSON_TABLE SET MOBILE='{{{request.body.mobile}}}' Where ID='{{{request.body.gk}}}';","value_type":"hb","output_variable":"resp","type":"sql-update","id":"PBXcB9I7FPUsg","next":{"success":"PBXV6l4w0onbz","failure":"hangup"}},{"json_is":"true","json_name":"resp2","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"update_response","value":"{{{resp}}}"}],"type":"set-var-multi","id":"PBXV6l4w0onbz","next":{"success":"PBXCl08Fqzyk0","failure":"hangup"}},{"variable_name":"resp2","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXCl08Fqzyk0","next":{"success":"hangup","failure":"hangup"}}]},{"id":137083,"name":"user_endpoint","trigger":"rest","expression":"/user","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXLCoxy4a1N4"}},{"plugin_name":"sql-plugin","value":"INSERT INTO JSON_TABLE(FIRST_NAME,LAST_NAME,EMAIL) VALUES('{{{request.body.fname}}}','{{{request.body.lname}}}','{{{request.body.email}}}');","value_type":"hb","output_variable":"ok","type":"sql-insert","id":"PBXLCoxy4a1N4","next":{"success":"PBXIABnTwbxSy","failure":"hangup"}},{"variable_name":"ok","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXIABnTwbxSy","next":{"success":"hangup","failure":"hangup"}}]},{"id":137539,"name":"S3-File-Upload","trigger":"rest","expression":"dynamicwebpages","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXxSqlHVNxkL"}},{"name":"filedata","value":"{{{request.body.file_content}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXxSqlHVNxkL","next":{"success":"PBXIKhlGmDH4p","failure":"hangup"}},{"file_name":"{{{request.body.filepath}}}","file_data":"filedata","output_variable":"s3output","bucket_name":"cmswebsites","content_type":"{{{request.body.contenttype}}}","value_type":"hb","file_access":"PublicReadWrite","plugin_name":"cms-plugin","type":"s3-binary-file-upload","id":"PBXIKhlGmDH4p","next":{"success":"PBXRC1ba029s6","failure":"PBXrt2XXSPFZX"}},{"variable_name":"s3output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRC1ba029s6","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"unable to upload file"}],"type":"set-var-multi","id":"PBXrt2XXSPFZX","next":{"success":"PBXuS9LAfsufc","failure":"hangup"}},{"variable_name":"response","http_response_code":"404","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXuS9LAfsufc","next":{"success":"hangup","failure":"hangup"}}]},{"id":137581,"name":"MULTI_CALL_PRODUCE_3","trigger":"rest","expression":"/m3","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXwcbs1iVMTg"}},{"name":"restinfo","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwcbs1iVMTg","next":{"success":"PBX4KNWdQHpCt","failure":"hangup"}},{"name":"headers","value":"{{{jsonstr request.headers}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX4KNWdQHpCt","next":{"success":"PBXORZSrRtNbT","failure":"hangup"}},{"src":"var headers=JSON.parse(map.headers);delete headers ['Host'];delete headers ['accept-encoding'];delete headers ['Accept'];delete headers ['Cache-Control'];delete headers ['User-Agent'];delete headers ['Connection'];delete headers ['Postman-Token'];delete headers ['Accept-Encoding'];delete headers ['Content-Length'];map.headerjson=JSON.stringify(headers);","inline":"true","type":"code-js","id":"PBXORZSrRtNbT","next":{"success":"PBXrzPbFzobwh","failure":"hangup"}},{"name":"index","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXrzPbFzobwh","next":{"success":"PBXsP6QCLnTgl","failure":"hangup"}},{"src":"var restinfo=JSON.parse(map.restinfo);var len = restinfo.dataList;print('--------------------'+JSON.stringify(restinfo));var length=len.length;map.length=length;print('length'+length);\r\n","inline":"true","type":"code-js","id":"PBXqKC4G3b98O","next":{"success":"PBXtlMIDiV0yh","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${index?number}","comparator":"less_than","variable2":"${length?number}","value_type":"ftl","type":"if-condition","id":"PBXtlMIDiV0yh","next":{"success":"PBXGnI9mNw2s8","failure":"PBXlNeg5hVp4F"}},{"src":"var restinfo1=JSON.parse(map.restinfo);\r\nvar restinfo=JSON.stringify(restinfo1.dataList);\r\nvar targeturl=restinfo1.dataList[{{index}}].url;\r\nvar method=restinfo1.dataList[{{index}}].method;\r\n\r\nvar t = {};\r\nif(Object.keys(JSON.parse(map.temp)).length!=0)\r\n{\r\nmap.v[\"rest\"+{{index}}]=JSON.parse(map.temp);\r\n}\r\n\r\nmap.targeturl=targeturl;\r\n\r\nmap.method=method;\r\n\r\nmap.t=JSON.stringify(map.v);","inline":"true","type":"code-js","id":"PBXGnI9mNw2s8","next":{"success":"PBXCHtIFvcTP5","failure":"hangup"}},{"name":"index","value":"<#assign num3 = index?number><#setting number_format=\"number\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXDpzTGhXZDt","next":{"success":"PBXtlMIDiV0yh","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"output","value":"{{{v}}}"}],"type":"set-var-multi","id":"PBXBW09CGOQzn","next":{"success":"PBXSDqksATCit","failure":"hangup"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXSDqksATCit","next":{"success":"hangup","failure":"hangup"}},{"name":"temp","value":"{}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsP6QCLnTgl","next":{"success":"PBXnAo5o6yUIh","failure":"hangup"}},{"name":"temp","value":"{{{resp}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXah9T3ufQmn","next":{"success":"PBXDpzTGhXZDt","failure":"hangup"}},{"url":"${targeturl}","method":"${method}","query_parameters":"{}","headers":"${headerjson}","body_parameters":"${data}","raw":"","output_variable":"resp","value_type":"ftl","type":"rest-dynamic-step","id":"PBXeT6HUxaoh2","next":{"success":"PBXzDEvrVaXZJ","failure":"PBX1n09ziq9Hn"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXeEpC3SLM3M","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"error"},{"key":"error","value":"resp"},{"key":"rest_call","value":"{{{targeturl}}}"}],"type":"set-var-multi","id":"PBX1n09ziq9Hn","next":{"success":"hangup","failure":"PBXeEpC3SLM3M"}},{"output_variable":"","if_type":"value","variable1":"${method?lower_case}","comparator":"equal_to","variable2":"get","value_type":"ftl","type":"if-condition","id":"PBXIuhtEd7HIX","next":{"success":"PBXvSNJyoC9w2","failure":"PBXeT6HUxaoh2"}},{"url":"${targeturl}","method":"${method}","query_parameters":"${data}","headers":"${headerjson}","body_parameters":"{}","raw":"","output_variable":"resp","value_type":"ftl","type":"rest-dynamic-step","id":"PBXvSNJyoC9w2","next":{"success":"PBXah9T3ufQmn","failure":"PBX1n09ziq9Hn"}},{"src":"var v={};\r\nmap.v=v;","inline":"true","type":"code-js","id":"PBXnAo5o6yUIh","next":{"success":"PBXqKC4G3b98O","failure":"hangup"}},{"src":"map.v=JSON.stringify(map.v);","inline":"true","type":"code-js","id":"PBXlNeg5hVp4F","next":{"success":"PBXBW09CGOQzn","failure":"hangup"}},{"src":"var restinfo2=JSON.parse(map.restinfo);\r\n\r\nvar data=restinfo2.dataList[{{index}}].data;\r\n\r\nif(Object.keys(JSON.parse(map.t)).length!=0)\r\n{\r\ndata[\"output\"] = JSON.parse(map.t);\r\n}\r\nelse\r\n{\r\ndata[\"output\"] = {\"\":\"\"};\r\n}\r\nvar op = data['output'];\r\ndelete data['output'];\r\nprint(\"deleted\"+JSON.stringify(op));\r\nfor (var key in op) {\r\n    \r\n    data[key]=op[key];\r\n}\r\nprint(JSON.stringify(data));\r\nmap.data=JSON.stringify(data);","inline":"true","type":"code-js","id":"PBXCHtIFvcTP5","next":{"success":"PBXXbw0n1uCDM","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"data","from_email":"noreply@500apps.com","to_email":"narahari.gugulothu@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"data","body_type":"text_body","body":"{{{targeturl}}}\r\n{{{method}}}\r\n{{{data}}}\r\n","type":"send-email","id":"PBXXbw0n1uCDM","next":{"success":"PBXIuhtEd7HIX","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"POST RESPONSE","from_email":"noreply@500apps.com","to_email":"narahari.gugulothu@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"POST RESPONSE","body_type":"text_body","body":"{{{resp}}}","type":"send-email","id":"PBXzDEvrVaXZJ","next":{"success":"PBXah9T3ufQmn","failure":"hangup"}}]},{"id":137584,"name":"test1","trigger":"rest","expression":"/test1","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBX3mUil56ITB"}},{"json_is":"true","json_name":"resp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"one","value":"one"}],"type":"set-var-multi","id":"PBX3mUil56ITB","next":{"success":"PBXZNEM98kXdT","failure":"hangup"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXZNEM98kXdT","next":{"success":"hangup","failure":"hangup"}}]},{"id":137585,"name":"test2","trigger":"rest","expression":"/test2","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBX3mUil56ITB"}},{"json_is":"true","json_name":"resp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"two","value":"two"}],"type":"set-var-multi","id":"PBX3mUil56ITB","next":{"success":"PBXZNEM98kXdT","failure":"hangup"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXZNEM98kXdT","next":{"success":"hangup","failure":"hangup"}}]},{"id":137586,"name":"test3","trigger":"rest","expression":"/test3","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXUF3tlT0D6s"}},{"json_is":"true","json_name":"resp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"three","value":"three"}],"type":"set-var-multi","id":"PBX3mUil56ITB","next":{"success":"PBXZNEM98kXdT","failure":"hangup"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXZNEM98kXdT","next":{"success":"hangup","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"test3","from_email":"noreply@500apps.com","to_email":"narahari.gugulothu@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"test3","body_type":"text_body","body":"{{{json request.body}}}","type":"send-email","id":"PBXUF3tlT0D6s","next":{"success":"PBX3mUil56ITB","failure":"hangup"}}]},{"id":137587,"name":"restdynamic","trigger":"rest","expression":"/dynamic","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXrswPhvnbeC"}},{"url":"https://ga.500apps.com/1/test2","method":"POST","query_parameters":"{}","headers":"{}","body_parameters":"{\"mobile\":\"5444545545\",\"rest1\":{\"GENERATED_KEY\":35}}","raw":"","output_variable":"output","value_type":"hb","type":"rest-dynamic-step","id":"PBXrswPhvnbeC","next":{"success":"PBXUfkR0e7Lr4","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXUfkR0e7Lr4","next":{"success":"hangup","failure":"hangup"}}]},{"id":137589,"name":"MULTI_CALL_PRODUCE_4","trigger":"rest","expression":"/m4","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXwcbs1iVMTg"}},{"name":"restinfo","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwcbs1iVMTg","next":{"success":"PBX4KNWdQHpCt","failure":"hangup"}},{"name":"headers","value":"{{{jsonstr request.headers}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX4KNWdQHpCt","next":{"success":"PBXORZSrRtNbT","failure":"hangup"}},{"src":"var headers=JSON.parse(map.headers);delete headers ['Host'];delete headers ['accept-encoding'];delete headers ['Accept'];delete headers ['Cache-Control'];delete headers ['User-Agent'];delete headers ['Connection'];delete headers ['Postman-Token'];delete headers ['Accept-Encoding'];delete headers ['Content-Length'];map.headerjson=JSON.stringify(headers);","inline":"true","type":"code-js","id":"PBXORZSrRtNbT","next":{"success":"PBXrzPbFzobwh","failure":"hangup"}},{"name":"index","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXrzPbFzobwh","next":{"success":"PBXsP6QCLnTgl","failure":"hangup"}},{"src":"var restinfo=JSON.parse(map.restinfo);var len = restinfo.dataList;print('--------------------'+JSON.stringify(restinfo));var length=len.length;map.length=length;print('length'+length);\r\n","inline":"true","type":"code-js","id":"PBXqKC4G3b98O","next":{"success":"PBXtlMIDiV0yh","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${index?number}","comparator":"less_than","variable2":"${length?number}","value_type":"ftl","type":"if-condition","id":"PBXtlMIDiV0yh","next":{"success":"PBXGnI9mNw2s8","failure":"PBXlNeg5hVp4F"}},{"src":"var restinfo1=JSON.parse(map.restinfo);\r\nvar restinfo=JSON.stringify(restinfo1.dataList);\r\nvar targeturl=restinfo1.dataList[{{index}}].url;\r\nvar method=restinfo1.dataList[{{index}}].method;\r\n\r\nvar t = {};\r\nif(Object.keys(JSON.parse(map.temp)).length!=0)\r\n{\r\nmap.v[\"rest\"+{{index}}]=JSON.parse(map.temp);\r\n}\r\n\r\nmap.targeturl=targeturl;\r\n\r\nmap.method=method;\r\n\r\nmap.t=JSON.stringify(map.v);","inline":"true","type":"code-js","id":"PBXGnI9mNw2s8","next":{"success":"PBXCHtIFvcTP5","failure":"hangup"}},{"name":"index","value":"<#assign num3 = index?number><#setting number_format=\"number\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXDpzTGhXZDt","next":{"success":"PBXtlMIDiV0yh","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"response","value":"{{{resp}}}"},{"key":"code","value":"200"}],"type":"set-var-multi","id":"PBXBW09CGOQzn","next":{"success":"PBXSDqksATCit","failure":"hangup"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXSDqksATCit","next":{"success":"hangup","failure":"hangup"}},{"name":"temp","value":"{}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsP6QCLnTgl","next":{"success":"PBXnAo5o6yUIh","failure":"hangup"}},{"name":"temp","value":"{{{resp}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXah9T3ufQmn","next":{"success":"PBXDpzTGhXZDt","failure":"hangup"}},{"url":"{{{targeturl}}}","method":"{{{method}}}","query_parameters":"{}","headers":"{{{headerjson}}}","body_parameters":"{{{data}}}","raw":"","output_variable":"resp","value_type":"hb","type":"rest-dynamic-step","id":"PBXeT6HUxaoh2","next":{"success":"PBXah9T3ufQmn","failure":"PBX1n09ziq9Hn"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXeEpC3SLM3M","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"error"},{"key":"error","value":"resp"},{"key":"rest_call","value":"{{{url}}}"}],"type":"set-var-multi","id":"PBX1n09ziq9Hn","next":{"success":"hangup","failure":"PBXeEpC3SLM3M"}},{"output_variable":"","if_type":"value","variable1":"${method?lower_case}","comparator":"equal_to","variable2":"get","value_type":"ftl","type":"if-condition","id":"PBXIuhtEd7HIX","next":{"success":"PBXvSNJyoC9w2","failure":"PBXeT6HUxaoh2"}},{"url":"{{{targeturl}}}","method":"{{{method}}}","query_parameters":"{{{data}}}","headers":"{{{headerjson}}}","body_parameters":"{}","raw":"","output_variable":"resp","value_type":"hb","type":"rest-dynamic-step","id":"PBXvSNJyoC9w2","next":{"success":"PBXah9T3ufQmn","failure":"PBX1n09ziq9Hn"}},{"src":"var v={};\r\nmap.v=v;","inline":"true","type":"code-js","id":"PBXnAo5o6yUIh","next":{"success":"PBXqKC4G3b98O","failure":"hangup"}},{"src":"map.v=JSON.stringify(map.v);","inline":"true","type":"code-js","id":"PBXlNeg5hVp4F","next":{"success":"PBXBW09CGOQzn","failure":"hangup"}},{"src":"var restinfo2=JSON.parse(map.restinfo);\r\n\r\nvar data=restinfo2.dataList[{{index}}].data;\r\n\r\nif(Object.keys(JSON.parse(map.t)).length!=0)\r\n{\r\ndata[\"output\"] = JSON.parse(map.t);\r\n}\r\nelse\r\n{\r\ndata[\"output\"] = {\"\":\"\"};\r\n}\r\nvar op = data['output'];\r\ndelete data['output'];\r\nprint(\"deleted\"+JSON.stringify(op));\r\nfor (var key in op) {\r\n    \r\n    data[key]=op[key];\r\n}\r\nprint(JSON.stringify(data));\r\nmap.data=JSON.stringify(data);","inline":"true","type":"code-js","id":"PBXCHtIFvcTP5","next":{"success":"PBX3TZT6is0qg","failure":"hangup"}},{"src":"var result=JSON.parse(map.data);print('dddddddddddddddd'+result);map.result=result;","inline":"true","type":"code-js","id":"PBX3TZT6is0qg","next":{"success":"PBXIuhtEd7HIX","failure":"hangup"}}]},{"id":137719,"name":"test4","trigger":"rest","expression":"/test4","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXQgNwM22LBT"}},{"name":"resp","value":"{{{json request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXQgNwM22LBT","next":{"success":"PBX1JRr8B7FJI","failure":"hangup"}},{"variable_name":"resp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX1JRr8B7FJI","next":{"success":"hangup","failure":"hangup"}}]},{"id":133843,"name":"ASYNC_CALL_CONSUME","trigger":"event","expression":null,"execute_continues":"true","broker_url":"ssl://b-840b987b-e5b3-47fd-b9ed-4cc1ed4013d9-1.mq.us-east-1.amazonaws.com:61617","username":"appup","password":"appupactivemq","queue_name":"async","message_variable":"get_data","event_type":"activemq","steps":[{"type":"start","id":1,"next":{"start":"PBX4b3c0Z5TJM"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"async","output_variable":"getdata","type":"active-mq-consumer","id":"PBXE0TTt88bbE","next":{"message_received":"hangup","no_messages":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"SELECT * FROM ASYNC_DATA where id='{{{get_data}}}';","value_type":"hb","output_variable":"async_data","type":"sql-one","id":"PBX4b3c0Z5TJM","next":{"success":"PBXRqR5PePMdG","failure":"hangup"}},{"output_variable":"","if_type":"strlen","variable1":"{{{async_data.HEADERS}}}","comparator":"less_than_or_equals","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXwmvrTAW9N4","next":{"success":"PBXZCIb8DbyvO","failure":"PBX4oFKXsSaGF"}},{"name":"HEADERS","value":"{}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXZCIb8DbyvO","next":{"success":"PBXoKTyMHBSfq","failure":"hangup"}},{"name":"HEADERS","value":"{{{async_data.HEADERS}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX4oFKXsSaGF","next":{"success":"PBXoKTyMHBSfq","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"{{{async_data.METHOD}}}","comparator":"equal_to","variable2":"GET","value_type":"hb","type":"if-condition","id":"PBXoKTyMHBSfq","next":{"success":"PBXM8WTDBCcXT","failure":"PBX7ub6pPnbHA"}},{"url":"{{{targeturl}}}","method":"{{{async_data.METHOD}}}","query_parameters":"{{{async_data.DATA}}}","headers":"{{{HEADERS}}}","body_parameters":"{}","raw":"","output_variable":"response","value_type":"hb","type":"rest-dynamic-step","id":"PBXM8WTDBCcXT","next":{"success":"PBXT14mDvT03o","failure":"PBXuRBZ1TG5PD"}},{"url":"{{{targeturl}}}","method":"{{{async_data.METHOD}}}","query_parameters":"{}","headers":"{{{HEADERS}}}","body_parameters":"{{{async_data.DATA}}}","raw":"","output_variable":"response","value_type":"hb","type":"rest-dynamic-step","id":"PBX7ub6pPnbHA","next":{"success":"PBXT14mDvT03o","failure":"PBXuRBZ1TG5PD"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"multi","delivery_mode":"2","scheduled_delay":"180","scheduled_period":"","scheduled_repeat":"","scheduled_cron":"","messages":[{"key":"{{{getdata}}}","value":"4"}],"type":"active-mq-producer","id":"PBXWofeZKvgpv","next":{"success":"PBXFJsaJE0Hoo","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"select RETERY from ASYNC_DATA where id=''{{{getdata}}}';","value_type":"hb","output_variable":"retry_count","type":"sql-one","id":"PBXuRBZ1TG5PD","next":{"success":"PBX0VwNAbbeS8","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"{{{retry_count.RETERY}}}","comparator":"greater_than_or_equals","variable2":"3","value_type":"hb","type":"if-condition","id":"PBX0VwNAbbeS8","next":{"success":"hangup","failure":"PBXWofeZKvgpv"}},{"plugin_name":"sql-plugin","value":"update ASYNC_DATA  set RETERY  = RETERY +1;","value_type":"hb","output_variable":"update_data","type":"sql-update","id":"PBXFJsaJE0Hoo","next":{"success":"PBXuRBZ1TG5PD","failure":"hangup"}},{"output_variable":"","if_type":"strlen","variable1":"{{{async_data.CALLBACK_URL}}}","comparator":"less_than_or_equals","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXT14mDvT03o","next":{"success":"hangup","failure":"PBXSTVofvPJTR"}},{"output_variable":"","if_type":"value","variable1":"{{{async_data.CALLBACK_METHOD}}}","comparator":"equal_to","variable2":"GET","value_type":"hb","type":"if-condition","id":"PBXSTVofvPJTR","next":{"success":"PBXDp1O7M8DK0","failure":"PBXr34ATUL1kn"}},{"url":"{{{callbackurl}}}","method":"{{{async_data.CALLBACK_METHOD}}}","query_parameters":"{{{response}}}","headers":"{{{HEADERS}}}","body_parameters":"{}","raw":"","output_variable":"","value_type":"hb","type":"rest-dynamic-step","id":"PBXDp1O7M8DK0","next":{"success":"hangup","failure":"hangup"}},{"url":"{{{callbackurl}}}","method":"{{{async_data.CALLBACK_METHOD}}}","query_parameters":"{}","headers":"{{{HEADERS}}}","body_parameters":"{{{response}}}","raw":"","output_variable":"","value_type":"hb","type":"rest-dynamic-step","id":"PBXr34ATUL1kn","next":{"success":"hangup","failure":"hangup"}},{"src":"var targeturl=decodeURIComponent('{{{async_data.URL}}}');\r\nvar callbackurl=decodeURIComponent('{{{async_data.CALLBACK_URL}}}');\r\nmap.targeturl=targeturl;\r\nmap.callbackurl=callbackurl;","inline":"true","type":"code-js","id":"PBXRqR5PePMdG","next":{"success":"PBXwmvrTAW9N4","failure":"hangup"}}]},{"id":139443,"name":"SEND_NOTIFICATION_F","trigger":"rest","expression":"/notification/{app-name}/f/send/{type}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXhEaqPLZa1N"}},{"json_is":"true","json_name":"parameters","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"channel","value":"{{{request.path.app-name}}}-notify-all"},{"key":"message","value":"{{{request.body.message}}}"},{"key":"title","value":"{{{request.body.title}}}"}],"type":"set-var-multi","id":"PBXxiF3ynB443","next":{"success":"PBXHPHAapakcA","failure":"hangup"}},{"channel_name":"{{{parameters.channel}}}","name":"{{{parameters.title}}}","data":"{{{parameters.message}}}","value_type":"hb","output_variable":"response","plugin_name":"ably_plugin","type":"ably","id":"PBXHPHAapakcA","next":{"success":"PBXk9rL3rLRDt","failure":"PBXuTTf2tvGKA"}},{"variable_name":"response","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXk9rL3rLRDt","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"unable to send notification"}],"type":"set-var-multi","id":"PBXuTTf2tvGKA","next":{"success":"PBXrCiBrxDMPB","failure":"hangup"}},{"variable_name":"response","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXrCiBrxDMPB","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"parameters","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"channel","value":"{{{request.path.app-name}}}-notify-{{{session.user_id}}}"},{"key":"message","value":"{{{request.body.message}}}"},{"key":"title","value":"{{{request.body.title}}}"}],"type":"set-var-multi","id":"PBXRDB9TUnTmS","next":{"success":"PBXHPHAapakcA","failure":"hangup"}},{"value_type":"hb","variable":"{{{request.path.type}}}","cases":[{"key":"user"},{"key":"all"}],"type":"switch-case","id":"PBXa5dRUno2Bz","next":{"user":"PBXRDB9TUnTmS","all":"PBXxiF3ynB443"}},{"output_variable":"","value_type":"hb","and_conditions":[{"if_type":"value","variable1":"{{{request.path.type}}}","comparator":"not_equal_to","variable2":"user"},{"if_type":"value","variable1":"{{{request.path.type}}}","comparator":"not_equal_to","variable2":"all"}],"or_conditions":[],"type":"condition","id":"PBXhEaqPLZa1N","next":{"success":"PBXcHCk8alc4T","failure":"PBXa5dRUno2Bz"}},{"json_is":"true","json_name":"response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"failure"},{"key":"message","value":"Invalid type"}],"type":"set-var-multi","id":"PBXcHCk8alc4T","next":{"success":"PBXrCiBrxDMPB","failure":"hangup"}}]},{"id":139938,"name":"Redirect","trigger":"rest","expression":"/r/{endpoint_url}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXJO2SFLMu6p"}},{"name":"endpoint","value":"{{{request.path.endpoint_url}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJO2SFLMu6p","next":{"success":"PBXBf7Qw45RTg","failure":"hangup"}},{"jsonType":"MAP","jsonStr":"{{{payload}}}","spec":"{{{transform}}}","value_type":"hb","output_variable":"result","type":"jolt-convert","id":"PBXo2XTVawIHn","next":{"success":"PBXqDFMFNcTQI","failure":"hangup"}},{"name":"transform","value":"{{{json request.body.data.transform}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXBf7Qw45RTg","next":{"success":"PBXJ8E0EZRAc7","failure":"hangup"}},{"name":"payload","value":"{{{json request.body.data.payload}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXAvxBn6ZQ7S","next":{"success":"PBXzJQyeLzDEh","failure":"hangup"}},{"variable_name":"resp8","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX3viml80XQH","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"resp8","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"request sent"}],"type":"set-var-multi","id":"PBX13xzbJhto2","next":{"success":"PBX3viml80XQH","failure":"hangup"}},{"json_is":"true","json_name":"resp8","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"Endpoint URL Failed"},{"key":"URL","value":"{{{endpoint}}}"}],"type":"set-var-multi","id":"PBXqg5FZp4x7D","next":{"success":"PBX3viml80XQH","failure":"hangup"}},{"url":"{{{endpoint}}}","method":"{{{method}}}","query_parameters":"{}","headers":"{{{headerjson}}}","body_parameters":"{{{result}}}","raw":"","output_variable":"endpointOutput","value_type":"hb","type":"rest-dynamic-step","id":"PBXrPwVbyxHn5","next":{"success":"PBXVKzxC6TxC7","failure":"PBXqg5FZp4x7D"}},{"output_variable":"ifOp","if_type":"value","variable1":"${method?lower_case}","comparator":"equal_to","variable2":"get","value_type":"ftl","type":"if-condition","id":"PBXqDFMFNcTQI","next":{"success":"PBXW6Cr3cF7eI","failure":"PBXrPwVbyxHn5"}},{"url":"{{{endpoint}}}","method":"{{{method}}}","query_parameters":"{{{result}}}","headers":"{{{headerjson}}}","body_parameters":"{}","raw":"","output_variable":"endpointOutput","value_type":"hb","type":"rest-dynamic-step","id":"PBXW6Cr3cF7eI","next":{"success":"PBXVKzxC6TxC7","failure":"PBXqg5FZp4x7D"}},{"src":"var headers=JSON.parse(map.headers);delete headers ['Host'];delete headers ['accept-encoding'];delete headers ['Accept'];delete headers ['Cache-Control'];delete headers ['User-Agent'];delete headers ['Connection'];delete headers ['Postman-Token'];delete headers ['Accept-Encoding'];delete headers ['Content-Length'];map.headerjson=JSON.stringify(headers);\r\n\r\nvar endpoint = decodeURIComponent(map.endpoint);\r\n\r\nvar x = '{{{request.url}}}';\r\n\r\nprint(\"URL is\"+x);\r\n\r\nvar z = decodeURIComponent(x);\r\n\r\nvar s = z.split(\"?\");\r\n\r\nvar cb = \"\";\r\n\r\nfor(var i =0;i<s.length;i++)\r\n{\r\n    var v = s[i].indexOf(\"callback_url\");\r\n    if(v>-1)\r\n    {\r\n        cb=s[i];\r\n        break;\r\n    }\r\n\r\n}\r\n\r\nvar sp = \"\";\r\nvar s2 = cb.split(\"&\");\r\n\r\nvar final = \"\";\r\nif(s2.length>0)\r\n{\r\n    for(var i = 0;i<s2.length;i++)\r\n    {\r\n    var v = s2[i].indexOf(\"callback_url\");\r\n    if(v>-1)\r\n    {\r\n        var s4 = s2[i].split(\"=\");\r\n        cb=s4[1];\r\n        break;\r\n    }\r\n    }\r\n    print(\"Has\");\r\n}\r\nelse\r\n{\r\n var xy = cb.split(\"=\");\r\n cb = xy[1];\r\n\r\n}\r\n\r\nvar cb_url = decodeURIComponent(cb);\r\nprint(\"callback Url\"+cb_url);\r\n\r\nmap.cb_url = cb_url;\r\nmap.endpoint = endpoint;","inline":"true","type":"code-js","id":"PBXCBPDXs8H4a","next":{"success":"PBXo2XTVawIHn","failure":"hangup"}},{"name":"headers","value":"{{{jsonstr request.headers}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXzJQyeLzDEh","next":{"success":"PBXCBPDXs8H4a","failure":"hangup"}},{"json_is":"true","json_name":"resp8","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"Callback URL failed"},{"key":"URL","value":"{{{cb_url}}}"}],"type":"set-var-multi","id":"PBXc20Ms8nNur","next":{"success":"PBX3viml80XQH","failure":"hangup"}},{"url":"{{{cb_url}}}","method":"POST","raw":"{{{endpointOutput}}}","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"callbackUrlOutput","value_type":"hb","query_parameters":[],"headers":[{"key":"Content-Type","value":"application/json"}],"body_parameters":[],"type":"rest","id":"PBXVKzxC6TxC7","next":{"success":"PBX13xzbJhto2","failure":"PBXc20Ms8nNur"}},{"name":"method","value":"{{{request.body.method}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXJ8E0EZRAc7","next":{"success":"PBXAvxBn6ZQ7S","failure":"hangup"}}]},{"id":139942,"name":"DB_Cache_Delete","trigger":"daemon","expression":"0 */5 * ? * *","execute_continues":"true","sleep_interval":null,"steps":[{"type":"start","id":1,"next":{"start":"PBXe4MTX7DgwT"}},{"plugin_name":"sql-plugin","value":"DELETE  FROM KEY_VALUE where expire_time <= unix_timestamp()*1000;","value_type":"hb","output_variable":"deleted_data","type":"sql-delete","id":"PBXe4MTX7DgwT","next":{"success":"PBX5HunV2QsAS","failure":"hangup"}},{"variable_name":"deleted_data","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX5HunV2QsAS","next":{"success":"hangup","failure":"hangup"}}]},{"id":140534,"name":"ALERT_SELECT","trigger":"rest","expression":"/alerts/{app_name}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXOZIllvtnP6"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXdrFKdhC5GQ","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXKJqymyyksU","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select <#if request.params.fields??> ${request.params.fields} <#else> *  </#if> from `alert` where  created_by=${session.user_id} and app_name='${request.path.app_name}' order by created_date desc <#if request.params.limit??> limit ${request.params.limit}<#else> limit 100 </#if>","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXhzLQRr9kBC","next":{"success":"PBXdrFKdhC5GQ","failure":"PBXuSNvfu0api"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXOZIllvtnP6","next":{"success":"PBXfyywOrrN3B","failure":"PBXhzLQRr9kBC"}},{"name":"failed","value":"select <#if request.params.fields??> ${request.params.fields} <#else> *  </#if> from `alert` where  created_by=${session.user_id} and app_name='${request.path.app_name}' order by created_date desc <#if request.params.limit??> limit ${request.params.limit}<#else> limit 100 </#if>","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXfyywOrrN3B","next":{"success":"PBXeRX5Hxap50","failure":"hangup"}},{"variable_name":"failed","http_response_code":"200","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXeRX5Hxap50","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Select Failed"}],"type":"set-var-multi","id":"PBXuSNvfu0api","next":{"success":"PBXKJqymyyksU","failure":"hangup"}}]},{"id":140535,"name":"ALERT_INSERT","trigger":"rest","expression":"/alerts/{app_name}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXguM3b7HaLS"}},{"variable_name":"insert_task","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXdrFKdhC5GQ","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXKJqymyyksU","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXOZIllvtnP6","next":{"success":"PBXfyywOrrN3B","failure":"PBX3uuTT6yCih"}},{"name":"failed","value":"INSERT INTO `alert` (domain_id,created_by,app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES({{session.tenant_id}},{{session.user_id}},'{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXfyywOrrN3B","next":{"success":"PBXeRX5Hxap50","failure":"PBXeRX5Hxap50"}},{"variable_name":"failed","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXeRX5Hxap50","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Insert Failed"}],"type":"set-var-multi","id":"PBXuSNvfu0api","next":{"success":"PBXKJqymyyksU","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `alert` (domain_id,created_by,app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES({{session.tenant_id}},{{session.user_id}},'{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"insert_output","type":"sql-insert","id":"PBX3uuTT6yCih","next":{"success":"PBXTwRC0JcD2u","failure":"PBXuSNvfu0api"}},{"plugin_name":"alert_DB","value":"select id from `alert`  where created_by = {{session.user_id}} and app_name = '{{request.path.app_name}}' order by id asc","value_type":"hb","output_variable":"select","type":"sql","id":"PBXguM3b7HaLS","next":{"success":"PBXWNwBg2UJKq","failure":"PBXhR1k0RHHtt"}},{"output_variable":"checkCount","if_type":"value","variable1":"{{select_size}}","comparator":"greater_than_or_equals","variable2":"99","value_type":"hb","type":"if-condition","id":"PBXWNwBg2UJKq","next":{"success":"PBXAsICT5iXdF","failure":"PBXOZIllvtnP6"}},{"name":"failedSelect","value":"select id from `alert`  where created_by = {{session.user_id}} and app_name = '{{request.path.app_name}}' order by id asc","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXhR1k0RHHtt","next":{"success":"PBXDTA2H0qIlO","failure":"hangup"}},{"variable_name":"failedSelect","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXDTA2H0qIlO","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"delete from alert where id={{deleteID}}","value_type":"hb","output_variable":"deleteSuccess","type":"sql-delete","id":"PBX49N2L5NKaO","next":{"success":"PBX3uuTT6yCih","failure":"PBXxiKPdlHn5T"}},{"src":"var id = map.select[0].id;\r\nmap.deleteID = id;","inline":"true","type":"code-js","id":"PBXAsICT5iXdF","next":{"success":"PBX49N2L5NKaO","failure":"PBXVHyeKswOTs"}},{"name":"failed","value":"delete from alert where id={{deleteID}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXxiKPdlHn5T","next":{"success":"PBXl5EUpm523M","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXl5EUpm523M","next":{"success":"hangup","failure":"hangup"}},{"name":"failedSelect","value":"{{select}} zero {{select[0]}} size {{select_size}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXVHyeKswOTs","next":{"success":"PBXXsbaIVrWlA","failure":"hangup"}},{"variable_name":"failedSelect","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXXsbaIVrWlA","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"checkCount","if_type":"value","variable1":"{{request.body.time_to_live}}","comparator":"greater_than_or_equals","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXyn5AAWqFJM","next":{"success":"PBXvWSoMqMhMz","failure":"hangup"}},{"name":"taskFail","value":"INSERT INTO `task` (JSON_CODE) VALUES({{{json}}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXkzhrVcKP72","next":{"success":"PBXv1LbJsW89T","failure":"hangup"}},{"name":"ifFail","value":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFBJp0J8w8e","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"insert_output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXTwRC0JcD2u","next":{"success":"hangup","failure":"hangup"}},{"src":"var obj = {\r\n\t\"nodes\": [{\r\n\t\t\"NodeDefinition\": {\r\n\t\t\t\"name\": \"Start\",\r\n\t\t\t\"thumbnail\": \"json/nodes/images/common/Start.png\",\r\n\t\t\t\"icon\": \"json/nodes/icons/common/Start.png\",\r\n\t\t\t\"info\": \"Entry point of your campaign. Please create workflow for your campaign starting from here.\",\r\n\t\t\t\"help\": \"Start point in your campaign workflow.\",\r\n\t\t\t\"author\": \"Appup Dev\",\r\n\t\t\t\"type\": {\r\n\t\t\t\t\"name\": \"start\"\r\n\t\t\t},\r\n\t\t\t\"company\": \"Appup\",\r\n\t\t\t\"language\": \"en\",\r\n\t\t\t\"branches\": \"start\",\r\n\t\t\t\"workflow_tasklet_class_name\": \"com.appup.workflows.core.steps.StartStepExecutor\",\r\n\t\t\t\"category\": \"Basic\",\r\n\t\t\t\"ui\": [{\r\n\t\t\t\t\"label\": \"Entry point of your campaign. Please create workflow for your campaign starting from here.\",\r\n\t\t\t\t\"category\": \"Help\",\r\n\t\t\t\t\"componet\": \"label\",\r\n\t\t\t\t\"type\": \"label\"\r\n\t\t\t}]\r\n\t\t},\r\n\t\t\"id\": \"PBXNODE1\",\r\n\t\t\"xPosition\": 500,\r\n\t\t\"yPosition\": 10,\r\n\t\t\"displayname\": \"Start\",\r\n\t\t\"JsonValues\": [],\r\n\t\t\"States\": [{\r\n\t\t\t\"start\": \"PBXS45xyAkvTv\"\r\n\t\t}]\r\n\t}, {\r\n\t\t\"NodeDefinition\": {\r\n\t\t\t\"author\": \"Appup Developer\",\r\n\t\t\t\"branches\": \"success,failure\",\r\n\t\t\t\"category\": \"Email\",\r\n\t\t\t\"company\": \"Appup.com\",\r\n\t\t\t\"displayname\": \"Email\",\r\n\t\t\t\"help\": \"Send email.\",\r\n\t\t\t\"icon\": \"json/nodes/icons/email/sendemail.png\",\r\n\t\t\t\"id\": \"Email_Step\",\r\n\t\t\t\"info\": \"Send email.\",\r\n\t\t\t\"language\": \"en\",\r\n\t\t\t\"material_icon\": \"email\",\r\n\t\t\t\"material_icon_bg_color\": \"bg_blue\",\r\n\t\t\t\"material_icon_color\": \"blue\",\r\n\t\t\t\"material_icon_img\": \"storage\",\r\n\t\t\t\"name\": \"Email\",\r\n\t\t\t\"thumbnail\": \"json/nodes/images/email/sendemail.png\",\r\n\t\t\t\"task-type\": {\r\n\t\t\t\t\"name\": \"rest-task\",\r\n\t\t\t\t\"type\": \"set\"\r\n\t\t\t},\r\n\t\t\t\"ui\": [{\r\n\t\t\t\t\"category\": \"Send email\",\r\n\t\t\t\t\"fieldType\": \"input\",\r\n\t\t\t\t\"id\": \"subject\",\r\n\t\t\t\t\"label\": \"Subject*\",\r\n\t\t\t\t\"name\": \"subject\",\r\n\t\t\t\t\"required\": true,\r\n\t\t\t\t\"title\": \"Enter your subject for your email\",\r\n\t\t\t\t\"type\": \"text\"\r\n\t\t\t}]\r\n\t\t},\r\n\t\t\"id\": \"PBXQffvo7UEtL\",\r\n\t\t\"xPosition\": 200,\r\n\t\t\"yPosition\": 200,\r\n\t\t\"displayname\": \"Email\",\r\n\t\t\"JsonValues\": [{\r\n\t\t\t\"name\": \"nodename\",\r\n\t\t\t\"value\": \"Email\"\r\n\t\t}],\r\n\t\t\"States\": [{\r\n\t\t\t\"success\": \"hangup\"\r\n\t\t}, {\r\n\t\t\t\"failure\": \"hangup\"\r\n\t\t}]\r\n\t}]\r\n};\r\nobj.nodes[1].JsonValues[0].name = 'id';\r\nobj.nodes[1].JsonValues[0].value = {{{insert_output.GENERATED_KEY}}};\r\nmap.json = obj;\r\n\r\n","inline":"true","type":"code-js","id":"PBXvWSoMqMhMz","next":{"success":"PBXVnDonakvQr","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `task` (JSON_CODE) VALUES({{{json}}})","value_type":"hb","output_variable":"insert_task","type":"sql-insert","id":"PBXVnDonakvQr","next":{"success":"PBXdrFKdhC5GQ","failure":"PBXkzhrVcKP72"}},{"variable_name":"taskFail","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXv1LbJsW89T","next":{"success":"hangup","failure":"hangup"}}]},{"id":140537,"name":"ALERT_DELETE","trigger":"rest","expression":"/alerts/{app_name}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXOZIllvtnP6"}},{"variable_name":"delete_output","http_response_code":"200","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXdrFKdhC5GQ","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXKJqymyyksU","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXOZIllvtnP6","next":{"success":"PBXfyywOrrN3B","failure":"PBXOx8FznwbOh"}},{"name":"failed","value":"DELETE FROM `alert` WHERE <#if request.params.id??> id = ${request.params.id} and created_by=${session.user_id} <#elseif request.params.date??> created_date <= '${request.params.date}' and created_by=${session.user_id} <#else> created_by=${session.user_id} </#if> and app_name = '${request.path.app_name}'","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXfyywOrrN3B","next":{"success":"PBXeRX5Hxap50","failure":"hangup"}},{"variable_name":"failed","http_response_code":"200","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXeRX5Hxap50","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Delete Failed"}],"type":"set-var-multi","id":"PBXuSNvfu0api","next":{"success":"PBXKJqymyyksU","failure":"hangup"}},{"plugin_name":"alert_DB","value":"DELETE FROM `alert` WHERE <#if request.params.id??> id = ${request.params.id} and created_by=${session.user_id} <#elseif request.params.date??> created_date <= '${request.params.date}' and created_by=${session.user_id} <#else> created_by=${session.user_id} </#if> and app_name = '${request.path.app_name}'","value_type":"ftl","output_variable":"delete_output","type":"sql-delete","id":"PBXOx8FznwbOh","next":{"success":"PBXdrFKdhC5GQ","failure":"PBXuSNvfu0api"}}]},{"id":140536,"name":"ALERT_UPDATE","trigger":"rest","expression":"/alerts/{app_name}/{id}","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXOZIllvtnP6"}},{"variable_name":"update_output","http_response_code":"200","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXdrFKdhC5GQ","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXKJqymyyksU","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXOZIllvtnP6","next":{"success":"PBXfyywOrrN3B","failure":"PBXVGdlLhsfek"}},{"name":"failed","value":"UPDATE `alert` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id} and created_by=${session.user_id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXfyywOrrN3B","next":{"success":"PBXeRX5Hxap50","failure":"hangup"}},{"variable_name":"failed","http_response_code":"200","response_content_type":"application/json","value_type":"ftl","type":"send","id":"PBXeRX5Hxap50","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Update Failed"}],"type":"set-var-multi","id":"PBXuSNvfu0api","next":{"success":"PBXKJqymyyksU","failure":"hangup"}},{"plugin_name":"alert_DB","value":"UPDATE `alert` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id} and created_by=${session.user_id}","value_type":"ftl","output_variable":"update_output","type":"sql-update","id":"PBXVGdlLhsfek","next":{"success":"PBXdrFKdhC5GQ","failure":"PBXuSNvfu0api"}}]},{"id":140577,"name":"DELETE_EXPIRED_TTL","trigger":"rest","expression":"/alert/ttldel","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXsMT0CsS8nM"}},{"plugin_name":"alert_DB","value":"select * from alert where time_to_live !=0 and is_active = 1","value_type":"hb","output_variable":"output","type":"sql","id":"PBXsMT0CsS8nM","next":{"success":"PBXe9oXHXTiOG","failure":"hangup"}},{"src":"var res = {{{getRes}}};\r\nprint(\"getressssssssss\" , {{{getRes}}});\r\nmap.length = res.length;\r\nprint(\"length\" ,length);\r\nmap.form = res[map.index];\r\nvar startDate = form.created_date;\r\nstartDate = new Date(startDate);\r\nvar endDate = new Date();\r\nvar seconds = (endDate.getTime() - startDate.getTime()) / 1000;\r\nmap.TTl = form.time_to_live;\r\nmap.seconds = seconds;\r\nmap.id = form.id;","inline":"true","type":"code-js","id":"PBXtXVzn7UfxQ","next":{"success":"hangup","failure":"hangup"}},{"name":"index","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXe9oXHXTiOG","next":{"success":"PBX5t8CLe5zfW","failure":"hangup"}},{"output_variable":"secondsCheck","if_type":"value","variable1":"{{checkValue}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXpLNnTIiEAa","next":{"success":"PBX8s231dPTKk","failure":"PBXwydyIXXGcH"}},{"plugin_name":"alert_DB","value":"update alert set is_active = 0 where id = {{{id}}}","value_type":"hb","output_variable":"update_output","type":"sql-update","id":"PBX8s231dPTKk","next":{"success":"PBXwydyIXXGcH","failure":"PBXHi9yyEmhLT"}},{"name":"updateFailed","value":"update alert set is_active = 0 where id = {{{id}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXHi9yyEmhLT","next":{"success":"PBXbVRQuhiRBF","failure":"hangup"}},{"src":"var index = parseInt(map.index);\r\nindex +=1;\r\nmap.index=\"\"+index;\r\nprint(\"AFTER INDEX\",map.index);","inline":"true","type":"code-js","id":"PBXwydyIXXGcH","next":{"success":"PBXm4BG3IniGu","failure":"PBXKORuQm3Sew"}},{"variable_name":"updateFailed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXbVRQuhiRBF","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"indexFailed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXwtqzgn8oSK","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"secondsCheck","if_type":"value","variable1":"{{{index}}}","comparator":"less_than","variable2":"{{{length}}}","value_type":"hb","type":"if-condition","id":"PBXm4BG3IniGu","next":{"success":"PBX5t8CLe5zfW","failure":"PBXGuxaItxPZm"}},{"name":"indexFailed","value":"js Failed inc {{index}} TTl ::  {{TTl}} seconds ::  {{seconds}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXKORuQm3Sew","next":{"success":"PBXwtqzgn8oSK","failure":"hangup"}},{"src":"if(map.select_output){\r\nvar res = {{{select_output}}};\r\nmap.res =  res;\r\nmap.length = res.length;\r\n}\r\nelse{\r\nmap.index = 1 \r\n}","inline":"true","type":"code-js","id":"PBXSLA6egCCfv","next":{"success":"hangup","failure":"hangup"}},{"name":"vb","value":"Done {{{index}}} length : {{{length}}}  TTl ::  {{TTl}} seconds ::  {{seconds}} id :: {{id}} checkValue {{checkValue}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGuxaItxPZm","next":{"success":"PBXga2xqRcTkd","failure":"hangup"}},{"variable_name":"vb","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXga2xqRcTkd","next":{"success":"hangup","failure":"hangup"}},{"src":"map.length = map.output.length;\r\nmap.form =map.output[map.index];\r\nvar startDate =map.output[map.index].created_date;\r\nstartDate = new Date(startDate);\r\nvar endDate = new Date();\r\nvar seconds = (endDate.getTime() - startDate.getTime()) / 1000;\r\nvar sec = Math.floor(seconds);\r\nmap.TTl =map.output[map.index].time_to_live;\r\nmap.seconds = sec;\r\nif(map.TTl <= map.seconds){\r\nmap.checkValue = 1;\r\n}\r\nelse{\r\nmap.checkValue = 0;\r\n}\r\nmap.id = map.output[map.index].id;","inline":"true","type":"code-js","id":"PBX5t8CLe5zfW","next":{"success":"PBXpLNnTIiEAa","failure":"PBXAFqpMpruKL"}},{"variable_name":"length","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXAFqpMpruKL","next":{"success":"hangup","failure":"hangup"}}]},{"id":140577,"name":"DELETE_EXPIRED_TTL","trigger":"daemon","expression":"0 * * ? * *\t","execute_continues":"true","sleep_interval":null,"steps":[{"type":"start","id":1,"next":{"start":"PBXsMT0CsS8nM"}},{"plugin_name":"alert_DB","value":"select * from alert where time_to_live !=0 and is_active = 1","value_type":"hb","output_variable":"output","type":"sql","id":"PBXsMT0CsS8nM","next":{"success":"PBXe9oXHXTiOG","failure":"hangup"}},{"src":"var res = {{{getRes}}};\r\nprint(\"getressssssssss\" , {{{getRes}}});\r\nmap.length = res.length;\r\nprint(\"length\" ,length);\r\nmap.form = res[map.index];\r\nvar startDate = form.created_date;\r\nstartDate = new Date(startDate);\r\nvar endDate = new Date();\r\nvar seconds = (endDate.getTime() - startDate.getTime()) / 1000;\r\nmap.TTl = form.time_to_live;\r\nmap.seconds = seconds;\r\nmap.id = form.id;","inline":"true","type":"code-js","id":"PBXtXVzn7UfxQ","next":{"success":"hangup","failure":"hangup"}},{"name":"index","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXe9oXHXTiOG","next":{"success":"PBX5t8CLe5zfW","failure":"hangup"}},{"output_variable":"secondsCheck","if_type":"value","variable1":"{{checkValue}}","comparator":"equal_to","variable2":"1","value_type":"hb","type":"if-condition","id":"PBXpLNnTIiEAa","next":{"success":"PBX8s231dPTKk","failure":"PBXwydyIXXGcH"}},{"plugin_name":"alert_DB","value":"update alert set is_active = 0 where id = {{{id}}}","value_type":"hb","output_variable":"update_output","type":"sql-update","id":"PBX8s231dPTKk","next":{"success":"PBXwydyIXXGcH","failure":"PBXHi9yyEmhLT"}},{"name":"updateFailed","value":"update alert set is_active = 0 where id = {{{id}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXHi9yyEmhLT","next":{"success":"PBXbVRQuhiRBF","failure":"hangup"}},{"src":"var index = parseInt(map.index);\r\nindex +=1;\r\nmap.index=\"\"+index;\r\nprint(\"AFTER INDEX\",map.index);","inline":"true","type":"code-js","id":"PBXwydyIXXGcH","next":{"success":"PBXm4BG3IniGu","failure":"PBXKORuQm3Sew"}},{"variable_name":"updateFailed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXbVRQuhiRBF","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"indexFailed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXwtqzgn8oSK","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"secondsCheck","if_type":"value","variable1":"{{{index}}}","comparator":"less_than","variable2":"{{{length}}}","value_type":"hb","type":"if-condition","id":"PBXm4BG3IniGu","next":{"success":"PBX5t8CLe5zfW","failure":"PBXGuxaItxPZm"}},{"name":"indexFailed","value":"js Failed inc {{index}} TTl ::  {{TTl}} seconds ::  {{seconds}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXKORuQm3Sew","next":{"success":"PBXwtqzgn8oSK","failure":"hangup"}},{"src":"if(map.select_output){\r\nvar res = {{{select_output}}};\r\nmap.res =  res;\r\nmap.length = res.length;\r\n}\r\nelse{\r\nmap.index = 1 \r\n}","inline":"true","type":"code-js","id":"PBXSLA6egCCfv","next":{"success":"hangup","failure":"hangup"}},{"name":"vb","value":"Done {{{index}}} length : {{{length}}}  TTl ::  {{TTl}} seconds ::  {{seconds}} id :: {{id}} checkValue {{checkValue}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXGuxaItxPZm","next":{"success":"PBXga2xqRcTkd","failure":"hangup"}},{"variable_name":"vb","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXga2xqRcTkd","next":{"success":"hangup","failure":"hangup"}},{"src":"map.length = map.output.length;\r\nmap.form =map.output[map.index];\r\nvar startDate =map.output[map.index].created_date;\r\nstartDate = new Date(startDate);\r\nvar endDate = new Date();\r\nvar seconds = (endDate.getTime() - startDate.getTime()) / 1000;\r\nvar sec = Math.floor(seconds);\r\nmap.TTl =map.output[map.index].time_to_live;\r\nmap.seconds = sec;\r\nif(map.TTl <= map.seconds){\r\nmap.checkValue = 1;\r\n}\r\nelse{\r\nmap.checkValue = 0;\r\n}\r\nmap.id = map.output[map.index].id;","inline":"true","type":"code-js","id":"PBX5t8CLe5zfW","next":{"success":"PBXpLNnTIiEAa","failure":"PBXAFqpMpruKL"}},{"variable_name":"length","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXAFqpMpruKL","next":{"success":"hangup","failure":"hangup"}}]},{"id":141001,"name":"RedisOperations","trigger":"rest","expression":"/rcache/{app-name}/{time-to-expire-in-secs}/{type}/{key}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXiehf371a6Q"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRCWBVNoZc7","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXgUzJyNQ2hI","next":{"success":"PBXPTqzZpM0vI","failure":"hangup"}},{"name":"result","value":"{{{result}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNmqq0tUx4s","next":{"success":"PBXS0n16L8yBz","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXPCilZqwJtM","next":{"success":"hangup","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXEtyR4V4w8M","next":{"success":"PBXvKr1p134vk","failure":"PBX2QK7gGiu94"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","type":"jedis-del","id":"PBXgM2LlS916T","next":{"success":"PBX1mlzO5R5qc","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXiehf371a6Q","next":{"success":"PBXJqffxRn9hn","failure":"PBXoMkfk5VnFK"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXJqffxRn9hn","next":{"POST":"PBXgUzJyNQ2hI","PUT":"PBXXaT7wJWvwU","GET":"PBXdEyD6G8Pc1","DELETE":"PBXBpo174kMXk"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXoMkfk5VnFK","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXaT7wJWvwU","next":{"success":"PBXskSdW6mBc1","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\nmap.typeof12 = typeof(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.k){\r\nval = map.v+','+data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\nif(c>0){\r\ndata[map.k]=val;\r\n}\r\nelse{\r\ndata[map.k]=map.v;\r\n}\r\nmap.value =JSON.stringify(data);\r\n\r\n}","inline":"true","type":"code-js","id":"PBXuVWneHCkO3","next":{"success":"PBX9sSshzNmFK","failure":"PBXZUVHJLheTm"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXS0n16L8yBz","next":{"success":"hangup","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar key='';\r\nif(map.method_type=='GET'){\r\n\r\nif(map.request.path.jsonkey){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n}\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXRTfw0NFI3X","next":{"success":"PBXEtyR4V4w8M","failure":"hangup"}},{"name":"Failed","value":"key  : {{{key}}} jsonkey :: {{request.path.jsonkey}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2QK7gGiu94","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"{{request.path.jsonkey}}","value":"{{{getKey}}}"}],"type":"set-var-multi","id":"PBXvKr1p134vk","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"ss","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXI21zhrvQR9","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXilAF2wFHBm","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;","inline":"true","type":"code-js","id":"PBXBpo174kMXk","next":{"success":"PBXPJJyv21FRp","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBX9sSshzNmFK","next":{"success":"PBXV6OXtt2Afd","failure":"PBXV6OXtt2Afd"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBXV6OXtt2Afd","next":{"success":"PBXRCWBVNoZc7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXRVh867BsTw","next":{"success":"PBXuVWneHCkO3","failure":"PBXvOpo2u181N"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXskSdW6mBc1","next":{"success":"PBXRVh867BsTw","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXPTqzZpM0vI","next":{"success":"PBXs6ZsSydUG7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXs6ZsSydUG7","next":{"success":"PBXAMDkdJIOf3","failure":"PBXvOpo2u181N"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null'){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\ndata[map.k]=map.v;\r\nmap.value =JSON.stringify(data);\r\n\r\n} \r\n\r\n","inline":"true","type":"code-js","id":"PBXAMDkdJIOf3","next":{"success":"PBX9sSshzNmFK","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"key","value":"{{{key1}}} and key {{{key}}}"},{"key":"expire","value":"{{{expaire}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"typeof12","value":"{{{typeof12}}}"},{"key":"k n v","value":"{{{k}}} and {{{v}}}"}],"type":"set-var-multi","id":"PBXZUVHJLheTm","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXmv4CHAzXLk","next":{"success":"PBX8gkanbMvFk","failure":"PBXKv7n1osL9G"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXdEyD6G8Pc1","next":{"success":"PBX7THUnpA1qz","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBX7THUnpA1qz","next":{"success":"PBXmv4CHAzXLk","failure":"PBXvOpo2u181N"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\n\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.request.path.jsonkey){\r\nval = data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\n\r\nif(c>0){\r\nresult = [];\r\nvar k = '{{{key1}}}-{{{request.path.jsonkey}}}';\r\n\r\nif(val.indexOf(',')>0){\r\nvar split =val.split(',');\r\nfor(var j=0;j<split.length;j++){\r\nresult.push(split[j]);\r\n} \r\n}\r\nelse{\r\nresult.push(val);\r\n}\r\nvar finalOutput = [];\r\nvar data12 = { 'key' : k , 'value' : result}\r\nfinalOutput.push(data12);\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\nelse{\r\nvar finalOutput = [];\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\n\r\n\r\n}\r\n","inline":"true","type":"code-js","id":"PBX8gkanbMvFk","next":{"success":"PBXNmqq0tUx4s","failure":"PBXqLnmB2MVpl"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXqLnmB2MVpl","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXzMxCPkMMcZ","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nvar result = [];\r\n\r\nmap.key = key;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keys = Object.keys(data);\r\nmap.keysss = keys;\r\n\r\nvar array = [];\r\n\r\n\r\nfor(var i=0;i<keys.length;i++){\r\nvar k = keys[i];\r\n\r\nif(data[Object.keys(data)[i]].indexOf(',')>0){\r\nvar split =data[Object.keys(data)[i]].split(',');\r\nfor(var j=0;j<split.length;j++){\r\nvar ob = {};\r\nob[k] = split[j];\r\narray.push(ob);\r\n} \r\n}\r\nelse{\r\nvar value = data[Object.keys(data)[i]];\r\nvar obj = {}\r\nobj[k]=value;\r\narray.push(obj);\r\n}\r\n}\r\nvar finalOutput = [];\r\nvar key12 ={ 'key' : map.key1 , 'value' :  array };\r\nfinalOutput.push(key12);\r\n\r\nmap.result = JSON.stringify(finalOutput);\r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXKv7n1osL9G","next":{"success":"PBXzMxCPkMMcZ","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXd0gDuZ4gRB","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXPJJyv21FRp","next":{"success":"PBX6ckghOphRG","failure":"PBXvOpo2u181N"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX6ckghOphRG","next":{"success":"PBXg9yaRWNBRF","failure":"PBXgM2LlS916T"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult={'result' : 'No such key found' };\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\nvar val = {};\r\nfor(var i=0;i<keyss.length;i++){\r\n\r\nif(keyss[i] == map.request.path.jsonkey){\r\n\r\n} \r\nelse{\r\nvar k = keyss[i];\r\nval[k] = data[Object.keys(data)[i]];\r\n}\r\n}\r\nmap.value =  JSON.stringify(val);\r\nresult={'result' : 'success' };\r\nmap.result = JSON.stringify(result);\r\n}\r\n","inline":"true","type":"code-js","id":"PBXg9yaRWNBRF","next":{"success":"PBXfKBvr7xm9K","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"ss","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBX1mlzO5R5qc","next":{"success":"PBXI21zhrvQR9","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBXfKBvr7xm9K","next":{"success":"PBX6E1boeqC5O","failure":"PBXRp58d0DBVh"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX6E1boeqC5O","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRp58d0DBVh","next":{"success":"hangup","failure":"hangup"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = map.getKey;\r\nmap.result = JSON.stringify(data);\r\n}\r\n","inline":"true","type":"code-js","id":"PBX5bPs0mTIvl","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"failed"},{"key":"key","value":"{{{key1}}}"}],"type":"set-var-multi","id":"PBXvOpo2u181N","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}}]},{"id":141001,"name":"RedisOperations","trigger":"rest","expression":"/rcache/{app-name}/{time-to-expire-in-secs}/{type}/{key}","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXiehf371a6Q"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRCWBVNoZc7","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXgUzJyNQ2hI","next":{"success":"PBXPTqzZpM0vI","failure":"hangup"}},{"name":"result","value":"{{{result}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNmqq0tUx4s","next":{"success":"PBXS0n16L8yBz","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXPCilZqwJtM","next":{"success":"hangup","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXEtyR4V4w8M","next":{"success":"PBXvKr1p134vk","failure":"PBX2QK7gGiu94"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","type":"jedis-del","id":"PBXgM2LlS916T","next":{"success":"PBX1mlzO5R5qc","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXiehf371a6Q","next":{"success":"PBXJqffxRn9hn","failure":"PBXoMkfk5VnFK"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXJqffxRn9hn","next":{"POST":"PBXgUzJyNQ2hI","PUT":"PBXXaT7wJWvwU","GET":"PBXdEyD6G8Pc1","DELETE":"PBXBpo174kMXk"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXoMkfk5VnFK","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXaT7wJWvwU","next":{"success":"PBXskSdW6mBc1","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\nmap.typeof12 = typeof(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.k){\r\nval = map.v+','+data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\nif(c>0){\r\ndata[map.k]=val;\r\n}\r\nelse{\r\ndata[map.k]=map.v;\r\n}\r\nmap.value =JSON.stringify(data);\r\n\r\n}","inline":"true","type":"code-js","id":"PBXuVWneHCkO3","next":{"success":"PBX9sSshzNmFK","failure":"PBXZUVHJLheTm"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXS0n16L8yBz","next":{"success":"hangup","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar key='';\r\nif(map.method_type=='GET'){\r\n\r\nif(map.request.path.jsonkey){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n}\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXRTfw0NFI3X","next":{"success":"PBXEtyR4V4w8M","failure":"hangup"}},{"name":"Failed","value":"key  : {{{key}}} jsonkey :: {{request.path.jsonkey}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2QK7gGiu94","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"{{request.path.jsonkey}}","value":"{{{getKey}}}"}],"type":"set-var-multi","id":"PBXvKr1p134vk","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"ss","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXI21zhrvQR9","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXilAF2wFHBm","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;","inline":"true","type":"code-js","id":"PBXBpo174kMXk","next":{"success":"PBXPJJyv21FRp","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBX9sSshzNmFK","next":{"success":"PBXV6OXtt2Afd","failure":"PBXV6OXtt2Afd"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBXV6OXtt2Afd","next":{"success":"PBXRCWBVNoZc7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXRVh867BsTw","next":{"success":"PBXuVWneHCkO3","failure":"PBXvOpo2u181N"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXskSdW6mBc1","next":{"success":"PBXRVh867BsTw","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXPTqzZpM0vI","next":{"success":"PBXs6ZsSydUG7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXs6ZsSydUG7","next":{"success":"PBXAMDkdJIOf3","failure":"PBXvOpo2u181N"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null'){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\ndata[map.k]=map.v;\r\nmap.value =JSON.stringify(data);\r\n\r\n} \r\n\r\n","inline":"true","type":"code-js","id":"PBXAMDkdJIOf3","next":{"success":"PBX9sSshzNmFK","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"key","value":"{{{key1}}} and key {{{key}}}"},{"key":"expire","value":"{{{expaire}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"typeof12","value":"{{{typeof12}}}"},{"key":"k n v","value":"{{{k}}} and {{{v}}}"}],"type":"set-var-multi","id":"PBXZUVHJLheTm","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXmv4CHAzXLk","next":{"success":"PBX8gkanbMvFk","failure":"PBXKv7n1osL9G"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXdEyD6G8Pc1","next":{"success":"PBX7THUnpA1qz","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBX7THUnpA1qz","next":{"success":"PBXmv4CHAzXLk","failure":"PBXvOpo2u181N"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\n\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.request.path.jsonkey){\r\nval = data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\n\r\nif(c>0){\r\nresult = [];\r\nvar k = '{{{key1}}}-{{{request.path.jsonkey}}}';\r\n\r\nif(val.indexOf(',')>0){\r\nvar split =val.split(',');\r\nfor(var j=0;j<split.length;j++){\r\nresult.push(split[j]);\r\n} \r\n}\r\nelse{\r\nresult.push(val);\r\n}\r\nvar finalOutput = [];\r\nvar data12 = { 'key' : k , 'value' : result}\r\nfinalOutput.push(data12);\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\nelse{\r\nvar finalOutput = [];\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\n\r\n\r\n}\r\n","inline":"true","type":"code-js","id":"PBX8gkanbMvFk","next":{"success":"PBXNmqq0tUx4s","failure":"PBXqLnmB2MVpl"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXqLnmB2MVpl","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXzMxCPkMMcZ","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nvar result = [];\r\n\r\nmap.key = key;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keys = Object.keys(data);\r\nmap.keysss = keys;\r\n\r\nvar array = [];\r\n\r\n\r\nfor(var i=0;i<keys.length;i++){\r\nvar k = keys[i];\r\n\r\nif(data[Object.keys(data)[i]].indexOf(',')>0){\r\nvar split =data[Object.keys(data)[i]].split(',');\r\nfor(var j=0;j<split.length;j++){\r\nvar ob = {};\r\nob[k] = split[j];\r\narray.push(ob);\r\n} \r\n}\r\nelse{\r\nvar value = data[Object.keys(data)[i]];\r\nvar obj = {}\r\nobj[k]=value;\r\narray.push(obj);\r\n}\r\n}\r\nvar finalOutput = [];\r\nvar key12 ={ 'key' : map.key1 , 'value' :  array };\r\nfinalOutput.push(key12);\r\n\r\nmap.result = JSON.stringify(finalOutput);\r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXKv7n1osL9G","next":{"success":"PBXzMxCPkMMcZ","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXd0gDuZ4gRB","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXPJJyv21FRp","next":{"success":"PBX6ckghOphRG","failure":"PBXvOpo2u181N"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX6ckghOphRG","next":{"success":"PBXg9yaRWNBRF","failure":"PBXgM2LlS916T"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult={'result' : 'No such key found' };\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\nvar val = {};\r\nfor(var i=0;i<keyss.length;i++){\r\n\r\nif(keyss[i] == map.request.path.jsonkey){\r\n\r\n} \r\nelse{\r\nvar k = keyss[i];\r\nval[k] = data[Object.keys(data)[i]];\r\n}\r\n}\r\nmap.value =  JSON.stringify(val);\r\nresult={'result' : 'success' };\r\nmap.result = JSON.stringify(result);\r\n}\r\n","inline":"true","type":"code-js","id":"PBXg9yaRWNBRF","next":{"success":"PBXfKBvr7xm9K","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"ss","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBX1mlzO5R5qc","next":{"success":"PBXI21zhrvQR9","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBXfKBvr7xm9K","next":{"success":"PBX6E1boeqC5O","failure":"PBXRp58d0DBVh"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX6E1boeqC5O","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRp58d0DBVh","next":{"success":"hangup","failure":"hangup"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = map.getKey;\r\nmap.result = JSON.stringify(data);\r\n}\r\n","inline":"true","type":"code-js","id":"PBX5bPs0mTIvl","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"failed"},{"key":"key","value":"{{{key1}}}"}],"type":"set-var-multi","id":"PBXvOpo2u181N","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}}]},{"id":141001,"name":"RedisOperations","trigger":"rest","expression":"/rcache/{app-name}/{type}/{key}/keys/{jsonkey}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXiehf371a6Q"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRCWBVNoZc7","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXgUzJyNQ2hI","next":{"success":"PBXPTqzZpM0vI","failure":"hangup"}},{"name":"result","value":"{{{result}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNmqq0tUx4s","next":{"success":"PBXS0n16L8yBz","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXPCilZqwJtM","next":{"success":"hangup","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXEtyR4V4w8M","next":{"success":"PBXvKr1p134vk","failure":"PBX2QK7gGiu94"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","type":"jedis-del","id":"PBXgM2LlS916T","next":{"success":"PBX1mlzO5R5qc","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXiehf371a6Q","next":{"success":"PBXJqffxRn9hn","failure":"PBXoMkfk5VnFK"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXJqffxRn9hn","next":{"POST":"PBXgUzJyNQ2hI","PUT":"PBXXaT7wJWvwU","GET":"PBXdEyD6G8Pc1","DELETE":"PBXBpo174kMXk"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXoMkfk5VnFK","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXaT7wJWvwU","next":{"success":"PBXskSdW6mBc1","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\nmap.typeof12 = typeof(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.k){\r\nval = map.v+','+data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\nif(c>0){\r\ndata[map.k]=val;\r\n}\r\nelse{\r\ndata[map.k]=map.v;\r\n}\r\nmap.value =JSON.stringify(data);\r\n\r\n}","inline":"true","type":"code-js","id":"PBXuVWneHCkO3","next":{"success":"PBX9sSshzNmFK","failure":"PBXZUVHJLheTm"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXS0n16L8yBz","next":{"success":"hangup","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar key='';\r\nif(map.method_type=='GET'){\r\n\r\nif(map.request.path.jsonkey){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n}\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXRTfw0NFI3X","next":{"success":"PBXEtyR4V4w8M","failure":"hangup"}},{"name":"Failed","value":"key  : {{{key}}} jsonkey :: {{request.path.jsonkey}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2QK7gGiu94","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"{{request.path.jsonkey}}","value":"{{{getKey}}}"}],"type":"set-var-multi","id":"PBXvKr1p134vk","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"ss","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXI21zhrvQR9","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXilAF2wFHBm","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;","inline":"true","type":"code-js","id":"PBXBpo174kMXk","next":{"success":"PBXPJJyv21FRp","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBX9sSshzNmFK","next":{"success":"PBXV6OXtt2Afd","failure":"PBXV6OXtt2Afd"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBXV6OXtt2Afd","next":{"success":"PBXRCWBVNoZc7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXRVh867BsTw","next":{"success":"PBXuVWneHCkO3","failure":"PBXvOpo2u181N"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXskSdW6mBc1","next":{"success":"PBXRVh867BsTw","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXPTqzZpM0vI","next":{"success":"PBXs6ZsSydUG7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXs6ZsSydUG7","next":{"success":"PBXAMDkdJIOf3","failure":"PBXvOpo2u181N"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null'){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\ndata[map.k]=map.v;\r\nmap.value =JSON.stringify(data);\r\n\r\n} \r\n\r\n","inline":"true","type":"code-js","id":"PBXAMDkdJIOf3","next":{"success":"PBX9sSshzNmFK","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"key","value":"{{{key1}}} and key {{{key}}}"},{"key":"expire","value":"{{{expaire}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"typeof12","value":"{{{typeof12}}}"},{"key":"k n v","value":"{{{k}}} and {{{v}}}"}],"type":"set-var-multi","id":"PBXZUVHJLheTm","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXmv4CHAzXLk","next":{"success":"PBX8gkanbMvFk","failure":"PBXKv7n1osL9G"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXdEyD6G8Pc1","next":{"success":"PBX7THUnpA1qz","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBX7THUnpA1qz","next":{"success":"PBXmv4CHAzXLk","failure":"PBXvOpo2u181N"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\n\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.request.path.jsonkey){\r\nval = data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\n\r\nif(c>0){\r\nresult = [];\r\nvar k = '{{{key1}}}-{{{request.path.jsonkey}}}';\r\n\r\nif(val.indexOf(',')>0){\r\nvar split =val.split(',');\r\nfor(var j=0;j<split.length;j++){\r\nresult.push(split[j]);\r\n} \r\n}\r\nelse{\r\nresult.push(val);\r\n}\r\nvar finalOutput = [];\r\nvar data12 = { 'key' : k , 'value' : result}\r\nfinalOutput.push(data12);\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\nelse{\r\nvar finalOutput = [];\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\n\r\n\r\n}\r\n","inline":"true","type":"code-js","id":"PBX8gkanbMvFk","next":{"success":"PBXNmqq0tUx4s","failure":"PBXqLnmB2MVpl"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXqLnmB2MVpl","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXzMxCPkMMcZ","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nvar result = [];\r\n\r\nmap.key = key;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keys = Object.keys(data);\r\nmap.keysss = keys;\r\n\r\nvar array = [];\r\n\r\n\r\nfor(var i=0;i<keys.length;i++){\r\nvar k = keys[i];\r\n\r\nif(data[Object.keys(data)[i]].indexOf(',')>0){\r\nvar split =data[Object.keys(data)[i]].split(',');\r\nfor(var j=0;j<split.length;j++){\r\nvar ob = {};\r\nob[k] = split[j];\r\narray.push(ob);\r\n} \r\n}\r\nelse{\r\nvar value = data[Object.keys(data)[i]];\r\nvar obj = {}\r\nobj[k]=value;\r\narray.push(obj);\r\n}\r\n}\r\nvar finalOutput = [];\r\nvar key12 ={ 'key' : map.key1 , 'value' :  array };\r\nfinalOutput.push(key12);\r\n\r\nmap.result = JSON.stringify(finalOutput);\r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXKv7n1osL9G","next":{"success":"PBXzMxCPkMMcZ","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXd0gDuZ4gRB","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXPJJyv21FRp","next":{"success":"PBX6ckghOphRG","failure":"PBXvOpo2u181N"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX6ckghOphRG","next":{"success":"PBXg9yaRWNBRF","failure":"PBXgM2LlS916T"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult={'result' : 'No such key found' };\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\nvar val = {};\r\nfor(var i=0;i<keyss.length;i++){\r\n\r\nif(keyss[i] == map.request.path.jsonkey){\r\n\r\n} \r\nelse{\r\nvar k = keyss[i];\r\nval[k] = data[Object.keys(data)[i]];\r\n}\r\n}\r\nmap.value =  JSON.stringify(val);\r\nresult={'result' : 'success' };\r\nmap.result = JSON.stringify(result);\r\n}\r\n","inline":"true","type":"code-js","id":"PBXg9yaRWNBRF","next":{"success":"PBXfKBvr7xm9K","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"ss","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBX1mlzO5R5qc","next":{"success":"PBXI21zhrvQR9","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBXfKBvr7xm9K","next":{"success":"PBX6E1boeqC5O","failure":"PBXRp58d0DBVh"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX6E1boeqC5O","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRp58d0DBVh","next":{"success":"hangup","failure":"hangup"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = map.getKey;\r\nmap.result = JSON.stringify(data);\r\n}\r\n","inline":"true","type":"code-js","id":"PBX5bPs0mTIvl","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"failed"},{"key":"key","value":"{{{key1}}}"}],"type":"set-var-multi","id":"PBXvOpo2u181N","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}}]},{"id":141001,"name":"RedisOperations","trigger":"rest","expression":"/rcache/{app-name}/{type}/{key}/keys/{jsonkey}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXiehf371a6Q"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRCWBVNoZc7","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXgUzJyNQ2hI","next":{"success":"PBXPTqzZpM0vI","failure":"hangup"}},{"name":"result","value":"{{{result}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNmqq0tUx4s","next":{"success":"PBXS0n16L8yBz","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXPCilZqwJtM","next":{"success":"hangup","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXEtyR4V4w8M","next":{"success":"PBXvKr1p134vk","failure":"PBX2QK7gGiu94"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","type":"jedis-del","id":"PBXgM2LlS916T","next":{"success":"PBX1mlzO5R5qc","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXiehf371a6Q","next":{"success":"PBXJqffxRn9hn","failure":"PBXoMkfk5VnFK"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXJqffxRn9hn","next":{"POST":"PBXgUzJyNQ2hI","PUT":"PBXXaT7wJWvwU","GET":"PBXdEyD6G8Pc1","DELETE":"PBXBpo174kMXk"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXoMkfk5VnFK","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXaT7wJWvwU","next":{"success":"PBXskSdW6mBc1","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\nmap.typeof12 = typeof(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.k){\r\nval = map.v+','+data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\nif(c>0){\r\ndata[map.k]=val;\r\n}\r\nelse{\r\ndata[map.k]=map.v;\r\n}\r\nmap.value =JSON.stringify(data);\r\n\r\n}","inline":"true","type":"code-js","id":"PBXuVWneHCkO3","next":{"success":"PBX9sSshzNmFK","failure":"PBXZUVHJLheTm"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXS0n16L8yBz","next":{"success":"hangup","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar key='';\r\nif(map.method_type=='GET'){\r\n\r\nif(map.request.path.jsonkey){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n}\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXRTfw0NFI3X","next":{"success":"PBXEtyR4V4w8M","failure":"hangup"}},{"name":"Failed","value":"key  : {{{key}}} jsonkey :: {{request.path.jsonkey}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2QK7gGiu94","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"{{request.path.jsonkey}}","value":"{{{getKey}}}"}],"type":"set-var-multi","id":"PBXvKr1p134vk","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"ss","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXI21zhrvQR9","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXilAF2wFHBm","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;","inline":"true","type":"code-js","id":"PBXBpo174kMXk","next":{"success":"PBXPJJyv21FRp","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBX9sSshzNmFK","next":{"success":"PBXV6OXtt2Afd","failure":"PBXV6OXtt2Afd"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBXV6OXtt2Afd","next":{"success":"PBXRCWBVNoZc7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXRVh867BsTw","next":{"success":"PBXuVWneHCkO3","failure":"PBXvOpo2u181N"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXskSdW6mBc1","next":{"success":"PBXRVh867BsTw","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXPTqzZpM0vI","next":{"success":"PBXs6ZsSydUG7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXs6ZsSydUG7","next":{"success":"PBXAMDkdJIOf3","failure":"PBXvOpo2u181N"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null'){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\ndata[map.k]=map.v;\r\nmap.value =JSON.stringify(data);\r\n\r\n} \r\n\r\n","inline":"true","type":"code-js","id":"PBXAMDkdJIOf3","next":{"success":"PBX9sSshzNmFK","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"key","value":"{{{key1}}} and key {{{key}}}"},{"key":"expire","value":"{{{expaire}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"typeof12","value":"{{{typeof12}}}"},{"key":"k n v","value":"{{{k}}} and {{{v}}}"}],"type":"set-var-multi","id":"PBXZUVHJLheTm","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXmv4CHAzXLk","next":{"success":"PBX8gkanbMvFk","failure":"PBXKv7n1osL9G"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXdEyD6G8Pc1","next":{"success":"PBX7THUnpA1qz","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBX7THUnpA1qz","next":{"success":"PBXmv4CHAzXLk","failure":"PBXvOpo2u181N"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\n\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.request.path.jsonkey){\r\nval = data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\n\r\nif(c>0){\r\nresult = [];\r\nvar k = '{{{key1}}}-{{{request.path.jsonkey}}}';\r\n\r\nif(val.indexOf(',')>0){\r\nvar split =val.split(',');\r\nfor(var j=0;j<split.length;j++){\r\nresult.push(split[j]);\r\n} \r\n}\r\nelse{\r\nresult.push(val);\r\n}\r\nvar finalOutput = [];\r\nvar data12 = { 'key' : k , 'value' : result}\r\nfinalOutput.push(data12);\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\nelse{\r\nvar finalOutput = [];\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\n\r\n\r\n}\r\n","inline":"true","type":"code-js","id":"PBX8gkanbMvFk","next":{"success":"PBXNmqq0tUx4s","failure":"PBXqLnmB2MVpl"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXqLnmB2MVpl","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXzMxCPkMMcZ","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nvar result = [];\r\n\r\nmap.key = key;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keys = Object.keys(data);\r\nmap.keysss = keys;\r\n\r\nvar array = [];\r\n\r\n\r\nfor(var i=0;i<keys.length;i++){\r\nvar k = keys[i];\r\n\r\nif(data[Object.keys(data)[i]].indexOf(',')>0){\r\nvar split =data[Object.keys(data)[i]].split(',');\r\nfor(var j=0;j<split.length;j++){\r\nvar ob = {};\r\nob[k] = split[j];\r\narray.push(ob);\r\n} \r\n}\r\nelse{\r\nvar value = data[Object.keys(data)[i]];\r\nvar obj = {}\r\nobj[k]=value;\r\narray.push(obj);\r\n}\r\n}\r\nvar finalOutput = [];\r\nvar key12 ={ 'key' : map.key1 , 'value' :  array };\r\nfinalOutput.push(key12);\r\n\r\nmap.result = JSON.stringify(finalOutput);\r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXKv7n1osL9G","next":{"success":"PBXzMxCPkMMcZ","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXd0gDuZ4gRB","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXPJJyv21FRp","next":{"success":"PBX6ckghOphRG","failure":"PBXvOpo2u181N"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX6ckghOphRG","next":{"success":"PBXg9yaRWNBRF","failure":"PBXgM2LlS916T"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult={'result' : 'No such key found' };\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\nvar val = {};\r\nfor(var i=0;i<keyss.length;i++){\r\n\r\nif(keyss[i] == map.request.path.jsonkey){\r\n\r\n} \r\nelse{\r\nvar k = keyss[i];\r\nval[k] = data[Object.keys(data)[i]];\r\n}\r\n}\r\nmap.value =  JSON.stringify(val);\r\nresult={'result' : 'success' };\r\nmap.result = JSON.stringify(result);\r\n}\r\n","inline":"true","type":"code-js","id":"PBXg9yaRWNBRF","next":{"success":"PBXfKBvr7xm9K","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"ss","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBX1mlzO5R5qc","next":{"success":"PBXI21zhrvQR9","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBXfKBvr7xm9K","next":{"success":"PBX6E1boeqC5O","failure":"PBXRp58d0DBVh"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX6E1boeqC5O","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRp58d0DBVh","next":{"success":"hangup","failure":"hangup"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = map.getKey;\r\nmap.result = JSON.stringify(data);\r\n}\r\n","inline":"true","type":"code-js","id":"PBX5bPs0mTIvl","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"failed"},{"key":"key","value":"{{{key1}}}"}],"type":"set-var-multi","id":"PBXvOpo2u181N","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}}]},{"id":140693,"name":"MarketPlaceOperations","trigger":"rest","expression":"/MarketPlace/{app_name}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140693,"name":"MarketPlaceOperations","trigger":"rest","expression":"/MarketPlace/{app_name}/{id}","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140693,"name":"MarketPlaceOperations","trigger":"rest","expression":"/MarketPlace/{app_name}/catch-up","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140693,"name":"MarketPlaceOperations","trigger":"rest","expression":"/MarketPlace/{app_name}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140693,"name":"MarketPlaceOperations","trigger":"rest","expression":"/MarketPlace/{app_name}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `market_place` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `market_place` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select id as template_id,name,app_name,type,category,description,created_date,js_code from `market_place` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `market_place` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140697,"name":"OnBoardingMeterOperations","trigger":"rest","expression":"/OnBoarding/{app_name}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140697,"name":"OnBoardingMeterOperations","trigger":"rest","expression":"/OnBoarding/{app_name}/{id}","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140697,"name":"OnBoardingMeterOperations","trigger":"rest","expression":"/OnBoarding/{app_name}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":140697,"name":"OnBoardingMeterOperations","trigger":"rest","expression":"/OnBoarding/{app_name}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"alert_DB","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `onboarding` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}'{{{this}}}'{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"alert_DB","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `onboarding` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}='${value}'</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}='${value}',</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"alert_DB","value":"select * from `onboarding` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"alert_DB","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `onboarding` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":141001,"name":"RedisOperations","trigger":"rest","expression":"/rcache/{app-name}/{type}/{key}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXiehf371a6Q"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRCWBVNoZc7","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXgUzJyNQ2hI","next":{"success":"PBXPTqzZpM0vI","failure":"hangup"}},{"name":"result","value":"{{{result}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNmqq0tUx4s","next":{"success":"PBXS0n16L8yBz","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXPCilZqwJtM","next":{"success":"hangup","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXEtyR4V4w8M","next":{"success":"PBXvKr1p134vk","failure":"PBX2QK7gGiu94"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","type":"jedis-del","id":"PBXgM2LlS916T","next":{"success":"PBX1mlzO5R5qc","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXiehf371a6Q","next":{"success":"PBXJqffxRn9hn","failure":"PBXoMkfk5VnFK"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXJqffxRn9hn","next":{"POST":"PBXgUzJyNQ2hI","PUT":"PBXXaT7wJWvwU","GET":"PBXdEyD6G8Pc1","DELETE":"PBXBpo174kMXk"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXoMkfk5VnFK","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXaT7wJWvwU","next":{"success":"PBXskSdW6mBc1","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\nmap.typeof12 = typeof(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.k){\r\nval = map.v+','+data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\nif(c>0){\r\ndata[map.k]=val;\r\n}\r\nelse{\r\ndata[map.k]=map.v;\r\n}\r\nmap.value =JSON.stringify(data);\r\n\r\n}","inline":"true","type":"code-js","id":"PBXuVWneHCkO3","next":{"success":"PBX9sSshzNmFK","failure":"PBXZUVHJLheTm"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXS0n16L8yBz","next":{"success":"hangup","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar key='';\r\nif(map.method_type=='GET'){\r\n\r\nif(map.request.path.jsonkey){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n}\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXRTfw0NFI3X","next":{"success":"PBXEtyR4V4w8M","failure":"hangup"}},{"name":"Failed","value":"key  : {{{key}}} jsonkey :: {{request.path.jsonkey}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2QK7gGiu94","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"{{request.path.jsonkey}}","value":"{{{getKey}}}"}],"type":"set-var-multi","id":"PBXvKr1p134vk","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"ss","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXI21zhrvQR9","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXilAF2wFHBm","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;","inline":"true","type":"code-js","id":"PBXBpo174kMXk","next":{"success":"PBXPJJyv21FRp","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBX9sSshzNmFK","next":{"success":"PBXV6OXtt2Afd","failure":"PBXV6OXtt2Afd"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBXV6OXtt2Afd","next":{"success":"PBXRCWBVNoZc7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXRVh867BsTw","next":{"success":"PBXuVWneHCkO3","failure":"PBXvOpo2u181N"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXskSdW6mBc1","next":{"success":"PBXRVh867BsTw","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXPTqzZpM0vI","next":{"success":"PBXs6ZsSydUG7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXs6ZsSydUG7","next":{"success":"PBXAMDkdJIOf3","failure":"PBXvOpo2u181N"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null'){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\ndata[map.k]=map.v;\r\nmap.value =JSON.stringify(data);\r\n\r\n} \r\n\r\n","inline":"true","type":"code-js","id":"PBXAMDkdJIOf3","next":{"success":"PBX9sSshzNmFK","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"key","value":"{{{key1}}} and key {{{key}}}"},{"key":"expire","value":"{{{expaire}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"typeof12","value":"{{{typeof12}}}"},{"key":"k n v","value":"{{{k}}} and {{{v}}}"}],"type":"set-var-multi","id":"PBXZUVHJLheTm","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXmv4CHAzXLk","next":{"success":"PBX8gkanbMvFk","failure":"PBXKv7n1osL9G"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXdEyD6G8Pc1","next":{"success":"PBX7THUnpA1qz","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBX7THUnpA1qz","next":{"success":"PBXmv4CHAzXLk","failure":"PBXvOpo2u181N"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\n\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.request.path.jsonkey){\r\nval = data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\n\r\nif(c>0){\r\nresult = [];\r\nvar k = '{{{key1}}}-{{{request.path.jsonkey}}}';\r\n\r\nif(val.indexOf(',')>0){\r\nvar split =val.split(',');\r\nfor(var j=0;j<split.length;j++){\r\nresult.push(split[j]);\r\n} \r\n}\r\nelse{\r\nresult.push(val);\r\n}\r\nvar finalOutput = [];\r\nvar data12 = { 'key' : k , 'value' : result}\r\nfinalOutput.push(data12);\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\nelse{\r\nvar finalOutput = [];\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\n\r\n\r\n}\r\n","inline":"true","type":"code-js","id":"PBX8gkanbMvFk","next":{"success":"PBXNmqq0tUx4s","failure":"PBXqLnmB2MVpl"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXqLnmB2MVpl","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXzMxCPkMMcZ","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nvar result = [];\r\n\r\nmap.key = key;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keys = Object.keys(data);\r\nmap.keysss = keys;\r\n\r\nvar array = [];\r\n\r\n\r\nfor(var i=0;i<keys.length;i++){\r\nvar k = keys[i];\r\n\r\nif(data[Object.keys(data)[i]].indexOf(',')>0){\r\nvar split =data[Object.keys(data)[i]].split(',');\r\nfor(var j=0;j<split.length;j++){\r\nvar ob = {};\r\nob[k] = split[j];\r\narray.push(ob);\r\n} \r\n}\r\nelse{\r\nvar value = data[Object.keys(data)[i]];\r\nvar obj = {}\r\nobj[k]=value;\r\narray.push(obj);\r\n}\r\n}\r\nvar finalOutput = [];\r\nvar key12 ={ 'key' : map.key1 , 'value' :  array };\r\nfinalOutput.push(key12);\r\n\r\nmap.result = JSON.stringify(finalOutput);\r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXKv7n1osL9G","next":{"success":"PBXzMxCPkMMcZ","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXd0gDuZ4gRB","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXPJJyv21FRp","next":{"success":"PBX6ckghOphRG","failure":"PBXvOpo2u181N"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX6ckghOphRG","next":{"success":"PBXg9yaRWNBRF","failure":"PBXgM2LlS916T"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult={'result' : 'No such key found' };\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\nvar val = {};\r\nfor(var i=0;i<keyss.length;i++){\r\n\r\nif(keyss[i] == map.request.path.jsonkey){\r\n\r\n} \r\nelse{\r\nvar k = keyss[i];\r\nval[k] = data[Object.keys(data)[i]];\r\n}\r\n}\r\nmap.value =  JSON.stringify(val);\r\nresult={'result' : 'success' };\r\nmap.result = JSON.stringify(result);\r\n}\r\n","inline":"true","type":"code-js","id":"PBXg9yaRWNBRF","next":{"success":"PBXfKBvr7xm9K","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"ss","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBX1mlzO5R5qc","next":{"success":"PBXI21zhrvQR9","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBXfKBvr7xm9K","next":{"success":"PBX6E1boeqC5O","failure":"PBXRp58d0DBVh"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX6E1boeqC5O","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRp58d0DBVh","next":{"success":"hangup","failure":"hangup"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = map.getKey;\r\nmap.result = JSON.stringify(data);\r\n}\r\n","inline":"true","type":"code-js","id":"PBX5bPs0mTIvl","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"failed"},{"key":"key","value":"{{{key1}}}"}],"type":"set-var-multi","id":"PBXvOpo2u181N","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}}]},{"id":141001,"name":"RedisOperations","trigger":"rest","expression":"/rcache/{app-name}/{type}/{key}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXiehf371a6Q"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRCWBVNoZc7","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXgUzJyNQ2hI","next":{"success":"PBXPTqzZpM0vI","failure":"hangup"}},{"name":"result","value":"{{{result}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNmqq0tUx4s","next":{"success":"PBXS0n16L8yBz","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXPCilZqwJtM","next":{"success":"hangup","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXEtyR4V4w8M","next":{"success":"PBXvKr1p134vk","failure":"PBX2QK7gGiu94"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","type":"jedis-del","id":"PBXgM2LlS916T","next":{"success":"PBX1mlzO5R5qc","failure":"hangup"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXiehf371a6Q","next":{"success":"PBXJqffxRn9hn","failure":"PBXoMkfk5VnFK"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXJqffxRn9hn","next":{"POST":"PBXgUzJyNQ2hI","PUT":"PBXXaT7wJWvwU","GET":"PBXdEyD6G8Pc1","DELETE":"PBXBpo174kMXk"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXoMkfk5VnFK","next":{"success":"hangup","failure":"hangup"}},{"name":"jsondata","value":"{{{jsonstr request.body}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXXaT7wJWvwU","next":{"success":"PBXskSdW6mBc1","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\nmap.typeof12 = typeof(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.k){\r\nval = map.v+','+data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\nif(c>0){\r\ndata[map.k]=val;\r\n}\r\nelse{\r\ndata[map.k]=map.v;\r\n}\r\nmap.value =JSON.stringify(data);\r\n\r\n}","inline":"true","type":"code-js","id":"PBXuVWneHCkO3","next":{"success":"PBX9sSshzNmFK","failure":"PBXZUVHJLheTm"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXS0n16L8yBz","next":{"success":"hangup","failure":"hangup"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar key='';\r\nif(map.method_type=='GET'){\r\n\r\nif(map.request.path.jsonkey){\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-{{request.path.jsonkey}}';\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n}\r\n}\r\nelse{\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}-'+keys;\r\n}\r\nmap.key = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXRTfw0NFI3X","next":{"success":"PBXEtyR4V4w8M","failure":"hangup"}},{"name":"Failed","value":"key  : {{{key}}} jsonkey :: {{request.path.jsonkey}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX2QK7gGiu94","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"{{request.path.jsonkey}}","value":"{{{getKey}}}"}],"type":"set-var-multi","id":"PBXvKr1p134vk","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"ss","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXI21zhrvQR9","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXilAF2wFHBm","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;","inline":"true","type":"code-js","id":"PBXBpo174kMXk","next":{"success":"PBXPJJyv21FRp","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBX9sSshzNmFK","next":{"success":"PBXV6OXtt2Afd","failure":"PBXV6OXtt2Afd"}},{"json_is":"true","json_name":"output","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBXV6OXtt2Afd","next":{"success":"PBXRCWBVNoZc7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXRVh867BsTw","next":{"success":"PBXuVWneHCkO3","failure":"PBXvOpo2u181N"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXskSdW6mBc1","next":{"success":"PBXRVh867BsTw","failure":"hangup"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXPTqzZpM0vI","next":{"success":"PBXs6ZsSydUG7","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXs6ZsSydUG7","next":{"success":"PBXAMDkdJIOf3","failure":"PBXvOpo2u181N"}},{"src":"var expaire = parseInt(\"{{request.path.time-to-expire-in-secs}}\");\r\nmap.expaire = expaire;\r\n\r\nvar json = JSON.parse(map.jsondata);\r\nmap.jj =JSON.stringify(json);\r\nvar keys = Object.keys(json);\r\n\r\nvar values = json[keys];\r\nmap.values=values;\r\nvar key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nmap.key = key;\r\n\r\nif(map.getKey == null || map.getKey == 'null'){\r\nvar value = json;\r\nmap.value=JSON.stringify(value);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nmap.k = Object.keys(json)[0];\r\nmap.v =json[Object.keys(json)[0]];\r\ndata[map.k]=map.v;\r\nmap.value =JSON.stringify(data);\r\n\r\n} \r\n\r\n","inline":"true","type":"code-js","id":"PBXAMDkdJIOf3","next":{"success":"PBX9sSshzNmFK","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"key","value":"{{{key1}}} and key {{{key}}}"},{"key":"expire","value":"{{{expaire}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"typeof12","value":"{{{typeof12}}}"},{"key":"k n v","value":"{{{k}}} and {{{v}}}"}],"type":"set-var-multi","id":"PBXZUVHJLheTm","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBXmv4CHAzXLk","next":{"success":"PBX8gkanbMvFk","failure":"PBXKv7n1osL9G"}},{"src":"var key='';\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\nmap.key1 = key;\r\n\r\n","inline":"true","type":"code-js","id":"PBXdEyD6G8Pc1","next":{"success":"PBX7THUnpA1qz","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBX7THUnpA1qz","next":{"success":"PBXmv4CHAzXLk","failure":"PBXvOpo2u181N"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\n\r\nvar c = 0;\r\nvar val = '';\r\nfor(var i=0;i<keyss.length;i++){\r\nif(keyss[i] == map.request.path.jsonkey){\r\nval = data[Object.keys(data)[i]];\r\nc = c+1;\r\n} \r\n}\r\n\r\nif(c>0){\r\nresult = [];\r\nvar k = '{{{key1}}}-{{{request.path.jsonkey}}}';\r\n\r\nif(val.indexOf(',')>0){\r\nvar split =val.split(',');\r\nfor(var j=0;j<split.length;j++){\r\nresult.push(split[j]);\r\n} \r\n}\r\nelse{\r\nresult.push(val);\r\n}\r\nvar finalOutput = [];\r\nvar data12 = { 'key' : k , 'value' : result}\r\nfinalOutput.push(data12);\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\nelse{\r\nvar finalOutput = [];\r\nmap.result = JSON.stringify(finalOutput);\r\n}\r\n\r\n\r\n}\r\n","inline":"true","type":"code-js","id":"PBX8gkanbMvFk","next":{"success":"PBXNmqq0tUx4s","failure":"PBXqLnmB2MVpl"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXqLnmB2MVpl","next":{"success":"PBXPCilZqwJtM","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXzMxCPkMMcZ","next":{"success":"hangup","failure":"hangup"}},{"src":"var key='';\r\n\r\nkey = '{{request.path.app-name}}-{{request.path.type}}-{{request.path.key}}';\r\n\r\nvar result = [];\r\n\r\nmap.key = key;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\n\r\nvar data = JSON.parse(map.getKey);\r\nvar keys = Object.keys(data);\r\nmap.keysss = keys;\r\n\r\nvar array = [];\r\n\r\n\r\nfor(var i=0;i<keys.length;i++){\r\nvar k = keys[i];\r\n\r\nif(data[Object.keys(data)[i]].indexOf(',')>0){\r\nvar split =data[Object.keys(data)[i]].split(',');\r\nfor(var j=0;j<split.length;j++){\r\nvar ob = {};\r\nob[k] = split[j];\r\narray.push(ob);\r\n} \r\n}\r\nelse{\r\nvar value = data[Object.keys(data)[i]];\r\nvar obj = {}\r\nobj[k]=value;\r\narray.push(obj);\r\n}\r\n}\r\nvar finalOutput = [];\r\nvar key12 ={ 'key' : map.key1 , 'value' :  array };\r\nfinalOutput.push(key12);\r\n\r\nmap.result = JSON.stringify(finalOutput);\r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n","inline":"true","type":"code-js","id":"PBXKv7n1osL9G","next":{"success":"PBXzMxCPkMMcZ","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"Failed","value":"Failed"},{"key":"jj","value":"jjj :: {{{jj}}}  value : {{{value}}} values : {{values}} getKey :: {{{getKey}}}"},{"key":"keysss","value":"{{{keysss}}}"},{"key":"jsonkey","value":"{{{request.path.jsonkey}}}"}],"type":"set-var-multi","id":"PBXd0gDuZ4gRB","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","plugin_name":"RedisCache","output_variable":"getKey","type":"jedis-get","id":"PBXPJJyv21FRp","next":{"success":"PBX6ckghOphRG","failure":"PBXvOpo2u181N"}},{"output_variable":"jsonKeyCheck","if_type":"strlen","variable1":"{{{request.path.jsonkey}}}","comparator":"greater_than","variable2":"0","value_type":"hb","type":"if-condition","id":"PBX6ckghOphRG","next":{"success":"PBXg9yaRWNBRF","failure":"PBXgM2LlS916T"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult={'result' : 'No such key found' };\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = JSON.parse(map.getKey);\r\nvar keyss = Object.keys(data);\r\nmap.keysss = keyss;\r\n\r\nvar val = {};\r\nfor(var i=0;i<keyss.length;i++){\r\n\r\nif(keyss[i] == map.request.path.jsonkey){\r\n\r\n} \r\nelse{\r\nvar k = keyss[i];\r\nval[k] = data[Object.keys(data)[i]];\r\n}\r\n}\r\nmap.value =  JSON.stringify(val);\r\nresult={'result' : 'success' };\r\nmap.result = JSON.stringify(result);\r\n}\r\n","inline":"true","type":"code-js","id":"PBXg9yaRWNBRF","next":{"success":"PBXfKBvr7xm9K","failure":"PBXd0gDuZ4gRB"}},{"json_is":"true","json_name":"ss","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"success"}],"type":"set-var-multi","id":"PBX1mlzO5R5qc","next":{"success":"PBXI21zhrvQR9","failure":"hangup"}},{"value_type":"hb","data_type":"String","key":"{{{key1}}}","value_to_save":"{{{value}}}","expire_time":"{{{expaire}}}","plugin_name":"RedisCache","type":"jedis-put","id":"PBXfKBvr7xm9K","next":{"success":"PBX6E1boeqC5O","failure":"PBXRp58d0DBVh"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX6E1boeqC5O","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"result","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXRp58d0DBVh","next":{"success":"hangup","failure":"hangup"}},{"src":"var result;\r\nif(map.getKey == null || map.getKey == 'null' || map.getKey == ''){\r\nresult=[];\r\nmap.result = JSON.stringify(result);\r\n}\r\nelse{\r\nvar data = map.getKey;\r\nmap.result = JSON.stringify(data);\r\n}\r\n","inline":"true","type":"code-js","id":"PBX5bPs0mTIvl","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"Failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"failed"},{"key":"key","value":"{{{key1}}}"}],"type":"set-var-multi","id":"PBXvOpo2u181N","next":{"success":"PBXilAF2wFHBm","failure":"hangup"}}]},{"id":141474,"name":"ReportsOperations","trigger":"rest","expression":"/reports/{app_name}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"reports_DB","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"reports_DB","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"reports_DB","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"reports_DB","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":141474,"name":"ReportsOperations","trigger":"rest","expression":"/reports/{app_name}/{id}","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"reports_DB","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"reports_DB","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"reports_DB","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"reports_DB","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":141474,"name":"ReportsOperations","trigger":"rest","expression":"/reports/{app_name}","method":"DELETE","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"reports_DB","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"reports_DB","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"reports_DB","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"reports_DB","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":141474,"name":"ReportsOperations","trigger":"rest","expression":"/reports/{app_name}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXtUrxG8Mbm7"}},{"value_type":"hb","variable":"{{{method_type}}}","cases":[{"key":"POST"},{"key":"PUT"},{"key":"GET"},{"key":"DELETE"}],"type":"switch-case","id":"PBXwcvVdG0eOl","next":{"POST":"PBXhZH6gDX2Cb","PUT":"PBXk5ADM89GsT","GET":"PBXCRmLXiMz1g","DELETE":"PBXfQ5fVly2II"}},{"name":"method_type","value":"{{request.method}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXtUrxG8Mbm7","next":{"success":"PBXwcvVdG0eOl","failure":"PBXJGPEnXWTPh"}},{"variable_name":"method_type","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXJGPEnXWTPh","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"reports_DB","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","output_variable":"output","type":"sql-insert","id":"PBXhLKzo6ghVK","next":{"success":"PBXT3cvJBrwor","failure":"PBXxsUe7K6xSO"}},{"variable_name":"yes","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXMgxO08zAeq","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXhZH6gDX2Cb","next":{"success":"PBXsTZ36mSO3F","failure":"PBXhLKzo6ghVK"}},{"name":"yes","value":"INSERT INTO `report` (app_name,{{#each request.body}}{{@key}}{{#if @last}}{{else}},{{/if}}{{/each}}) VALUES('{{request.path.app_name}}',{{#each request.body}}\"{{{this}}}\"{{#if @last}}{{else}},{{/if}}{{/each}})","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsTZ36mSO3F","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to insert"}],"type":"set-var-multi","id":"PBXxsUe7K6xSO","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"variable_name":"failed","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXu8kBhPTmBS","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"output","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXT3cvJBrwor","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXk5ADM89GsT","next":{"success":"PBX8dcyTIvTl6","failure":"PBXpbct3rQ2T4"}},{"plugin_name":"reports_DB","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list>\r\nwhere id = ${request.path.id}","value_type":"ftl","output_variable":"output","type":"sql-update","id":"PBXpbct3rQ2T4","next":{"success":"PBXT3cvJBrwor","failure":"PBXZbkg9xhzQL"}},{"name":"yes","value":"UPDATE `report` SET <#list request.body as key,value><#if key?index==request.body?size-1><#if value=='NULL'>${key}=${value}<#else>${key}=\"${value}\"</#if><#else><#if value=='NULL'>${key}=${value},<#else>${key}=\"${value}\",</#if></#if></#list> where id = ${request.path.id}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX8dcyTIvTl6","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to update"}],"type":"set-var-multi","id":"PBXZbkg9xhzQL","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXCRmLXiMz1g","next":{"success":"PBXFk3NPq3NLI","failure":"PBXcu8577mZ4C"}},{"name":"yes","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFk3NPq3NLI","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"plugin_name":"reports_DB","value":"select id as report_id,report_name,app_name,description,created_date,query from `report` where app_name='${request.path.app_name}' order by created_date desc ","value_type":"ftl","output_variable":"output","type":"sql","id":"PBXcu8577mZ4C","next":{"success":"PBXT3cvJBrwor","failure":"PBXxbq6Jmuoln"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to get"}],"type":"set-var-multi","id":"PBXxbq6Jmuoln","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}},{"output_variable":"preview","if_type":"value","variable1":"{{request.params.preview}}","comparator":"equal_to","variable2":"true","value_type":"hb","type":"if-condition","id":"PBXfQ5fVly2II","next":{"success":"PBXMdmOUvBWqb","failure":"PBX9riMsTH2k6"}},{"plugin_name":"reports_DB","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","output_variable":"output","type":"sql-delete","id":"PBX9riMsTH2k6","next":{"success":"PBXT3cvJBrwor","failure":"PBXrzP4ZIPtTx"}},{"name":"yes","value":"DELETE FROM `report` WHERE <#if request.params.id??> id = ${request.params.id} and app_name = '${request.path.app_name}' <#elseif request.params.date??> created_date <= '${request.params.date}' and app_name = '${request.path.app_name}' <#else> app_name = '${request.path.app_name}' </#if> ","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXMdmOUvBWqb","next":{"success":"PBXMgxO08zAeq","failure":"hangup"}},{"json_is":"true","json_name":"failed","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"failed to delete"}],"type":"set-var-multi","id":"PBXrzP4ZIPtTx","next":{"success":"PBXu8kBhPTmBS","failure":"hangup"}}]},{"id":141605,"name":"REGISTER_TENANT","trigger":"rest","expression":"/automation/{app-name}/{flow-name}/{flow-id}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXdJIvP4AP7s"}},{"json_is":"true","json_name":"msg_payload","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"meta_id","value":"{{{ID}}}"},{"key":"flow_id","value":"{{{request.path.flow-id}}}"},{"key":"token","value":"{{{request.headers.token}}}"}],"type":"set-var-multi","id":"PBXaiDOuA8z6l","next":{"success":"PBXxMK4SF3DVo","failure":"hangup"}},{"variable_name":"activeMq","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXxgOJZg0Jau","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"{{{app.automationQueue}}}","delivery_mode":"2","scheduled_delay":"{{{SCHEDULE_DELAY}}}","scheduled_period":"{{{SCHEDULE_PERIOD}}}","scheduled_repeat":"{{{SCHEDULE_REPEAT}}}","scheduled_cron":"{{{SCHEDULE_CORN}}}","messages":[{"key":"{{{json msg_payload}}}","value":"9"}],"type":"active-mq-producer","id":"PBXxMK4SF3DVo","next":{"success":"PBXdXuUl6eHrR","failure":"PBXlkvt4v7c9a"}},{"variable_name":"msg_payload","http_response_code":"400","response_content_type":"","value_type":"hb","type":"send","id":"PBXohCQAC2QQc","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"activeMqFail","http_response_code":"400","response_content_type":"","value_type":"hb","type":"send","id":"PBXLrrC6H5dTf","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"corp_sql","value":"select ID from FLOW_META where FLOW_NAME='{{{request.path.flow-name}}}' and APP_NAME='{{{request.path.app-name}}}'","value_type":"hb","output_variable":"db_result","type":"sql-one","id":"PBXciAuHBM3yG","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"corp_sql","value":"UPDATE FLOWS SET STATUS = 'Scheduled' WHERE ID='{{{request.path.flow-id}}}';","value_type":"hb","output_variable":"db_status_update","type":"sql-update","id":"PBXKlT31lT6lA","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"activeMq","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"Task pushed successfully"}],"type":"set-var-multi","id":"PBXySoTrbHiZn","next":{"success":"PBXxgOJZg0Jau","failure":"hangup"}},{"json_is":"true","json_name":"activeMqFail","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"activemq push failed"}],"type":"set-var-multi","id":"PBXlkvt4v7c9a","next":{"success":"PBXLrrC6H5dTf","failure":"hangup"}},{"plugin_name":"corp_sql","value":"select SCHEDULE_DELAY, SCHEDULE_PERIOD, SCHEDULE_REPEAT, SCHEDULE_CORN from FLOWS where ID='{{{request.path.flow-id}}}';","value_type":"hb","output_variable":"flow_schedule","type":"sql-one","id":"PBXeaWaLvT4KT","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"msg_payload","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"sql failed "},{"key":"flow_schedule","value":"{{{flow_schedule}}}"},{"key":"data2","value":"{{{data2}}}"},{"key":"data1","value":"{{{data1}}}"}],"type":"set-var-multi","id":"PBXtO1TCVaLvZ","next":{"success":"PBXohCQAC2QQc","failure":"hangup"}},{"url":"https://ga.500apps.com/dbappv2/FLOW_META?where = FLOW_NAME='{{{request.path.flow-name}}}' and APP_NAME='{{{request.path.app-name}}}'","method":"GET","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"db_result","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{{request.headers.token}}}"}],"body_parameters":[],"type":"rest","id":"PBXdJIvP4AP7s","next":{"success":"PBXo40TXJkx6t","failure":"PBXtO1TCVaLvZ"}},{"url":"https://ga.500apps.com/dbappv2/FLOWS?fields=SCHEDULE_DELAY, SCHEDULE_PERIOD, SCHEDULE_REPEAT, SCHEDULE_CORN&where =ID= '{{{request.path.flow-id}}}'","method":"GET","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"flow_schedule","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{{request.headers.token}}}"}],"body_parameters":[],"type":"rest","id":"PBXo40TXJkx6t","next":{"success":"PBXexPvzTV820","failure":"PBXtO1TCVaLvZ"}},{"url":"https://ga.500apps.com/dbappv2/FLOWS","method":"PUT","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"db_status_update","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{{request.headers.token}}}"}],"body_parameters":[{"key":"STATUS","value":"Scheduled"},{"key":"id","value":"{{{request.path.flow-id}}}"}],"type":"rest","id":"PBXdXuUl6eHrR","next":{"success":"PBXySoTrbHiZn","failure":"PBXtO1TCVaLvZ"}},{"url":"https://chatt.free.beeceptor.com","method":"POST","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"flow_schedule","value_type":"hb","query_parameters":[],"headers":[],"body_parameters":[{"key":"dfdsf","value":"{{{ID}}}"},{"key":"fsdf","value":"{{{data1}}}"},{"key":"data ","value":"{{{SCHEDULE_DELAY}}}  {{{SCHEDULE_PERIOD}}} {{{SCHEDULE_REPEAT}}} {{{SCHEDULE_CORN}}}"}],"type":"rest","id":"PBXWZQe7TBVFn","next":{"success":"PBXaiDOuA8z6l","failure":"hangup"}},{"src":"var db_result = JSON.parse(map.db_result);\r\nmap.ID = db_result[0].ID;\r\nvar flow_schedule = JSON.parse(map.flow_schedule);\r\nmap.SCHEDULE_DELAY=flow_schedule[0].SCHEDULE_DELAY;\r\nmap.SCHEDULE_PERIOD=flow_schedule[0].SCHEDULE_PERIOD;\r\nmap.SCHEDULE_REPEAT=flow_schedule[0].SCHEDULE_REPEAT;\r\nmap.SCHEDULE_CORN=flow_schedule[0].SCHEDULE_CORN;","inline":"true","type":"code-js","id":"PBXexPvzTV820","next":{"success":"PBXWZQe7TBVFn","failure":"hangup"}}]},{"id":141607,"name":"EXECUTION_STATUS","trigger":"rest","expression":"/automation/status/{flow-id}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXh2cwOzfAR8"}},{"plugin_name":"corp_sql","value":"SELECT FLOW_NAME,STATUS  from FLOWS where ID = '{{{request.path.flow-id}}}'","value_type":"hb","output_variable":"Tasks_data","type":"sql","id":"PBX0tTvwIT8Qm","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Tasks_data","http_response_code":"200","response_content_type":"","value_type":"hb","type":"send","id":"PBXrDWN7ZMe49","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"Tasks_data","http_response_code":"400","response_content_type":"","value_type":"hb","type":"send","id":"PBXiotr3BERph","next":{"success":"hangup","failure":"hangup"}},{"url":"https://ga.500apps.com/dbappv2/FLOWS?where = ID='{{{request.path.flow-id}}}'&fields=FLOW_NAME,STATUS","method":"GET","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"Tasks_data","value_type":"hb","query_parameters":[],"headers":[],"body_parameters":[],"type":"rest","id":"PBXh2cwOzfAR8","next":{"success":"PBXrDWN7ZMe49","failure":"PBXiotr3BERph"}}]},{"id":141606,"name":"EXECUTOR","trigger":"event","expression":null,"execute_continues":"true","broker_url":"ssl://b-840b987b-e5b3-47fd-b9ed-4cc1ed4013d9-1.mq.us-east-1.amazonaws.com:61617","username":"appup","password":"appupactivemq","queue_name":"Automation-queue","message_variable":"output","event_type":"activemq","steps":[{"type":"start","id":1,"next":{"start":"PBXSSE6niwVul"}},{"convert_from":"json","convert_to":"json_object","output_variable":"convetedObj","root_name":"","value_type":"hb","data":"{{{output}}}","type":"utils-convert","id":"PBXSSE6niwVul","next":{"success":"PBXLmcQef9zL2","failure":"hangup"}},{"variable_name":"updated_status","http_response_code":"200","response_content_type":"","value_type":"hb","type":"send","id":"PBXEN5hTddJQb","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"corp_sql","value":"select TASK_JSON,TOKEN  from FLOWS where ID = '{{{flow_id}}}';","value_type":"hb","output_variable":"flow_data","type":"sql-one","id":"PBXxg5QsMfA7J","next":{"success":"hangup","failure":"hangup"}},{"name":"taskflowschedule","value":"Taskflow Scheduled ","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXLAcPSTuOla","next":{"success":"PBXhuHUdOWX47","failure":"hangup"}},{"variable_name":"taskflowfail","http_response_code":"400","response_content_type":"","value_type":"hb","type":"send","id":"PBXGkrDZvZiTn","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"taskflowschedule","http_response_code":"400","response_content_type":"","value_type":"hb","type":"send","id":"PBXhuHUdOWX47","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"corp_sql","value":"UPDATE FLOWS SET STATUS='EXECUTED' where ID='{{{flow_id}}}';","value_type":"hb","output_variable":"updated_status","type":"sql-update","id":"PBXJFMcbpR42H","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"taskflowinput","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"task","value":"{{{flows.TASK_JSON}}}"},{"key":"taskmeta","value":"{{{meta.FLOW_META}}}"},{"key":"taskheaders","value":"{{{main_headers}}}"}],"type":"set-var-multi","id":"PBXQPcmkS6IKC","next":{"success":"PBXbZ8Of9CbaB","failure":"hangup"}},{"tasks":"task","task_metadata":"taskmeta","context_headers":"taskheaders","db_plugin":"corp_sql","value_type":"hb","output_variable":"taskflowop","type":"task-flow-custom","id":"PBXbZ8Of9CbaB","next":{"success":"PBXQ42ubZ0C4O","failure":"PBXekfUVbSsaO","task_scheduled":"PBXLAcPSTuOla"}},{"src":"var meta_data= JSON.parse(map.meta_data);\r\nvar flow_data= JSON.parse(map.flow_data); \r\n\r\nvar headers = meta_data[0].FLOW_HEADER;\r\nvar main_headers =JSON.parse(headers);\r\nvar obj={};\r\nobj[\"key\"]=\"token\";\r\nobj[\"value\"]='{{{convetedObj.token}}}';\r\nmain_headers.push(obj);\r\nmap.main_headers=JSON.stringify(main_headers);\r\nmap.flows=flow_data[0];\r\nmap.meta=meta_data[0];","inline":"true","type":"code-js","id":"PBXJSReiwdkKf","next":{"success":"PBXRS8ShZ6Tkv","failure":"hangup"}},{"name":"flow_id","value":"{{{convetedObj.flow_id}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXbJQzUeePAv","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"corp_sql","value":"select FLOW_HEADER, FLOW_META  from FLOW_META where ID = '{{{meta_id}}}';","value_type":"hb","output_variable":"meta_data","type":"sql-one","id":"PBXU3saqNeT9X","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"taskflowfail","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"Task flow failed"}],"type":"set-var-multi","id":"PBXekfUVbSsaO","next":{"success":"PBXGkrDZvZiTn","failure":"hangup"}},{"url":"https://ga.500apps.com/dbappv2/FLOW_META?fields=FLOW_HEADER, FLOW_META&where =ID= '{{{convetedObj.meta_id}}}'","method":"GET","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"meta_data","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{{convetedObj.token}}}"}],"body_parameters":[],"type":"rest","id":"PBXi4hbRRttPB","next":{"success":"PBXJSReiwdkKf","failure":"hangup"}},{"url":"https://ga.500apps.com/dbappv2/FLOWS","method":"PUT","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"updated_status","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{{convetedObj.token}}}"}],"body_parameters":[{"key":"STATUS","value":"Executed"},{"key":"id","value":"{{{convetedObj.flow_id}}}"}],"type":"rest","id":"PBXzVaFWDvkeD","next":{"success":"PBXEN5hTddJQb","failure":"hangup"}},{"url":"https://ga.500apps.com/dbappv2/FLOWS?fields=TASK_JSON&where =ID= '{{{convetedObj.flow_id}}}'","method":"GET","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"flow_data","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{{convetedObj.token}}}"}],"body_parameters":[],"type":"rest","id":"PBXLmcQef9zL2","next":{"success":"PBXi4hbRRttPB","failure":"hangup"}},{"char_enc":"UTF-8","value_type":"hb","config_set":"","plugin_name":"ses-plugin","from_name":"lakshmi","from_email":"noreply@500apps.com","to_email":"lakshmi.thirupathamma@500apps.com","cc_email":"","bcc_email":"","reply_to":"","subject":"fdsjfl","body_type":"text_body","body":"{{{flows}}}\r\n-==================\r\n{{{meta}}}\r\n\r\n{{{main_headers}}}","type":"send-email","id":"PBXRS8ShZ6Tkv","next":{"success":"PBXQPcmkS6IKC","failure":"hangup"}},{"url":"https://chatt.free.beeceptor.com","method":"POST","raw":"","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"updated_status","value_type":"hb","query_parameters":[],"headers":[],"body_parameters":[{"key":"STATUS","value":"Executed"},{"key":"id","value":"{{{convetedObj.flow_id}}}"},{"key":"dfd","value":"{{{convetedObj.token}}}"}],"type":"rest","id":"PBXQ42ubZ0C4O","next":{"success":"PBXzVaFWDvkeD","failure":"hangup"}}]},{"id":141700,"name":"CONVERT_CSV_TO_JSONARRAY","trigger":"rest","expression":"/bulk-csv/{priority}/{wait}/{queue-name}/{rate-limit}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXbqcJ9U4xvl"}},{"class_name":"readURLToJson","package_name":"com.appup.apps.g","type":"code-java","id":"PBXHaiGUDFGBr","next":{"success":"PBXqxonRWIrbx","failure":"hangup"}},{"name":"url","value":"{{{request.body.url}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXbqcJ9U4xvl","next":{"success":"PBXHaiGUDFGBr","failure":"hangup"}},{"variable_name":"jsonResp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXbHxTEbFHPG","next":{"success":"hangup","failure":"hangup"}},{"src":"var resp = map.arrayofjson;\r\n\r\nvar jsonResp = {};\r\n\r\njsonResp['tasks'] = JSON.parse(resp);\r\n\r\nmap.jsonResp = JSON.stringify(jsonResp);","inline":"true","type":"code-js","id":"PBXqxonRWIrbx","next":{"success":"PBXHSevlTguni","failure":"hangup"}},{"url":"https://ga.500apps.com/g/bulk/{{{request.path.priority}}}/{{{request.path.wait}}}/{{{request.path.queue-name}}}/{{{request.path.rate-limit}}}","method":"POST","raw":"{{{jsonResp}}}","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"jsonResult","value_type":"hb","query_parameters":[],"headers":[{"key":"Content-Type","value":"application/json"}],"body_parameters":[],"type":"rest","id":"PBXta3Ie38NJi","next":{"success":"hangup","failure":"hangup"}},{"url":"https://ga.500apps.com/g/bulk/{{{request.path.priority}}}/{{{request.path.wait}}}/{{{request.path.queue-name}}}/{{{request.path.rate-limit}}}","method":"post","query_parameters":"{}","headers":"{}","body_parameters":"{{{jsonResp}}}","output_variable":"jsonResult","value_type":"hb","plugin_name":"rest-async","type":"rest-dynamic","id":"PBXHSevlTguni","next":{"continue":"PBXbHxTEbFHPG"}}]},{"id":141701,"name":"BulkUINonDB","trigger":"rest","expression":"/bulk/BulkUINonDB","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXS3tQTSo2l8"}},{"src":"print(\"TYPEOF\",typeof map.request.body.jsonArray);\r\nmap.request.body.jsonArray=JSON.parse(map.request.body.jsonArray);\r\nprint(\"JSON PARSE\",map.request.body.jsonArray);\r\nvar tasks = {\"tasks\":[]};\r\nfor(var i=0;i<map.request.body.jsonArray.length;i++)\r\n{\r\nvar task={};\r\ntask.contact_id = map.request.body.jsonArray[i];\r\ntask.queue_name=map.request.body.queue_name;\r\ntask.url=map.request.body.url;\r\ntask.callbackurl=map.request.body.callbackurl;\r\ntask.fields=map.request.body.fields;\r\ntask.subject=map.request.body.subject;\r\ntask.message_body=map.request.body.message_body;\r\nif(map.request.body.attachment)\r\ntask.attachment=map.request.body.attachment;\r\nif(map.request.headers.token)\r\ntask.token=map.request.headers.token;\r\nelse\r\ntask.token=map.request.cookies.token.value;\r\nmap.task=JSON.stringify(task);\r\nprint(\"OBJECT\",map.task);\r\ntasks.tasks.push(task);\r\n}\r\nmap.tasks=JSON.stringify(tasks);","inline":"true","type":"code-js","id":"PBXS3tQTSo2l8","next":{"success":"PBXWCz7bTK5ce","failure":"PBXVvkJOVTiJs"}},{"url":"https://crm.500apps.com/bulkapp/{{{request.body.priority}}}/{{{request.body.wait}}}/{{{request.body.queue_name}}}/{{{request.body.rate_limit}}}","method":"POST","raw":"{{{tasks}}}","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"output","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{#if request.headers.token}} {{{request.headers.token}}}{{else}}{{{request.cookies.token.value}}}{{/if}}"},{"key":"Content-Type","value":"application/json"}],"body_parameters":[],"type":"rest","id":"PBXWCz7bTK5ce","next":{"success":"PBXgzNhbZmESQ","failure":"PBXDIaG93QvU8"}},{"variable_name":"output","http_response_code":"200","response_content_type":"","value_type":"hb","type":"send","id":"PBXgzNhbZmESQ","next":{"success":"hangup","failure":"hangup"}},{"name":"Fail","value":"Fail to parse ids","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXVvkJOVTiJs","next":{"success":"PBX2QmhbB4z9R","failure":"hangup"}},{"name":"Fail","value":"Fail to pass data to bulk app","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXDIaG93QvU8","next":{"success":"PBX2QmhbB4z9R","failure":"hangup"}},{"variable_name":"Fail","http_response_code":"400","response_content_type":"","value_type":"hb","type":"send","id":"PBX2QmhbB4z9R","next":{"success":"hangup","failure":"hangup"}}]},{"id":141702,"name":"BulkUINonDBFilter","trigger":"rest","expression":"/bulk/BulkUINonDBFilter","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXvZTn28D9iH"}},{"url":"https://crm.500apps.com/v2/s/filters","method":"POST","raw":"{{{json request.body.data}}}","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"result","value_type":"hb","query_parameters":[],"headers":[{"key":"Content-Type","value":"application/json"},{"key":"token","value":"{{#if request.headers.token}} {{{request.headers.token}}}{{else}}{{{request.cookies.token.value}}}{{/if}}"}],"body_parameters":[],"type":"rest","id":"PBXvZTn28D9iH","next":{"success":"PBX2LhORcn9sg","failure":"PBX1uTn2Lr9Sq"}},{"src":"print(\"MAP\",map.result);\r\nmap.jsonArray=[];\r\nmap.result=JSON.parse(map.result);\r\nfor(var i=0;i<map.result.length;i++)\r\nmap.jsonArray.push(map.result[i].id);\r\nvar tasks = {\"tasks\":[]};\r\nfor(var i=0;i<map.jsonArray.length;i++)\r\n{\r\nvar task={};\r\ntask.contact_id = map.jsonArray[i];\r\ntask.queue_name=map.request.body.queue_name;\r\ntask.url=map.request.body.url;\r\ntask.callbackurl=map.request.body.callbackurl;\r\ntask.fields=map.request.body.fields;\r\ntask.subject=map.request.body.subject;\r\ntask.message_body=map.request.body.message_body;\r\nif(map.request.body.attachment)\r\ntask.attachment=map.request.body.attachment;\r\nif(map.request.headers.token)\r\ntask.token=map.request.headers.token;\r\nelse\r\ntask.token=map.request.cookies.token.value;\r\nmap.task=JSON.stringify(task);\r\nprint(\"OBJECT\",map.task);\r\ntasks.tasks.push(task);\r\n}\r\nmap.tasks=JSON.stringify(tasks);","inline":"true","type":"code-js","id":"PBX2LhORcn9sg","next":{"success":"PBXC9OxqViTUc","failure":"PBXsb9435SQT2"}},{"url":"https://crm.500apps.com/bulkapp/{{{request.body.priority}}}/{{{request.body.wait}}}/{{{request.body.queue_name}}}/{{{request.body.rate_limit}}}","method":"POST","raw":"{{{tasks}}}","auth_type":"default","username":"","password":"","consumer_key":"","consumer_secret":"","token":"","secret":"","output_variable":"output","value_type":"hb","query_parameters":[],"headers":[{"key":"token","value":"{{#if request.headers.token}} {{{request.headers.token}}}{{else}}{{{request.cookies.token.value}}}{{/if}}"},{"key":"Content-Type","value":"application/json"}],"body_parameters":[],"type":"rest","id":"PBXC9OxqViTUc","next":{"success":"PBXOvAgf0Fnk7","failure":"PBXNMUy5ysluo"}},{"variable_name":"output","http_response_code":"200","response_content_type":"","value_type":"hb","type":"send","id":"PBXOvAgf0Fnk7","next":{"success":"hangup","failure":"hangup"}},{"name":"Fail","value":"Fail to get data","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX1uTn2Lr9Sq","next":{"success":"PBXVkiMHNmiSE","failure":"hangup"}},{"name":"Fail","value":"Fail to parse data","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXsb9435SQT2","next":{"success":"PBXVkiMHNmiSE","failure":"hangup"}},{"name":"Fail","value":"Fail to make bulk app call","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXNMUy5ysluo","next":{"success":"PBXVkiMHNmiSE","failure":"hangup"}},{"variable_name":"Fail","http_response_code":"402","response_content_type":"","value_type":"hb","type":"send","id":"PBXVkiMHNmiSE","next":{"success":"hangup","failure":"hangup"}}]},{"id":141706,"name":"6_GENERIC_ACTIVEMQ","trigger":"rest","expression":"/bulk/generic","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXFTTTyb14rT"}},{"plugin_name":"sql-plugin","value":"INSERT INTO BULK_TASK(TASK_PAYLOAD,STATUS,PER_REQ_ID) values('{{{escapequote tas}}}','QUEUED','{{{perRequest.GENERATED_KEY}}}');","value_type":"hb","output_variable":"task_output","type":"sql-insert","id":"PBX2fXibOPPeq","next":{"success":"PBX9Es8S5HTVz","failure":"PBXckpMRZ6L8k"}},{"name":"i","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFTTTyb14rT","next":{"success":"PBXZ43KK4bJrI","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${i}","comparator":"less_than","variable2":"${len}","value_type":"ftl","type":"if-condition","id":"PBXs1LfCnefcT","next":{"success":"PBXetqyqx0VCI","failure":"hangup"}},{"name":"i","value":"<#assign num3 = i?number><#setting number_format=\"computer\">${num3+j?number}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXlRif8dbcat","next":{"success":"PBXs1LfCnefcT","failure":"hangup"}},{"src":"var k = parseInt({{k}});\r\n\r\nvar tas=map.val[k];\r\n\r\nmap.tas=JSON.stringify(tas);\r\nmap.k=k.toPrecision();","inline":"true","type":"code-js","id":"PBXZuRDBEOJ2q","next":{"success":"PBX2fXibOPPeq","failure":"hangup"}},{"json_is":"true","json_name":"msg_payload","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"src","value":"bulk"},{"key":"payload","value":"{{{tas}}}"},{"key":"task_id","value":"{{{task_output.GENERATED_KEY}}}"}],"type":"set-var-multi","id":"PBXLOpvasQaxe","next":{"success":"PBX79pqItT9z2","failure":"hangup"}},{"name":"k","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXZ43KK4bJrI","next":{"success":"PBXs1LfCnefcT","failure":"hangup"}},{"name":"j","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXetqyqx0VCI","next":{"success":"PBXykkXufHUqm","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${j}","comparator":"less_than","variable2":"${ratePerLimit}","value_type":"ftl","type":"if-condition","id":"PBXykkXufHUqm","next":{"success":"PBX2TJKKAnTwh","failure":"PBXlRif8dbcat"}},{"output_variable":"","if_type":"value","variable1":"${k}","comparator":"less_than","variable2":"${len}","value_type":"ftl","type":"if-condition","id":"PBX2TJKKAnTwh","next":{"success":"PBXZuRDBEOJ2q","failure":"hangup"}},{"name":"k","value":"<#assign num3 = k?number><#setting number_format=\"computer\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBX9Es8S5HTVz","next":{"success":"PBXLOpvasQaxe","failure":"hangup"}},{"name":"j","value":"<#assign num3 = j?number><#setting number_format=\"computer\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXdKTwlgiMeq","next":{"success":"PBXykkXufHUqm","failure":"hangup"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"{{{request.path.queue-name}}}","delivery_mode":"2","scheduled_delay":"{{{request.path.wait}}}","scheduled_period":"{{{schedule-period}}}","scheduled_repeat":"{{{schedule-repeat}}}","scheduled_cron":"{{{schedule-cron}}}","messages":[{"key":"{{{json msg_payload}}}","value":"{{{priority}}}"}],"type":"active-mq-producer","id":"PBXw18DvVns6K","next":{"success":"PBXdKTwlgiMeq","failure":"PBXFFmRk1bqZC"}},{"json_is":"true","json_name":"errorResp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"ActiveMQ plugin or config fail, please chec plugin and configuration"}],"type":"set-var-multi","id":"PBXFFmRk1bqZC","next":{"success":"PBXiK3ODSq9T6","failure":"hangup"}},{"variable_name":"errorResp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXiK3ODSq9T6","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"errorResp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Bulk task insert failure"}],"type":"set-var-multi","id":"PBXckpMRZ6L8k","next":{"success":"PBX1MUSrtxvq9","failure":"hangup"}},{"variable_name":"errorResp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX1MUSrtxvq9","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"schedule-details","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"schedule-period","value":"{{{request.params.schedule-period}}}"},{"key":"schedule-repeat","value":"{{{request.params.schedule-repeat}}}"},{"key":"schedule-cron","value":"{{{request.params.schedule-cron}}}"}],"type":"set-var-multi","id":"PBX79pqItT9z2","next":{"success":"PBXw18DvVns6K","failure":"hangup"}}]},{"id":141707,"name":"2_CALL_BACK_URL","trigger":"rest","expression":"/bulk/callback","method":"PUT","steps":[{"type":"start","id":1,"next":{"start":"PBXeZlGJFZM88"}},{"plugin_name":"sql-plugin","value":"UPDATE BULK_TASK SET JOB_ID='{{{request.body.job_id}}}',STATUS='DELIVERED',DATE_TIME= current_timestamp() where ID='{{{request.body.task_id}}}';","value_type":"hb","output_variable":"updated2","type":"sql-update","id":"PBXeZlGJFZM88","next":{"success":"PBX1pPCpi9tCX","failure":"hangup"}},{"json_is":"true","json_name":"up","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"Updated"}],"type":"set-var-multi","id":"PBX1pPCpi9tCX","next":{"success":"PBXJP1xrtNeep","failure":"hangup"}},{"variable_name":"up","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBXJP1xrtNeep","next":{"success":"hangup","failure":"hangup"}}]},{"id":141708,"name":"3_BULKAPP_GET_ALL_JOB_STATUS_BY_REQUEST_ID","trigger":"rest","expression":"/bulk/status/{id}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBX0tTvwIT8Qm"}},{"plugin_name":"sql-plugin","value":"SELECT ID,TASK_PAYLOAD,STATUS,JOB_ID,DATE_TIME FROM BULK_TASK WHERE PER_REQ_ID = '{{{request.path.id}}}';","value_type":"hb","output_variable":"all","type":"sql","id":"PBX0tTvwIT8Qm","next":{"success":"PBXrDWN7ZMe49","failure":"hangup"}},{"variable_name":"all","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBXrDWN7ZMe49","next":{"success":"hangup","failure":"hangup"}}]},{"id":141710,"name":"1_SEND_TO_ACTIVEMQ_QUEUE","trigger":"rest","expression":"/bulk/{priority}/{wait}/{queue-name}/{rate}","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXhkhHdU5DGC"}},{"plugin_name":"sql-plugin","value":"INSERT INTO BULK_TASK(TASK_PAYLOAD,STATUS,PER_REQ_ID) values('{{{escapequote tas}}}','QUEUED','{{{perRequest.GENERATED_KEY}}}');","value_type":"hb","output_variable":"task_output","type":"sql-insert","id":"PBX2fXibOPPeq","next":{"success":"PBXLOpvasQaxe","failure":"hangup"}},{"name":"i","value":"0","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXFTTTyb14rT","next":{"success":"PBXs1LfCnefcT","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${i}","comparator":"less_than","variable2":"${len}","value_type":"ftl","type":"if-condition","id":"PBXs1LfCnefcT","next":{"success":"PBXZuRDBEOJ2q","failure":"PBXwc0sJfrlo0"}},{"name":"i","value":"<#assign num3 = i?number><#setting number_format=\"computer\">${num3+1}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXlRif8dbcat","next":{"success":"PBXs1LfCnefcT","failure":"hangup"}},{"src":"var tas=map.val[{{i}}];\r\n\r\n\r\nmap.tas=JSON.stringify(tas);","inline":"true","type":"code-js","id":"PBXZuRDBEOJ2q","next":{"success":"PBX2fXibOPPeq","failure":"hangup"}},{"json_is":"true","json_name":"msg_payload","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"src","value":"bulk"},{"key":"payload","value":"{{{tas}}}"},{"key":"task_id","value":"{{{task_output.GENERATED_KEY}}}"}],"type":"set-var-multi","id":"PBXLOpvasQaxe","next":{"success":"PBXAOprc3mrga","failure":"hangup"}},{"name":"reqId","value":"{{{request.requestId}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXhkhHdU5DGC","next":{"success":"PBXxkzTkpghqv","failure":"hangup"}},{"name":"ratePerLimit","value":"{{{request.path.rate}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXbMdUp74wBV","next":{"success":"PBXwcVA435GJ1","failure":"hangup"}},{"exception_handle":"false","workflow_id":"6_GENERIC_ACTIVEMQ","type":"execute-workflows","id":"PBXtzD2WQiHNb","next":{"success":"PBXwc0sJfrlo0","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${ratePerLimit}","comparator":"equal_to","variable2":"0","value_type":"ftl","type":"if-condition","id":"PBXaIxnmi1pUU","next":{"success":"PBXFTTTyb14rT","failure":"PBXtzD2WQiHNb"}},{"plugin_name":"Active_mq","value_type":"hb","queue_or_topic":"queue","name":"{{{request.path.queue-name}}}","delivery_mode":"2","scheduled_delay":"{{{request.path.wait}}}","scheduled_period":"{{{schedule-period}}}","scheduled_repeat":"{{{schedule-repeat}}}","scheduled_cron":"{{{schedule-cron}}}","messages":[{"key":"{{{json msg_payload}}}","value":"{{{priority}}}"}],"type":"active-mq-producer","id":"PBXnyMqngbmpg","next":{"success":"PBXlRif8dbcat","failure":"PBXCei0TvblV5"}},{"plugin_name":"sql-plugin","value":"INSERT INTO BULK_MISC(REQ_ID) values ('{{{reqId}}}');","value_type":"hb","output_variable":"perRequest","type":"sql-insert","id":"PBXxkzTkpghqv","next":{"success":"PBXczz0Wi44T3","failure":"PBXD6hW7BUh3T"}},{"json_is":"true","json_name":"resp4","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"ID","value":"{{{perRequest.GENERATED_KEY}}}"}],"type":"set-var-multi","id":"PBX704AoI0Rco","next":{"success":"PBXbMdUp74wBV","failure":"hangup"}},{"name":"task","value":"{{{json request.body.tasks}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXfdmiRBLkFD","next":{"success":"PBXweHQLnAbGu","failure":"hangup"}},{"src":"map.val=JSON.parse(map.task);\r\n","inline":"true","type":"code-js","id":"PBXFPrMu3gp87","next":{"success":"PBXaIxnmi1pUU","failure":"hangup"}},{"json_is":"true","json_name":"failResp","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"Database error, please check plugin credentials and also check for ActiveMQ credentials INSERT INTO BULK_MISC(REQ_ID) values ('{{{reqId}}}');"}],"type":"set-var-multi","id":"PBXD6hW7BUh3T","next":{"success":"PBXCxuPEV2d50","failure":"hangup"}},{"variable_name":"failResp","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXCxuPEV2d50","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"resp4","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXwc0sJfrlo0","next":{"success":"hangup","failure":"hangup"}},{"name":"priority","value":"{{{request.path.priority}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXczz0Wi44T3","next":{"success":"PBX704AoI0Rco","failure":"hangup"}},{"name":"priority","value":"<#if priority == \"normal\">4<#elseif priority == \"high\">9<#elseif priority == \"low\">2</#if>","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXwcVA435GJ1","next":{"success":"PBXfdmiRBLkFD","failure":"hangup"}},{"name":"len","value":"<#assign n = request.body.tasks?size><#setting number_format=\"computer\">${n}","value_type":"ftl","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXweHQLnAbGu","next":{"success":"PBXFPrMu3gp87","failure":"hangup"}},{"json_is":"true","json_name":"resp4","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"message","value":"Check your ActiveMQ Credentials along with queue name"}],"type":"set-var-multi","id":"PBXCei0TvblV5","next":{"success":"PBX4sUaFd0qtN","failure":"hangup"}},{"variable_name":"resp4","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBX4sUaFd0qtN","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"schedule_details","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"schedule-period","value":"{{{request.params.schedule-period}}}"},{"key":"schedule-cron","value":"{{{request.params.schedule-cron}}}"},{"key":"schedule-repeat","value":"{{{request.params.schedule-repeat}}}"}],"type":"set-var-multi","id":"PBXAOprc3mrga","next":{"success":"PBXnyMqngbmpg","failure":"hangup"}}]},{"id":141711,"name":"DELETE_TASKS","trigger":"rest","expression":"/bulk/delete/{id}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBX4wz79JcQpe"}},{"plugin_name":"sql-plugin","value":"SELECT JOB_ID, count(*) as count FROM BULK_TASK where ID='{{{request.path.id}}}';","value_type":"hb","output_variable":"result","type":"sql-one","id":"PBX4wz79JcQpe","next":{"success":"PBXrzkeoyTAXo","failure":"hangup"}},{"variable_name":"status","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBX3pANu5tKUu","next":{"success":"hangup","failure":"hangup"}},{"output_variable":"","if_type":"value","variable1":"${result.count?number}","comparator":"greater_than","variable2":"0","value_type":"ftl","type":"if-condition","id":"PBXrzkeoyTAXo","next":{"success":"PBXgCRoN9godV","failure":"PBXPZH6AfdaSs"}},{"json_is":"true","json_name":"status","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"error","value":"Given id is not found"}],"type":"set-var-multi","id":"PBXPZH6AfdaSs","next":{"success":"PBX3pANu5tKUu","failure":"hangup"}},{"plugin_name":"Active_mq","job_ids":[{"key":"{{{result.JOB_ID}}}"}],"type":"active-mq-delete","id":"PBXgCRoN9godV","next":{"success":"PBXEWarMhuZST","failure":"hangup"}},{"json_is":"true","json_name":"status","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"result","value":"deleted"}],"type":"set-var-multi","id":"PBXyF9srTnNw9","next":{"success":"PBX3pANu5tKUu","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"DELETE from  BULK_TASK where ID='{{{request.path.id}}}';","value_type":"hb","output_variable":"deleted","type":"sql-delete","id":"PBXEWarMhuZST","next":{"success":"PBXyF9srTnNw9","failure":"hangup"}}]},{"id":141712,"name":"STATUS_REQUEST_ID","trigger":"rest","expression":"/bulk/batch-status/{id}","method":"GET","steps":[{"type":"start","id":1,"next":{"start":"PBXzT1EQAeGiL"}},{"variable_name":"getObj","http_response_code":"","response_content_type":"","value_type":"hb","type":"send","id":"PBXKC2ERT8okV","next":{"success":"hangup","failure":"hangup"}},{"plugin_name":"sql-plugin","value":"SELECT COUNT(ID) As TOTAL, STATUS FROM BULK_TASK WHERE PER_REQ_ID=(SELECT ID FROM BULK_MISC WHERE ID='{{{request.path.id}}}') group by STATUS;","value_type":"hb","output_variable":"getObj","type":"sql","id":"PBXzT1EQAeGiL","next":{"success":"PBXKC2ERT8okV","failure":"hangup"}}]},{"id":141857,"name":"G_Thumbnail","trigger":"rest","expression":"/gthumbnail","method":"POST","steps":[{"type":"start","id":1,"next":{"start":"PBXg0tab2lRyA"}},{"name":"url","value":"{{request.body.url}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXeXeukxhlLW","next":{"success":"hangup","failure":"hangup"}},{"class_name":"G_Thumbnail","package_name":"com.appup.apps.g","type":"code-java","id":"PBX2kanORuE9V","next":{"success":"PBXQcGLr4Sx2c","failure":"PBXURb4kyAwGO"}},{"name":"image","value":"{{{image}}}","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","type":"set-var","id":"PBXQcGLr4Sx2c","next":{"success":"PBXaoKpmcrPNs","failure":"hangup"}},{"variable_name":"image","http_response_code":"200","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXaoKpmcrPNs","next":{"success":"hangup","failure":"hangup"}},{"variable_name":"image","http_response_code":"400","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXURb4kyAwGO","next":{"success":"hangup","failure":"hangup"}},{"json_is":"true","json_name":"UrlDetails","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"url","value":"{{request.body.url}}"},{"key":"width","value":"{{request.body.width}}"},{"key":"height","value":"{{request.body.height}}"}],"type":"set-var-multi","id":"PBXg0tab2lRyA","next":{"success":"PBX2kanORuE9V","failure":"hangup"}}]},{"id":"default-health","name":"default-health","trigger":"rest","expression":"/_appup/_version","method":"get","steps":[{"id":"1","type":"get-env-data","action":"env","variable":["VERSION","CLOUD_ID","SVC_NAME","IMAGE_TAG"],"next":{"success":"prepareResponse"}},{"id":"prepareResponse","type":"set-var-multi","json_is":true,"json_name":"deployInfo","variables":[{"key":"APP_NAME","value":"{{SVC_NAME}}"},{"key":"CLOUD_ID","value":"{{CLOUD_ID}}"},{"key":"VERSION","value":"{{VERSION}}"},{"key":"DI_TAG","value":"{{IMAGE_TAG}}"}],"next":{"success":"send"}},{"id":"send","type":"send","variable_name":"deployInfo","http_response_code":"200","value_type":"hb"}]}],"filters":[{"name":"JWT_VALIDATION","id":2964,"type":["pre-filter"],"expression":["/storage/*","/notification/*","/email/*","/alerts/*","/automation/*"],"steps":[{"type":"start","id":1,"next":{"start":"PBXTsRCZvQt9C"}},{"name":"JWT Validataion","output_variable":"session","value_type":"hb","plugin_name":"jwt-plugin","sourceExpression":[{"value":"{{{request.cookies.token.value}}}"},{"value":"{{{request.headers.token}}}"}],"type":"jwt-validate","id":"PBX0QLThEzcfl","next":{"success":"hangup","failure":"PBXNMTHkogfZk"}},{"json_is":"true","json_name":"error_response","value_type":"hb","encode_or_decode":"DO_NOTHING","char_set":"ISO-8859-1","variables":[{"key":"status","value":"Unauthorized: Please set valid token"},{"key":"code","value":"401"}],"type":"set-var-multi","id":"PBXNMTHkogfZk","next":{"success":"PBXh854B4ha0T","failure":"hangup"}},{"variable_name":"error_response","http_response_code":"{{error_response.code}}","response_content_type":"application/json","value_type":"hb","type":"send","id":"PBXh854B4ha0T","next":{"success":"hangup","failure":"hangup"}},{"value_type":"ftl","headers":[{"key":"Access-Control-Allow-Origin","value":"*.appup.cloud,*.appup.com,*500apps.com"},{"key":"Access-Control-Allow-Credentials","value":"true"},{"key":"Access-Control-Allow-Methods","value":"GET, POST,PUT, DELETE"},{"key":"Access-Control-Allow-Headers","value":"X-Custom-Header"}],"type":"set-header","id":"PBXTsRCZvQt9C","next":{"success":"PBX0QLThEzcfl","failure":"hangup"}}]}],"server":{"idle_timeout":60000,"port":"8080","host":"0.0.0.0","set_time_response":true,"set_options":true,"options_route_expression":"/*","options_allowed_origins":"*","options_allowed_methods":"GET,PUT,POST,DELETE,OPTIONS","options_allowed_headers":"Content-Type, Authorization, Content-Length, X-Requested-With","static_route_expression":"/","signKey":"DA693C13E7C5528473D915EB827EC","access_key":"AKIA5QMVMZUCPAAZ7PWV","secret_key":"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","ably_apikey":"oybGjQ.Yv7tcg:4UrB37IRpda2JydY","db_username":"500generic","db_password":"500Generic@123","db_server":"appsdb500-1-rd.c2xawm3kje6l.us-west-2.rds.amazonaws.com","db_schema":"500generic","activemq_queue":"myqueue","activemq_brokerUrl":"ssl://b-840b987b-e5b3-47fd-b9ed-4cc1ed4013d9-1.mq.us-east-1.amazonaws.com:61617","activemq_username":"appup","activemq_password":"appupactivemq","app_info_table":"USER_INFO","vapid_key_table":"VAPID_KEYS","subscription_table":"SUBSCRIPTION","cron_exp":"0","automationQueue":"Automation-queue","db_max_pool_size":"100","db_min_idle_con":"2","activemq_max_pool_size":"100","async_send":"true"},"properties":{"cloud":{},"app":{"signKey":"DA693C13E7C5528473D915EB827EC","access_key":"AKIA5QMVMZUCPAAZ7PWV","secret_key":"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","ably_apikey":"oybGjQ.Yv7tcg:4UrB37IRpda2JydY","db_username":"500generic","db_password":"500Generic@123","db_server":"appsdb500-1-rd.c2xawm3kje6l.us-west-2.rds.amazonaws.com","db_schema":"500generic","activemq_queue":"myqueue","activemq_brokerUrl":"ssl://b-840b987b-e5b3-47fd-b9ed-4cc1ed4013d9-1.mq.us-east-1.amazonaws.com:61617","activemq_username":"appup","activemq_password":"appupactivemq","app_info_table":"USER_INFO","vapid_key_table":"VAPID_KEYS","subscription_table":"SUBSCRIPTION","cron_exp":"0","automationQueue":"Automation-queue","db_max_pool_size":"100","db_min_idle_con":"2","activemq_max_pool_size":"100","async_send":"true"}},"plugins":[{"id":18349,"name":"jwt-plugin","type":"jwt-plugin","version":"1.0","category":"JWT","signKey":"{{{app.signKey}}}"},{"id":18350,"name":"s3-plugin","type":"s3-plugin","version":"1.0","category":"AWS","accessKey":"{{{app.access_key}}}","secretKey":"{{{app.secret_key}}}","region":"us-east-1"},{"id":18383,"name":"ably_plugin","type":"ably-plugin","version":"1.0","category":"Event","api_key":"{{app.ably_apikey}}"},{"id":18387,"name":"ses-plugin","type":"email-plugin","version":"1.0","category":"AWS","access_key":"{{{app.access_key}}}","secret_key":"{{{app.secret_key}}}","region":"us-east-1"},{"id":18411,"name":"sql-plugin","type":"mysql-plugin","version":"1.0","category":"mysql-database","server":"{{{app.db_server}}}","username":"{{{app.db_username}}}","password":"{{{app.db_password}}}","schema":"{{{app.db_schema}}}"},{"id":19030,"name":"Active_mq","type":"active-mq","version":"1.0","category":"Event","username":"{{{app.activemq_username}}}","password":"{{{app.activemq_password}}}","broker_url":"{{{app.activemq_brokerUrl}}}","async_send":"{{{app.async_send}}}","max_pool_connections":"{{{app.activemq_max_pool_size}}}"},{"id":19087,"name":"rest-async","type":"rest-async","version":"1.0","category":"Event","max_connection_per_host":"600","max_request_queue_host":"1024"},{"id":19860,"name":"cms-plugin","type":"s3-plugin","version":"1.0","category":"AWS","accessKey":"{{{app.access_key}}}","secretKey":"{{{app.secret_key}}}","region":"us-west-1"},{"id":19865,"name":"multiapp","type":"java-plugin","version":"1.0","category":"Java","pom_data":"<dependencies>     <dependency>      <groupId>org.json</groupId>     <artifactId>json</artifactId>     <version>20190722</version> </dependency>    <dependency>         <groupId>com.appup</groupId>         <artifactId>steps-api</artifactId>         <scope>system</scope>         <version>1.0.1</version>         <systemPath>/appup_lib/jars/appup_jars/steps-api-1.0.1.jar</systemPath>     </dependency>    <dependency>       <groupId>com.fasterxml.jackson.core</groupId>       <artifactId>jackson-databind</artifactId>       <version>2.8.9</version>    </dependency>    <dependency>       <groupId>com.fasterxml.jackson.dataformat</groupId>       <artifactId>jackson-dataformat-csv</artifactId>       <version>2.8.9</version>    </dependency>    <dependency>       <groupId>com.fasterxml.jackson.core</groupId>       <artifactId>jackson-core</artifactId>       <version>2.10.1</version>    </dependency>  </dependencies>"},{"id":20232,"name":"alert_DB","type":"mysql-plugin","version":"1.0","category":"mysql-database","server":"appsdb500-1.c2xawm3kje6l.us-west-2.rds.amazonaws.com","username":"500generic","schema":"500generic","password":"500Generic@123"},{"id":20253,"name":"RedisCache","type":"jedis-plugin","version":"1.0","category":"Database","host":"redis.500apps.com"},{"id":20400,"name":"reports_DB","type":"mysql-plugin","version":"1.0","category":"mysql-database","server":"corporate.appup.com","username":"cronuser","password":"Cronuser#123","schema":"crondb"},{"id":20401,"name":"corp_sql","type":"mysql-plugin","version":"1.0","category":"mysql-database","username":"cronuser","password":"Cronuser#123","server":"corporate.appup.com","schema":"crondb"}]}